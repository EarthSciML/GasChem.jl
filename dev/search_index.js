var documenterSearchIndex = {"docs":
[{"location":"AtmosphericLifetime/#Atmospheric-Lifetime","page":"Atmospheric Lifetime","title":"Atmospheric Lifetime","text":"","category":"section"},{"location":"AtmosphericLifetime/#Overview","page":"Atmospheric Lifetime","title":"Overview","text":"The AtmosphericLifetime module provides a ModelingToolkit.jl implementation of atmospheric constituent lifetime equations from Chapter 2 of Seinfeld and Pandis (2006). These equations form the foundation for understanding the fate of trace species in the atmosphere.\n\nAtmospheric lifetime is a fundamental concept in atmospheric chemistry that characterizes how long a species remains in a given atmospheric reservoir before being removed by chemical reactions, deposition, or transport. Understanding lifetimes is essential for:\n\nPredicting the accumulation of pollutants and greenhouse gases\nAssessing the response time of the atmosphere to emission changes\nUnderstanding the spatial scale of pollution (local vs. global)\nEvaluating the effectiveness of emission control strategies\n\nThe module implements several key concepts:\n\nComponent Equations Description\nAtmosphericBudget Eq. 2.1-2.2 Mass conservation and steady-state conditions\nSpeciesLifetime Eq. 2.3-2.6 Lifetime calculations for various scenarios\nMultipleRemovalLifetime Eq. 2.7-2.9 Combined lifetime from parallel removal pathways\nOHReactionLifetime Eq. 2.12 Lifetime due to OH radical reaction\nTroposphericBudget Eq. 2.13-2.17 Complete tropospheric budget with multiple sources and sinks","category":"section"},{"location":"AtmosphericLifetime/#Reference","page":"Atmospheric Lifetime","title":"Reference","text":"Seinfeld, J. H. and Pandis, S. N.: Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 2: Atmospheric Trace Constituents, John Wiley & Sons, Inc., Hoboken, New Jersey, 2006, ISBN: 978-0-471-72017-1.\n\n","category":"section"},{"location":"AtmosphericLifetime/#Implementation","page":"Atmospheric Lifetime","title":"Implementation","text":"This section provides detailed documentation of each equation system implemented in the AtmosphericLifetime module.","category":"section"},{"location":"AtmosphericLifetime/#AtmosphericBudget-(Eq.-2.1-2.2)","page":"Atmospheric Lifetime","title":"AtmosphericBudget (Eq. 2.1-2.2)","text":"The fundamental mass conservation equation for an atmospheric species states that the rate of change of mass in a reservoir equals the sum of transport and chemistry contributions.\n\nEquation 2.1 (Mass Conservation):\n\nfracdQdt = (F_in - F_out) + (P - R)\n\nwhere:\n\nQ: Total mass (or moles) of the species in the reservoir\nF_in: Rate of mass inflow from outside the reservoir\nF_out: Rate of mass outflow from the reservoir\nP: Rate of chemical production within the reservoir\nR: Rate of chemical removal within the reservoir\n\nEquation 2.2 (Steady State):\n\nAt steady state, dQdt = 0, implying:\n\nF_in + P = F_out + R","category":"section"},{"location":"AtmosphericLifetime/#State-Variables","page":"Atmospheric Lifetime","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities\nusing GasChem.AtmosphericLifetime: AtmosphericBudget\n\n@named sys = AtmosphericBudget()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [string(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"AtmosphericLifetime/#Equations","page":"Atmospheric Lifetime","title":"Equations","text":"equations(sys)\n\n","category":"section"},{"location":"AtmosphericLifetime/#SpeciesLifetime-(Eq.-2.3-2.6)","page":"Atmospheric Lifetime","title":"SpeciesLifetime (Eq. 2.3-2.6)","text":"The SpeciesLifetime component calculates atmospheric lifetime using various formulations depending on the scenario.\n\nEquation 2.3 (General Lifetime):\n\ntau = fracQR + F_out\n\nThis general definition applies to any reservoir with both chemical removal and outflow.\n\nEquation 2.4 (Global Atmosphere):\n\nFor the global atmosphere as a whole, there is no outflow to other reservoirs (F_out = 0):\n\ntau = fracQR\n\nEquation 2.5 (Steady State):\n\nAt steady state with no external transport (F_in = F_out = 0), production equals removal:\n\ntau = fracQR = fracQP\n\nEquation 2.6 (First-Order Removal):\n\nWhen removal follows first-order kinetics (R = lambda Q):\n\ntau = frac1lambda","category":"section"},{"location":"AtmosphericLifetime/#State-Variables-2","page":"Atmospheric Lifetime","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities\nusing GasChem.AtmosphericLifetime: SpeciesLifetime\n\n@named sys = SpeciesLifetime()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [string(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"AtmosphericLifetime/#Parameters","page":"Atmospheric Lifetime","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [string(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"AtmosphericLifetime/#Equations-2","page":"Atmospheric Lifetime","title":"Equations","text":"equations(sys)\n\n","category":"section"},{"location":"AtmosphericLifetime/#MultipleRemovalLifetime-(Eq.-2.7-2.9)","page":"Atmospheric Lifetime","title":"MultipleRemovalLifetime (Eq. 2.7-2.9)","text":"When multiple independent removal pathways operate in parallel, the combined lifetime is calculated from the individual pathway lifetimes.\n\nEquation 2.7 (Two First-Order Processes):\n\ntau = frac1k_1 + k_2\n\nEquation 2.8 (Inverse Lifetime Sum):\n\nfrac1tau = frac1tau_1 + frac1tau_2\n\nThis shows that inverse lifetimes (removal rates) are additive for parallel processes.\n\nEquation 2.9 (Combined Lifetime Formula):\n\ntau = fractau_1 cdot tau_2tau_1 + tau_2\n\nThis can be extended to N pathways:\n\nfrac1tau = sum_i=1^N frac1tau_i","category":"section"},{"location":"AtmosphericLifetime/#State-Variables-3","page":"Atmospheric Lifetime","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities\nusing GasChem.AtmosphericLifetime: MultipleRemovalLifetime\n\n@named sys = MultipleRemovalLifetime()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [string(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"AtmosphericLifetime/#Parameters-2","page":"Atmospheric Lifetime","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [string(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"AtmosphericLifetime/#Equations-3","page":"Atmospheric Lifetime","title":"Equations","text":"equations(sys)\n\n","category":"section"},{"location":"AtmosphericLifetime/#OHReactionLifetime-(Eq.-2.12)","page":"Atmospheric Lifetime","title":"OHReactionLifetime (Eq. 2.12)","text":"The hydroxyl radical (OH) is the primary oxidant in the troposphere for many trace species. The lifetime due to OH reaction is calculated from the second-order rate constant and the ambient OH concentration.\n\nEquation 2.12:\n\ntau = frac1k_OH cdot OH\n\nwhere:\n\nk_OH: Second-order rate constant for reaction with OH (cm^3/(molecule s))\nOH: Concentration of OH radicals (molecule/cm^3)\n\nThe product k_OH cdot OH gives an effective first-order rate constant consistent with Eq. 2.6.\n\nTypical Values:\n\nk_OH: varies widely, e.g., 10^-14 to 10^-10 cm^3/(molecule s)\nOH: ~10^6 molecule/cm^3 (global tropospheric average)\ntau: seconds to years depending on species","category":"section"},{"location":"AtmosphericLifetime/#State-Variables-4","page":"Atmospheric Lifetime","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities\nusing GasChem.AtmosphericLifetime: OHReactionLifetime\n\n@named sys = OHReactionLifetime()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [string(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"AtmosphericLifetime/#Parameters-3","page":"Atmospheric Lifetime","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [string(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"AtmosphericLifetime/#Equations-4","page":"Atmospheric Lifetime","title":"Equations","text":"equations(sys)\n\n","category":"section"},{"location":"AtmosphericLifetime/#TroposphericBudget-(Eq.-2.13-2.17)","page":"Atmospheric Lifetime","title":"TroposphericBudget (Eq. 2.13-2.17)","text":"The TroposphericBudget component implements the complete mass balance for a trace species in the troposphere, including multiple source and sink terms.\n\nEquations 2.13-2.14 (Tropospheric Budget):\n\nfracdQ_idt = P_i^n + P_i^a + P_i^c - (k_i^d + k_i^w + k_i^c + k_i^t) Q_i\n\nSource terms (production rates):\n\nP_n: Natural emissions (biogenic, volcanic, oceanic, etc.)\nP_a: Anthropogenic emissions (combustion, industrial, agricultural, etc.)\nP_c: Chemical production within the troposphere\n\nRemoval terms (first-order rate constants):\n\nk_d: Dry deposition (uptake by surfaces)\nk_w: Wet deposition (scavenging by precipitation)\nk_c: Chemical loss (reaction with OH, O3, NO3, etc.)\nk_t: Transport to stratosphere (cross-tropopause flux)\n\nEquation 2.15 (Lifetime from Removal):\n\ntau_i = frac1k_d + k_w + k_c + k_t\n\nEquations 2.16-2.17 (Lifetime from Production at Steady State):\n\ntau_i = fracQ_iP_n + P_a + P_c","category":"section"},{"location":"AtmosphericLifetime/#State-Variables-5","page":"Atmospheric Lifetime","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities\nusing GasChem.AtmosphericLifetime: TroposphericBudget\n\n@named sys = TroposphericBudget()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [string(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"AtmosphericLifetime/#Parameters-4","page":"Atmospheric Lifetime","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [string(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"AtmosphericLifetime/#Equations-5","page":"Atmospheric Lifetime","title":"Equations","text":"equations(sys)\n\n","category":"section"},{"location":"AtmosphericLifetime/#Analysis","page":"Atmospheric Lifetime","title":"Analysis","text":"This section demonstrates the physical behavior of the atmospheric lifetime equations through numerical examples and visualizations.","category":"section"},{"location":"AtmosphericLifetime/#Time-Evolution-of-Species-Mass","page":"Atmospheric Lifetime","title":"Time Evolution of Species Mass","text":"The following example shows how a species mass evolves over time in the troposphere, starting from zero and approaching steady state. This demonstrates the fundamental behavior of Eq. 2.13.\n\nusing Plots\nusing OrdinaryDiffEqDefault\nusing ModelingToolkit\nusing ModelingToolkit: t\nusing GasChem.AtmosphericLifetime: TroposphericBudget\n\n# Create the tropospheric budget system\n@named trop = TroposphericBudget()\n\n# Prepare for compilation\ntrop_nns = toggle_namespacing(trop, false)\ninputs = [trop_nns.P_n, trop_nns.P_a, trop_nns.P_c]\ncompiled = mtkcompile(trop; inputs)\n\n# Define parameters for a hypothetical reactive species\n# Rate constants (s^-1)\nk_d_val = 1e-6    # Dry deposition (~11.6 day lifetime)\nk_w_val = 5e-7    # Wet deposition (~23.1 day lifetime)\nk_c_val = 2e-6    # Chemical loss (~5.8 day lifetime)\nk_t_val = 1e-7    # Stratospheric transport (~115.7 day lifetime)\n\n# Source rates (mol/s)\nP_n_val = 1e5     # Natural emissions\nP_a_val = 5e4     # Anthropogenic emissions\nP_c_val = 2e4     # Chemical production\n\n# Calculate expected steady state and lifetime\nP_total_val = P_n_val + P_a_val + P_c_val\nk_total_val = k_d_val + k_w_val + k_c_val + k_t_val\nQ_ss = P_total_val / k_total_val\ntau = 1 / k_total_val\ntau_days = tau / 86400\n\n# Set up and solve ODE\nQ_0 = 0.0  # Start with zero mass\nt_end = 10 * tau  # Simulate for 10 lifetimes\n\nprob = ODEProblem(\n    compiled,\n    Dict(\n        compiled.Q => Q_0,\n        compiled.k_d => k_d_val,\n        compiled.k_w => k_w_val,\n        compiled.k_c => k_c_val,\n        compiled.k_t => k_t_val,\n        compiled.P_n => P_n_val,\n        compiled.P_a => P_a_val,\n        compiled.P_c => P_c_val\n    ),\n    (0.0, t_end)\n)\n\nsol = solve(prob, saveat = tau/10)\n\n# Convert time to days for plotting\nt_days = sol.t ./ 86400\nQ_values = sol[compiled.Q]\n\n# Create the plot\np1 = plot(\n    t_days, Q_values ./ 1e10,\n    xlabel = \"Time (days)\",\n    ylabel = \"Species Mass (10^10 mol)\",\n    title = \"Approach to Steady State in the Troposphere\",\n    label = \"Q(t)\",\n    linewidth = 2,\n    color = :blue,\n    legend = :bottomright,\n    size = (700, 450),\n    grid = true\n)\n\n# Add steady state line\nhline!(p1, [Q_ss / 1e10],\n    label = \"Steady State (Q_ss)\",\n    linestyle = :dash,\n    color = :red,\n    linewidth = 2)\n\n# Add e-folding time markers\nvline!(p1, [tau_days],\n    label = \"tau = $(round(tau_days, digits=1)) days\",\n    linestyle = :dot,\n    color = :green,\n    linewidth = 2)\n\n# Add annotation\nannotate!(p1, tau_days * 5, Q_ss * 0.5 / 1e10,\n    text(\"63% of Q_ss reached\\nat t = tau\", 10, :left))\n\nsavefig(p1, \"time_evolution.png\")\np1\n\nPhysical Interpretation: The species mass grows exponentially at first, then levels off as removal processes balance the sources. The characteristic timescale for this approach to equilibrium is the atmospheric lifetime tau. After one lifetime, the mass reaches 63% (1 - 1e) of its steady-state value.\n\n","category":"section"},{"location":"AtmosphericLifetime/#Exponential-Decay-from-Initial-Burden","page":"Atmospheric Lifetime","title":"Exponential Decay from Initial Burden","text":"When sources are removed, a species decays exponentially with the characteristic lifetime. This demonstrates Eq. 2.6.\n\nusing Plots\nusing OrdinaryDiffEqDefault\nusing ModelingToolkit\nusing ModelingToolkit: t\nusing GasChem.AtmosphericLifetime: TroposphericBudget\n\n@named trop = TroposphericBudget()\n\ntrop_nns = toggle_namespacing(trop, false)\ninputs = [trop_nns.P_n, trop_nns.P_a, trop_nns.P_c]\ncompiled = mtkcompile(trop; inputs)\n\n# Pure decay scenario (no sources)\nlambda = 1e-5  # s^-1, corresponds to tau = 10^5 s ~ 1.16 days\nQ_0 = 1e12     # Initial burden (mol)\n\nprob = ODEProblem(\n    compiled,\n    Dict(\n        compiled.Q => Q_0,\n        compiled.k_d => lambda,\n        compiled.k_w => 0.0,\n        compiled.k_c => 0.0,\n        compiled.k_t => 0.0,\n        compiled.P_n => 0.0,\n        compiled.P_a => 0.0,\n        compiled.P_c => 0.0\n    ),\n    (0.0, 5 / lambda)\n)\n\nsol = solve(prob, saveat = (1/lambda)/10)\n\n# Calculate analytical solution for comparison\ntau = 1 / lambda\nt_values = sol.t\nQ_analytical = Q_0 .* exp.(-t_values ./ tau)\n\n# Convert to normalized units\nt_normalized = t_values ./ tau\nQ_normalized = sol[compiled.Q] ./ Q_0\n\np2 = plot(\n    t_normalized, Q_normalized,\n    xlabel = \"Time (t/tau)\",\n    ylabel = \"Normalized Mass (Q/Q_0)\",\n    title = \"Exponential Decay of Atmospheric Species\",\n    label = \"Numerical Solution\",\n    linewidth = 3,\n    color = :blue,\n    legend = :topright,\n    size = (700, 450),\n    grid = true\n)\n\n# Add analytical solution\nplot!(p2, t_normalized, Q_analytical ./ Q_0,\n    label = \"Analytical: exp(-t/tau)\",\n    linestyle = :dash,\n    linewidth = 2,\n    color = :red)\n\n# Mark e-folding times\nfor n in 1:4\n    vline!(p2, [n], label = n == 1 ? \"e-folding times\" : \"\",\n        linestyle = :dot, color = :gray, linewidth = 1)\n    Q_at_n = exp(-n)\n    scatter!(p2, [n], [Q_at_n],\n        label = \"\", markersize = 6, color = :green)\n    annotate!(p2, n + 0.1, Q_at_n + 0.05,\n        text(\"$(round(Q_at_n*100, digits=1))%\", 8, :left))\nend\n\nsavefig(p2, \"exponential_decay.png\")\np2\n\nKey Results:\n\nAfter 1 lifetime: 36.8% remains (e^-1)\nAfter 2 lifetimes: 13.5% remains (e^-2)\nAfter 3 lifetimes: 5.0% remains (e^-3)\nAfter 5 lifetimes: 0.7% remains (e^-5)\n","category":"section"},{"location":"AtmosphericLifetime/#Effect-of-Multiple-Removal-Pathways","page":"Atmospheric Lifetime","title":"Effect of Multiple Removal Pathways","text":"This analysis demonstrates how parallel removal pathways combine to reduce the total atmospheric lifetime (Eq. 2.7-2.9).\n\nusing Plots\n\n# Compare combined lifetime to individual pathway lifetimes\ntau_1_range = 1:1:30  # days\ntau_2_fixed = 10.0     # days\n\n# Calculate combined lifetimes using Eq. 2.9\ntau_combined = [(t1 * tau_2_fixed) / (t1 + tau_2_fixed) for t1 in tau_1_range]\n\np3 = plot(\n    tau_1_range, tau_combined,\n    xlabel = \"Lifetime from Pathway 1, tau_1 (days)\",\n    ylabel = \"Combined Lifetime, tau (days)\",\n    title = \"Combined Lifetime from Two Removal Pathways (tau_2 = 10 days)\",\n    label = \"tau_combined (Eq. 2.9)\",\n    linewidth = 3,\n    color = :blue,\n    legend = :bottomright,\n    size = (700, 450),\n    grid = true,\n    ylims = (0, 12)\n)\n\n# Add reference lines\nhline!(p3, [tau_2_fixed], label = \"tau_2 = 10 days\",\n    linestyle = :dash, color = :red, linewidth = 2)\nplot!(p3, tau_1_range, collect(tau_1_range), label = \"tau_1\",\n    linestyle = :dot, color = :green, linewidth = 2)\n\n# Mark special cases\nscatter!(p3, [tau_2_fixed], [(tau_2_fixed * tau_2_fixed) / (2 * tau_2_fixed)],\n    label = \"Equal lifetimes: tau = tau_1/2\",\n    markersize = 8, color = :orange)\n\n# Add annotation\nannotate!(p3, 20, 3,\n    text(\"Combined lifetime is always\\nless than either individual lifetime\", 10, :left))\n\nsavefig(p3, \"multiple_pathways.png\")\np3\n\nPhysical Interpretation:\n\nWhen tau_1 = tau_2, the combined lifetime is exactly half of either individual lifetime\nThe combined lifetime is always less than the smaller of the two individual lifetimes\nA fast removal pathway dominates the total lifetime even if a slow pathway exists\n","category":"section"},{"location":"AtmosphericLifetime/#Contribution-of-Removal-Pathways-to-Total-Lifetime","page":"Atmospheric Lifetime","title":"Contribution of Removal Pathways to Total Lifetime","text":"This figure shows how each removal pathway contributes to the total inverse lifetime for a typical tropospheric species.\n\nusing Plots\n\n# Typical rate constants for a reactive species (s^-1)\n# Convert to day^-1 for visualization\nk_d = 1e-6 * 86400   # Dry deposition\nk_w = 5e-7 * 86400   # Wet deposition\nk_c = 2e-6 * 86400   # Chemical loss\nk_t = 1e-7 * 86400   # Stratospheric transport\n\nk_total = k_d + k_w + k_c + k_t\n\n# Calculate individual lifetimes (days)\ntau_dry = 1 / k_d\ntau_wet = 1 / k_w\ntau_chem = 1 / k_c\ntau_transport = 1 / k_t\ntau_total = 1 / k_total\n\n# Calculate fractional contributions to 1/tau\nfrac_dry = k_d / k_total * 100\nfrac_wet = k_w / k_total * 100\nfrac_chem = k_c / k_total * 100\nfrac_transport = k_t / k_total * 100\n\n# Create bar chart of contributions\nlabels = [\"Dry Dep.\", \"Wet Dep.\", \"Chemical\", \"Transport\"]\nfractions = [frac_dry, frac_wet, frac_chem, frac_transport]\nlifetimes = [tau_dry, tau_wet, tau_chem, tau_transport]\ncolors = [:brown, :blue, :orange, :purple]\n\np4 = bar(\n    labels, fractions,\n    xlabel = \"\",\n    ylabel = \"Contribution to 1/tau (%)\",\n    title = \"Removal Pathway Contributions\\n(Total lifetime = $(round(tau_total, digits=1)) days)\",\n    label = \"\",\n    color = colors,\n    size = (700, 450),\n    ylims = (0, 60),\n    bar_width = 0.6\n)\n\n# Add lifetime labels on bars\nfor (i, (frac, tau)) in enumerate(zip(fractions, lifetimes))\n    annotate!(p4, i, frac + 2,\n        text(\"tau = $(round(tau, digits=1)) d\", 9, :center))\nend\n\nsavefig(p4, \"pathway_contributions.png\")\np4\n\nKey Observations:\n\nChemical loss typically dominates for reactive species\nDry deposition is significant for species that deposit readily to surfaces\nWet deposition is important for soluble species\nStratospheric transport is usually a minor sink for most tropospheric species\n","category":"section"},{"location":"AtmosphericLifetime/#OH-Reaction-Lifetimes-for-Common-Atmospheric-Species","page":"Atmospheric Lifetime","title":"OH Reaction Lifetimes for Common Atmospheric Species","text":"This analysis compares the OH-reaction lifetimes for several important atmospheric trace gases, demonstrating Eq. 2.12.\n\nusing Plots, DataFrames\n\n# OH rate constants at 298 K (cm^3 molecule^-1 s^-1) from JPL evaluation\n# and typical global mean OH concentration\nOH_conc = 1e6  # molecule/cm^3\n\nspecies_data = [\n    (\"Methane (CH4)\", 6.3e-15, \"Years\"),\n    (\"Ethane (C2H6)\", 2.4e-13, \"Months\"),\n    (\"Propane (C3H8)\", 1.1e-12, \"Days\"),\n    (\"Carbon Monoxide (CO)\", 2.4e-13, \"Months\"),\n    (\"Formaldehyde (HCHO)\", 8.5e-12, \"Hours\"),\n    (\"Isoprene (C5H8)\", 1.0e-10, \"Hours\"),\n    (\"Nitrogen Dioxide (NO2)\", 1.2e-11, \"Hours\")\n]\n\n# Calculate lifetimes\nspecies_names = String[]\nk_OH_values = Float64[]\ntau_values = Float64[]\ntau_units = String[]\n\nfor (name, k_OH, unit) in species_data\n    tau = 1 / (k_OH * OH_conc)  # seconds\n    push!(species_names, name)\n    push!(k_OH_values, k_OH)\n    push!(tau_units, unit)\n\n    # Convert to appropriate units\n    if unit == \"Years\"\n        push!(tau_values, tau / (365.25 * 86400))\n    elseif unit == \"Months\"\n        push!(tau_values, tau / (30 * 86400))\n    elseif unit == \"Days\"\n        push!(tau_values, tau / 86400)\n    else  # Hours\n        push!(tau_values, tau / 3600)\n    end\nend\n\n# Create summary table\ndf = DataFrame(\n    Species = species_names,\n    k_OH_cm3_molec_s = k_OH_values,\n    Lifetime = tau_values,\n    Units = tau_units\n)\ndf\n\n# Create bar chart of lifetimes (all converted to days for comparison)\ntau_days = Float64[]\nfor (name, k_OH, _) in species_data\n    tau = 1 / (k_OH * OH_conc)  # seconds\n    push!(tau_days, tau / 86400)\nend\n\np5 = bar(\n    1:length(species_names),\n    log10.(tau_days),\n    xlabel = \"\",\n    ylabel = \"log10(Lifetime in days)\",\n    title = \"OH Reaction Lifetimes at [OH] = 10^6 molecule/cm^3\",\n    label = \"\",\n    color = :steelblue,\n    size = (800, 500),\n    xticks = (1:length(species_names),\n        [\"CH4\", \"C2H6\", \"C3H8\", \"CO\", \"HCHO\", \"Isoprene\", \"NO2\"]),\n    bar_width = 0.6\n)\n\n# Add horizontal lines for reference timescales\nhline!(p5, [log10(365)], label = \"1 year\", linestyle = :dash, color = :red, linewidth = 2)\nhline!(\n    p5, [log10(30)], label = \"1 month\", linestyle = :dash, color = :orange, linewidth = 2)\nhline!(p5, [log10(1)], label = \"1 day\", linestyle = :dash, color = :green, linewidth = 2)\nhline!(\n    p5, [log10(1/24)], label = \"1 hour\", linestyle = :dash, color = :purple, linewidth = 2)\n\nsavefig(p5, \"oh_lifetimes.png\")\np5\n\nPhysical Interpretation:\n\nLong-lived species (CH4, CO): Global distribution, well-mixed in the troposphere\nIntermediate species (C2H6, C3H8): Regional to hemispheric influence\nShort-lived species (HCHO, isoprene, NO2): Local influence, highly variable concentrations\n","category":"section"},{"location":"AtmosphericLifetime/#Sensitivity-to-OH-Concentration","page":"Atmospheric Lifetime","title":"Sensitivity to OH Concentration","text":"The effective lifetime depends strongly on the ambient OH concentration, which varies with location, season, and time of day.\n\nusing Plots\n\n# OH concentration range (molecule/cm^3)\nOH_range = 10 .^ range(5, 7, length = 50)\n\n# k_OH for methane and CO\nk_OH_CH4 = 6.3e-15  # cm^3/(molecule s)\nk_OH_CO = 2.4e-13   # cm^3/(molecule s)\n\n# Calculate lifetimes\ntau_CH4_years = @. 1 / (k_OH_CH4 * OH_range) / (365.25 * 86400)\ntau_CO_days = @. 1 / (k_OH_CO * OH_range) / 86400\n\np6 = plot(\n    OH_range, tau_CH4_years,\n    xlabel = \"[OH] (molecule/cm^3)\",\n    ylabel = \"Methane Lifetime (years)\",\n    title = \"Dependence of Lifetime on OH Concentration\",\n    label = \"CH4\",\n    linewidth = 2,\n    color = :blue,\n    xscale = :log10,\n    yscale = :log10,\n    legend = :topright,\n    size = (700, 500),\n    grid = true\n)\n\n# Create second y-axis plot\np6b = twinx(p6)\nplot!(p6b, OH_range, tau_CO_days,\n    ylabel = \"CO Lifetime (days)\",\n    label = \"CO\",\n    linewidth = 2,\n    color = :red,\n    xscale = :log10,\n    yscale = :log10,\n    legend = :bottomleft)\n\n# Mark typical global mean OH\nvline!(p6, [1e6], label = \"Global mean [OH]\",\n    linestyle = :dash, color = :gray, linewidth = 2)\n\nsavefig(p6, \"oh_sensitivity.png\")\np6\n\nPhysical Interpretation:\n\nLifetime scales inversely with OH concentration (tau propto 1OH)\nA factor of 10 increase in OH leads to a factor of 10 decrease in lifetime\nOH concentrations vary from ~10^5 molecule/cm^3 (remote marine) to ~10^7 molecule/cm^3 (polluted urban)\n","category":"section"},{"location":"AtmosphericLifetime/#Methane-Lifetime-Budget","page":"Atmospheric Lifetime","title":"Methane Lifetime Budget","text":"Methane has multiple removal pathways, making it a good example of applying Eq. 2.7-2.9. The total atmospheric lifetime combines:\n\nTropospheric OH oxidation (~10 years)\nSoil uptake (~150 years)\nStratospheric loss (~120 years)\n\nusing Plots\n\n# Methane removal pathways (lifetimes in years)\ntau_OH = 10.0       # Tropospheric OH reaction\ntau_soil = 150.0    # Soil uptake\ntau_strat = 120.0   # Stratospheric loss\n\n# Calculate combined lifetime using Eq. 2.8\ninverse_tau_total = 1/tau_OH + 1/tau_soil + 1/tau_strat\ntau_total = 1 / inverse_tau_total\n\n# Calculate fractional contributions\nfrac_OH = (1/tau_OH) / inverse_tau_total * 100\nfrac_soil = (1/tau_soil) / inverse_tau_total * 100\nfrac_strat = (1/tau_strat) / inverse_tau_total * 100\n\nprintln(\"Methane Atmospheric Lifetime Analysis\")\nprintln(\"=\" ^ 40)\nprintln(\"Individual pathway lifetimes:\")\nprintln(\"  OH reaction:     $(tau_OH) years\")\nprintln(\"  Soil uptake:     $(tau_soil) years\")\nprintln(\"  Stratospheric:   $(tau_strat) years\")\nprintln()\nprintln(\"Combined total lifetime: $(round(tau_total, digits=1)) years\")\nprintln()\nprintln(\"Removal pathway contributions:\")\nprintln(\"  OH reaction:     $(round(frac_OH, digits=1))%\")\nprintln(\"  Soil uptake:     $(round(frac_soil, digits=1))%\")\nprintln(\"  Stratospheric:   $(round(frac_strat, digits=1))%\")\n\n# Create pie chart of removal contributions\nlabels_pie = [\"OH Reaction\\n($(round(frac_OH, digits=1))%)\",\n    \"Soil Uptake\\n($(round(frac_soil, digits=1))%)\",\n    \"Stratospheric\\n($(round(frac_strat, digits=1))%)\"]\nfracs = [frac_OH, frac_soil, frac_strat]\n\np7 = pie(\n    fracs,\n    label = labels_pie,\n    title = \"Methane Removal Budget\\n(Total lifetime = $(round(tau_total, digits=1)) years)\",\n    color = [:orange, :brown, :purple],\n    size = (600, 500)\n)\n\nsavefig(p7, \"ch4_budget.png\")\np7\n\nKey Result: Despite individual pathway lifetimes ranging from 10 to 150 years, the combined atmospheric lifetime of methane is approximately 8-9 years. This is because the fastest removal process (OH oxidation) dominates the total removal rate.\n\n","category":"section"},{"location":"AtmosphericLifetime/#Summary","page":"Atmospheric Lifetime","title":"Summary","text":"The AtmosphericLifetime module provides a comprehensive implementation of the fundamental atmospheric lifetime equations from Seinfeld and Pandis Chapter 2. Key takeaways:\n\nMass Conservation (Eq. 2.1): The rate of change of atmospheric burden equals sources minus sinks\nLifetime Definition (Eq. 2.3-2.6): Lifetime characterizes the persistence of a species in the atmosphere\nMultiple Pathways (Eq. 2.7-2.9): Parallel removal processes combine via their inverse lifetimes; the fastest process dominates\nOH Oxidation (Eq. 2.12): The OH radical is the primary oxidant determining the lifetime of most reduced species\nTropospheric Budget (Eq. 2.13-2.17): A complete budget includes natural and anthropogenic emissions, chemical production, and multiple removal pathways\n\nThese concepts are essential for understanding air quality, climate forcing by greenhouse gases, and the design of emission control strategies.\n\n","category":"section"},{"location":"AtmosphericLifetime/#API-Reference","page":"Atmospheric Lifetime","title":"API Reference","text":"","category":"section"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime","text":"AtmosphericLifetime\n\nModelingToolkit.jl implementation of atmospheric constituent lifetime equations from: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics, 2nd Edition, Chapter 2: Atmospheric Trace Constituents.\n\nThis module implements:\n\nMass conservation equation (Eq. 2.1)\nSteady-state condition (Eq. 2.2)\nAtmospheric lifetime calculations (Eqs. 2.3-2.6)\nMultiple removal pathway lifetimes (Eqs. 2.7-2.11)\nOH reaction lifetime (Eq. 2.12)\nTropospheric budget equations (Eqs. 2.13-2.17)\n\nReference: Seinfeld, J. H. and Pandis, S. N.: Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, John Wiley & Sons, Inc., Hoboken, New Jersey, 2006, ISBN: 978-0-471-72017-1.\n\n\n\n\n\n","category":"module"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime.AtmosphericBudget","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime.AtmosphericBudget","text":"AtmosphericBudget(; name=:AtmosphericBudget)\n\nImplements the fundamental mass conservation equation for an atmospheric species.\n\nEquation 2.1: dQ/dt = (Fin - Fout) + (P - R)\n\nwhere:\n\nQ: Total mass (or moles) of the species in the reservoir [mol]\nF_in: Rate of mass inflow from outside the reservoir [mol/s]\nF_out: Rate of mass outflow from the reservoir [mol/s]\nP: Rate of chemical production within the reservoir [mol/s]\nR: Rate of chemical removal within the reservoir [mol/s]\n\nThe net rate of change equals the sum of transport (inflow minus outflow) and chemistry (production minus removal) contributions.\n\nEquation 2.2 (Steady State): At steady state, dQ/dt = 0, implying: Fin + P = Fout + R\n\nThis component also computes the net transport and net chemistry terms for diagnostic purposes.\n\n\n\n\n\n","category":"function"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime.SpeciesLifetime","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime.SpeciesLifetime","text":"SpeciesLifetime(; name=:SpeciesLifetime)\n\nCalculates atmospheric lifetime for a species using various formulations.\n\nImplements:\n\nEquation 2.3 (General form): tau = Q / (R + F_out)\n\nThis is the general definition of atmospheric lifetime, applicable to any reservoir with both chemical removal R and outflow F_out.\n\nEquation 2.4 (Global atmosphere, F_out = 0): tau = Q / R\n\nFor the global atmosphere as a whole, there is no outflow to other reservoirs, so the lifetime is determined solely by chemical removal.\n\nEquation 2.5 (Steady state): tau = Q / R = Q / P\n\nAt steady state, R = P (when Fin = Fout = 0 for the global case), so the lifetime can be computed from either the removal or production rate.\n\nEquation 2.6 (First-order removal): tau = 1 / lambda\n\nWhen removal follows first-order kinetics (R = lambda * Q), the lifetime is simply the inverse of the first-order rate constant.\n\nNotes:\n\ntau_general: General lifetime accounting for both removal and outflow\ntau_removal: Lifetime based on removal only (global atmosphere)\ntau_production: Lifetime based on production (steady state)\ntaufirstorder: Lifetime from first-order rate constant\n\n\n\n\n\n","category":"function"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime.MultipleRemovalLifetime","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime.MultipleRemovalLifetime","text":"MultipleRemovalLifetime(; name=:MultipleRemovalLifetime)\n\nCalculates atmospheric lifetime when multiple removal pathways operate in parallel.\n\nImplements:\n\nEquation 2.7 (Two first-order processes): tau = 1 / (k1 + k2)\n\nWhen two independent first-order removal processes operate simultaneously with rate constants k1 and k2, the overall lifetime is determined by their sum.\n\nEquation 2.8 (Inverse lifetime sum): 1/tau = 1/tau1 + 1/tau2\n\nThis is the general form showing that inverse lifetimes (removal rates) are additive for parallel processes.\n\nEquation 2.9 (Combined lifetime formula): tau = (tau1 * tau2) / (tau1 + tau2)\n\nThis follows directly from Eq. 2.8 and gives the combined lifetime in terms of individual pathway lifetimes.\n\nThe component takes two removal rate constants as inputs and computes:\n\ntau1, tau2: Individual pathway lifetimes\ntau_combined: Combined lifetime from all pathways\ninverse_tau: Sum of inverse lifetimes (total removal rate)\n\nThis can be extended to N pathways where: 1/tau = sum(1/tau_i) for i = 1 to N\n\n\n\n\n\n","category":"function"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime.OHReactionLifetime","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime.OHReactionLifetime","text":"OHReactionLifetime(; name=:OHReactionLifetime)\n\nCalculates atmospheric lifetime due to reaction with OH radicals.\n\nImplements Equation 2.12: tau = 1 / (k_OH * [OH])\n\nwhere:\n\nk_OH: Second-order rate constant for reaction with OH [cm^3/(molec*s)]\n[OH]: Concentration of OH radicals [molec/cm^3]\n\nThe OH radical is the primary oxidant in the troposphere for many trace species. The lifetime due to OH reaction depends on both the intrinsic reactivity of the species (k_OH) and the ambient OH concentration.\n\nTypical values:\n\nk_OH: varies widely, e.g., 1e-14 to 1e-10 cm^3/(molec*s)\n[OH]: ~1e6 molec/cm^3 (global tropospheric average)\ntau: seconds to years depending on species\n\nNote: The product k_OH * [OH] gives an effective first-order rate constant with units of s^-1, consistent with Eq. 2.6.\n\n\n\n\n\n","category":"function"},{"location":"AtmosphericLifetime/#GasChem.AtmosphericLifetime.TroposphericBudget","page":"Atmospheric Lifetime","title":"GasChem.AtmosphericLifetime.TroposphericBudget","text":"TroposphericBudget(; name=:TroposphericBudget)\n\nImplements the complete tropospheric budget equation for a trace species.\n\nEquations 2.13-2.14: dQi/dt = Pi^n + Pi^a + Pi^c - (ki^d + ki^w + ki^c + ki^t) * Q_i\n\nThis is the full mass balance for species i in the troposphere, including:\n\nSource terms (production rates in mol/s):\n\nP_n: Natural emissions (biogenic, volcanic, oceanic, etc.)\nP_a: Anthropogenic emissions (combustion, industrial, agricultural, etc.)\nP_c: Chemical production within the troposphere\n\nRemoval terms (first-order rate constants in s^-1):\n\nk_d: Dry deposition (uptake by surfaces)\nk_w: Wet deposition (scavenging by precipitation)\nk_c: Chemical loss (reaction with OH, O3, NO3, etc.)\nk_t: Transport to stratosphere (cross-tropopause flux)\n\nThe total removal rate constant is: ktotal = kd + kw + kc + k_t\n\nEquation 2.15 (Lifetime from removal): taui = 1 / (kd + kw + kc + k_t)\n\nEquation 2.16-2.17 (Lifetime from production at steady state): taui = Qi / (Pn + Pa + P_c)\n\nAt steady state, the removal-based and production-based lifetimes are equal.\n\nThe component computes individual pathway lifetimes for diagnostic purposes:\n\ntau_dry: Lifetime against dry deposition only\ntau_wet: Lifetime against wet deposition only\ntau_chem: Lifetime against chemical loss only\ntau_transport: Lifetime against stratospheric transport only\ntau_total: Total lifetime (Eq. 2.15)\ntau_production: Lifetime from production (Eq. 2.17)\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#Stratospheric-Chemistry","page":"Stratospheric Chemistry","title":"Stratospheric Chemistry","text":"","category":"section"},{"location":"StratosphericChemistry/#Overview","page":"Stratospheric Chemistry","title":"Overview","text":"The stratosphere, extending from approximately 10-50 km altitude, contains the ozone layer that shields the Earth's surface from harmful ultraviolet radiation. This module implements the fundamental chemistry governing stratospheric ozone based on Chapter 5 of Seinfeld & Pandis (2006).","category":"section"},{"location":"StratosphericChemistry/#The-Chapman-Mechanism","page":"Stratospheric Chemistry","title":"The Chapman Mechanism","text":"The Chapman mechanism (Chapman, 1930) describes the basic photochemical production and destruction of ozone in the stratosphere through four key reactions:\n\nO2 Photolysis: O2 + hv -> O + O (j_O2)\nOzone Formation: O + O2 + M -> O3 + M (k2)\nOzone Photolysis: O3 + hv -> O + O2 (j_O3)\nOzone Destruction: O + O3 -> O2 + O2 (k4)\n\nWhile the Chapman mechanism predicts the qualitative features of the ozone layer, it overestimates ozone concentrations by roughly a factor of two. This discrepancy is resolved by including catalytic destruction cycles involving NOx, HOx, ClOx, and BrOx species.","category":"section"},{"location":"StratosphericChemistry/#Catalytic-Ozone-Destruction","page":"Stratospheric Chemistry","title":"Catalytic Ozone Destruction","text":"Catalytic cycles destroy ozone through the general mechanism:\n\nX + O3 -> XO + O2\nXO + O -> X + O2\n-----------------\nNet: O3 + O -> 2 O2\n\nwhere X represents the catalyst (NO, OH, Cl, Br). These cycles are highly efficient because the catalyst is regenerated and can destroy many ozone molecules before being removed.","category":"section"},{"location":"StratosphericChemistry/#N2O-as-the-Primary-NOx-Source","page":"Stratospheric Chemistry","title":"N2O as the Primary NOx Source","text":"Nitrous oxide (N2O) transported from the troposphere is the primary source of stratospheric NOx through its reaction with excited atomic oxygen O(1D) (Section 5.3.1):\n\nN2O + O(1D) -> NO + NO    (k = 6.7 × 10⁻¹¹ cm³/molec/s)\nN2O + O(1D) -> N2 + O2    (k = 4.9 × 10⁻¹¹ cm³/molec/s)\n\nThe NO yield is approximately 58% (6.7/(6.7+4.9)), consistent with Equation 5.18.\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons, Chapter 5, pp. 138-203.","category":"section"},{"location":"StratosphericChemistry/#Exported-Functions","page":"Stratospheric Chemistry","title":"Exported Functions","text":"","category":"section"},{"location":"StratosphericChemistry/#Implementation","page":"Stratospheric Chemistry","title":"Implementation","text":"The implementation uses ModelingToolkit.jl to define ODE systems for each chemical cycle. All rate coefficients are embedded as @constants with Arrhenius parameters within each component, ensuring that temperature-dependent rate computation is handled symbolically by ModelingToolkit. This allows for symbolic manipulation of the equations, automatic Jacobian generation, and efficient numerical integration.","category":"section"},{"location":"StratosphericChemistry/#Chapman-Mechanism-System","page":"Stratospheric Chemistry","title":"Chapman Mechanism System","text":"using GasChem\nusing ModelingToolkit\nusing ModelingToolkit: t\nusing DynamicQuantities\nusing Symbolics\nusing DataFrames\n\nsys = ChapmanMechanism()\nnothing # hide","category":"section"},{"location":"StratosphericChemistry/#State-Variables","page":"Stratospheric Chemistry","title":"State Variables","text":"vars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"StratosphericChemistry/#Parameters","page":"Stratospheric Chemistry","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"StratosphericChemistry/#Equations","page":"Stratospheric Chemistry","title":"Equations","text":"The Chapman mechanism is governed by coupled differential equations for atomic oxygen O and ozone O3:\n\nequations(sys)","category":"section"},{"location":"StratosphericChemistry/#Comprehensive-Stratospheric-System","page":"Stratospheric Chemistry","title":"Comprehensive Stratospheric System","text":"The full stratospheric system combines all catalytic cycles:\n\nusing GasChem\nusing ModelingToolkit\nusing ModelingToolkit: t\nusing DynamicQuantities\nusing Symbolics\nusing DataFrames\n\nsys_full = StratosphericOzoneSystem()\nnothing # hide","category":"section"},{"location":"StratosphericChemistry/#All-Species","page":"Stratospheric Chemistry","title":"All Species","text":"vars = unknowns(sys_full)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"StratosphericChemistry/#Parameters-2","page":"Stratospheric Chemistry","title":"Parameters","text":"params = parameters(sys_full)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"StratosphericChemistry/#Equations-2","page":"Stratospheric Chemistry","title":"Equations","text":"The full stratospheric system consists of 15 ODEs and 5 algebraic family definitions:\n\nequations(sys_full)","category":"section"},{"location":"StratosphericChemistry/#Analysis","page":"Stratospheric Chemistry","title":"Analysis","text":"This section demonstrates the behavior of the implemented systems and reproduces key results from Chapter 5 of Seinfeld & Pandis.","category":"section"},{"location":"StratosphericChemistry/#Table-5.1:-Stratospheric-Conditions","page":"Stratospheric Chemistry","title":"Table 5.1: Stratospheric Conditions","text":"The following table reproduces the standard atmospheric conditions used throughout Chapter 5:\n\nusing DataFrames\n\n# Table 5.1 from Seinfeld & Pandis (2006), page 142\naltitudes = [20, 25, 30, 35, 40, 45]  # km\ntemperatures = [217, 222, 227, 237, 251, 265]  # K\npressures_hPa = [55, 25, 12, 5.6, 2.8, 1.4]  # hPa\np_over_p0 = [0.054, 0.025, 0.012, 0.0055, 0.0028, 0.0014]\nM_values = [1.4e18, 6.4e17, 3.1e17, 1.4e17, 7.1e16, 3.6e16]  # molec/cm^3\n\n# SI number densities for use in later analysis sections\nM_SI = M_values .* 1e6  # molec/cm^3 → molec/m^3\n\n# CGS to SI conversion factors\nCGS_TO_SI_K2 = 1e-12  # cm^6/molec^2/s → m^6/s\nCGS_TO_SI_K = 1e-6    # cm^3/molec/s → m^3/s\n\n# Analytical rate coefficient functions from textbook Tables B.1/B.2 (CGS → SI)\nk_O_O2_M_si(T) = 6.0e-34 * (T / 300.0)^(-2.4) * CGS_TO_SI_K2\nk_O_O3_si(T) = 8.0e-12 * exp(-2060.0 / T) * CGS_TO_SI_K\nk_NO2_O_si(T) = 5.6e-12 * exp(180.0 / T) * CGS_TO_SI_K\nk_OH_O3_si(T) = 1.7e-12 * exp(-940.0 / T) * CGS_TO_SI_K\nk_ClO_O_si(T) = 3.0e-11 * exp(70.0 / T) * CGS_TO_SI_K\nk_Br_O3_si(T) = 1.7e-11 * exp(-800.0 / T) * CGS_TO_SI_K\n\ntable51 = DataFrame(\n    Symbol(\"z (km)\") => altitudes,\n    Symbol(\"T (K)\") => temperatures,\n    Symbol(\"p (hPa)\") => pressures_hPa,\n    Symbol(\"p/p₀\") => p_over_p0,\n    Symbol(\"[M] (molec/cm³)\") => M_values\n)","category":"section"},{"location":"StratosphericChemistry/#Table-5.2:-Chemical-Families-in-Stratospheric-Chemistry","page":"Stratospheric Chemistry","title":"Table 5.2: Chemical Families in Stratospheric Chemistry","text":"Table 5.2 from Seinfeld & Pandis (2006) summarizes the chemical families that are important in stratospheric chemistry:\n\ntable52 = DataFrame(\n    :Symbol => [\"Oₓ\", \"NOₓ\", \"NOᵧ\", \"HOₓ\", \"Clᵧ\", \"ClOₓ\", \"Brᵧ\"],\n    :Name => [\"Odd oxygen\", \"Nitrogen oxides\", \"Oxidized nitrogen\",\n        \"Hydrogen radicals\", \"Inorganic chlorine\", \"Reactive chlorine\",\n        \"Inorganic bromine\"],\n    :Components => [\n        \"O + O3\",\n        \"NO + NO2\",\n        \"NO + NO2 + HNO3 + 2N2O5 + ClONO2 + NO3 + HOONO2 + BrONO2\",\n        \"OH + HO2\",\n        \"Cl + 2Cl2 + ClO + OClO + 2Cl2O2 + HOCl + ClONO2 + HCl + BrCl\",\n        \"Cl + ClO\",\n        \"Br + BrO + HOBr + BrONO2\"\n    ]\n)","category":"section"},{"location":"StratosphericChemistry/#Rate-Coefficients-vs-Altitude","page":"Stratospheric Chemistry","title":"Rate Coefficients vs Altitude","text":"The rate coefficients for the Chapman mechanism vary with altitude due to their temperature dependence:\n\nusing Plots\n\nk2_values = [k_O_O2_M_si(T) for T in temperatures]\nk4_values = [k_O_O3_si(T) for T in temperatures]\n\np1 = plot(altitudes, k2_values,\n    xlabel = \"Altitude (km)\",\n    ylabel = \"k₂ (m⁶ s⁻¹)\",\n    label = \"k2: O + O2 + M\",\n    marker = :circle,\n    title = \"Temperature Dependence of Rate Coefficients\",\n    legend = :topright)\n\np2 = plot(altitudes, k4_values,\n    xlabel = \"Altitude (km)\",\n    ylabel = \"k₄ (m³ s⁻¹)\",\n    label = \"k4: O + O3\",\n    marker = :square,\n    color = :red,\n    legend = :topleft)\n\nplot(p1, p2, layout = (1, 2), size = (800, 350))","category":"section"},{"location":"StratosphericChemistry/#[O]/[O3]-Ratio-(Equation-5.7)","page":"Stratospheric Chemistry","title":"[O]/[O3] Ratio (Equation 5.7)","text":"The steady-state ratio of atomic oxygen to ozone is given by Equation 5.7:\n\nfracOO_3 = fracj_O_3k_2O_2M\n\nThis ratio increases with altitude due to decreasing air density M:\n\nusing Plots\n\nj_O3 = 4e-4  # s^-1 (typical midday value around 30 km)\nO2_frac = 0.21\n\nO_O3_ratios = Float64[]\nfor (i, T) in enumerate(temperatures)\n    M = M_SI[i]\n    k2 = k_O_O2_M_si(T)  # m^6/s (SI)\n    O2 = O2_frac * M\n    ratio = j_O3 / (k2 * O2 * M)\n    push!(O_O3_ratios, ratio)\nend\n\nplot(altitudes, O_O3_ratios,\n    xlabel = \"Altitude (km)\",\n    ylabel = \"[O]/[O3]\",\n    label = \"Equation 5.7\",\n    marker = :circle,\n    yscale = :log10,\n    title = \"Steady-State [O]/[O3] Ratio vs Altitude\",\n    legend = :bottomright)\n\nThe [O]/[O3] ratio increases from approximately 10^-7 at 20 km to 10^-5 at 45 km, consistent with the discussion on page 144 of Seinfeld & Pandis.","category":"section"},{"location":"StratosphericChemistry/#Steady-State-Ozone-(Equation-5.13)","page":"Stratospheric Chemistry","title":"Steady-State Ozone (Equation 5.13)","text":"The Chapman mechanism predicts a steady-state ozone concentration given by Equation 5.13:\n\nO_3_ss = 021 times sqrtfrack_2 cdot j_O_2k_4 cdot j_O_3 times M^32\n\nusing Plots\n\nj_O2_values = [1e-12, 5e-12, 1e-11, 2e-11, 3e-11, 4e-11]  # Increases with altitude\nj_O3_values = [2e-4, 3e-4, 4e-4, 5e-4, 6e-4, 7e-4]  # s^-1\n\nO3_ss = Float64[]\nfor (i, T) in enumerate(temperatures)\n    M = M_SI[i]  # SI: m^-3\n    k2 = k_O_O2_M_si(T)  # SI: m^6/s\n    k4 = k_O_O3_si(T)    # SI: m^3/s\n    j_O2 = j_O2_values[i]\n    j_O3 = j_O3_values[i]\n\n    O3 = 0.21 * sqrt(k2 * j_O2 / (k4 * j_O3)) * M^1.5  # SI: m^-3\n    push!(O3_ss, O3)\nend\n\n# Convert SI m^-3 to CGS molec/cm^3 for display (÷ 1e6)\nplot(O3_ss ./ 1e6 ./ 1e12, altitudes,\n    ylabel = \"Altitude (km)\",\n    xlabel = \"[O3] (10¹² molec/cm³)\",\n    label = \"Chapman prediction (Eq. 5.13)\",\n    marker = :circle,\n    title = \"Steady-State Ozone Profile\",\n    legend = :topright)","category":"section"},{"location":"StratosphericChemistry/#Time-to-Steady-State-(Equation-5.17)","page":"Stratospheric Chemistry","title":"Time to Steady State (Equation 5.17)","text":"The characteristic time for ozone to reach steady state is given by Equation 5.17:\n\ntau_O_3^ss = frac14 sqrtfrack_2Mk_4 cdot j_O_2 cdot j_O_3\n\nusing Plots\n\ntau_ss = Float64[]\nfor (i, T) in enumerate(temperatures)\n    M = M_SI[i]  # SI: m^-3\n    k2 = k_O_O2_M_si(T)  # SI: m^6/s\n    k4 = k_O_O3_si(T)    # SI: m^3/s\n    j_O2 = j_O2_values[i]\n    j_O3 = j_O3_values[i]\n\n    tau = 0.25 * sqrt(k2 * M / (k4 * j_O2 * j_O3))\n    push!(tau_ss, tau)\nend\n\ntau_days = tau_ss ./ (24 * 3600)\n\nplot(tau_days, altitudes,\n    ylabel = \"Altitude (km)\",\n    xlabel = \"Time to steady state (days)\",\n    label = \"Equation 5.17\",\n    marker = :circle,\n    xscale = :log10,\n    title = \"Ozone Steady-State Timescale\",\n    legend = :topright)\n\nAt 40 km, the ozone steady-state timescale is on the order of hours, while at 20 km it can take months to years. This explains why the ozone layer responds quickly to perturbations at higher altitudes but slowly at lower altitudes.","category":"section"},{"location":"StratosphericChemistry/#Chapman-Mechanism-Simulation","page":"Stratospheric Chemistry","title":"Chapman Mechanism Simulation","text":"We can solve the Chapman mechanism ODE system to observe the approach to steady state:\n\nusing GasChem\nusing ModelingToolkit\nusing OrdinaryDiffEqDefault\nusing Plots\n\nchapman = ChapmanMechanism()\nsys = mtkcompile(chapman)\n\n# Parameters for 30 km altitude (Table 5.1)\nT_val = 227.0  # K\nM_30km = 3.1e23  # m^-3 (3.1e17 molec/cm^3 × 1e6)\n\nj_O2_val = 1e-11  # s^-1\nj_O3_val = 4e-4   # s^-1\n\nprob = ODEProblem(sys,\n    [sys.O => 1e11, sys.O3 => 1e16,  # SI: m^-3\n        sys.j_O2 => j_O2_val,\n        sys.j_O3 => j_O3_val,\n        sys.T => T_val,\n        sys.M => M_30km,\n        sys.O2_mix => 0.21],\n    (0.0, 3600.0 * 24 * 10))  # 10 days\n\nsol = solve(prob, abstol = 1e-8, reltol = 1e-8)\n\ntime_hours = sol.t ./ 3600\n\n# Convert SI m^-3 back to CGS molec/cm^3 for display (÷ 1e6)\np1 = plot(time_hours, sol[sys.O3] ./ 1e6 ./ 1e12,\n    xlabel = \"Time (hours)\",\n    ylabel = \"[O3] (10¹² molec/cm³)\",\n    label = \"O3\",\n    title = \"Chapman Mechanism: Approach to Steady State (30 km)\")\n\np2 = plot(time_hours, sol[sys.O] ./ 1e6,\n    xlabel = \"Time (hours)\",\n    ylabel = \"[O] (molec/cm³)\",\n    label = \"O\",\n    color = :red,\n    title = \"Atomic Oxygen\")\n\nplot(p1, p2, layout = (2, 1), size = (700, 500))","category":"section"},{"location":"StratosphericChemistry/#Catalytic-Cycle-Contributions-to-Ozone-Loss","page":"Stratospheric Chemistry","title":"Catalytic Cycle Contributions to Ozone Loss","text":"The catalytic cycles (NOx, HOx, ClOx, BrOx) each contribute to ozone destruction at different rates depending on altitude. The relative importance of each cycle varies with altitude, as shown in Figure 5.29 of Seinfeld & Pandis.\n\nAt lower stratospheric altitudes (15-25 km), the HOx cycle dominates ozone loss. At middle altitudes (25-40 km), the NOx cycle becomes most important. The ClOx cycle contributes significantly at all altitudes and is particularly important in the polar regions where heterogeneous chemistry activates chlorine reservoirs.\n\nThe following figure computes the relative destruction rates at each altitude, assuming typical species mixing ratios from the textbook:\n\nusing Plots\n\n# Compute catalytic destruction rates\n# Using typical stratospheric mixing ratios from Chapter 5\n# All concentrations in SI (m^-3)\n\n# Typical mixing ratios (from text)\nNO2_vmr = 5e-9   # 5 ppbv\nOH_vmr = 5e-7    # 0.5 pptv — very low\nClO_vmr = 1e-10  # ~100 pptv\nBrO_vmr = 5e-12  # ~5 pptv\n\n# Reference values in SI for scaling (30 km)\nM_ref_si = M_SI[3]\n\nnox_rates = Float64[]\nhox_rates = Float64[]\nclox_rates = Float64[]\nbrox_rates = Float64[]\nchapman_rates = Float64[]\n\nfor (i, T) in enumerate(temperatures)\n    M = M_SI[i]  # SI: m^-3\n    O_conc = 1e13 * (M_ref_si / M)     # Scale O with inverse density (SI: m^-3)\n    O3_conc = 3e18 * (M / M_ref_si)    # Scale O3 with density (SI: m^-3)\n\n    NO2 = NO2_vmr * M\n    OH = OH_vmr * M\n    ClO = ClO_vmr * M\n    BrO = BrO_vmr * M\n\n    # Destruction rates (from Seinfeld & Pandis Eqs. 5.22, 5.25, 5.29)\n    k_NO2_O_val = k_NO2_O_si(T)   # SI: m^3/s\n    k_OH_O3_val = k_OH_O3_si(T)\n    k_ClO_O_val = k_ClO_O_si(T)\n    k_Br_O3_val = k_Br_O3_si(T)\n    k4 = k_O_O3_si(T)\n\n    R_NOx = 2 * k_NO2_O_val * NO2 * O_conc\n    R_HOx = 2 * k_OH_O3_val * OH * O3_conc\n    R_ClOx = 2 * k_ClO_O_val * ClO * O_conc\n    R_BrOx = 2 * k_Br_O3_val * BrO * O3_conc\n    R_chapman = 2 * k4 * O_conc * O3_conc\n\n    total = R_NOx + R_HOx + R_ClOx + R_BrOx + R_chapman\n    push!(nox_rates, 100 * R_NOx / total)\n    push!(hox_rates, 100 * R_HOx / total)\n    push!(clox_rates, 100 * R_ClOx / total)\n    push!(brox_rates, 100 * R_BrOx / total)\n    push!(chapman_rates, 100 * R_chapman / total)\nend\n\nplot(nox_rates, altitudes,\n    label = \"NOx\",\n    xlabel = \"Contribution to O3 Loss (%)\",\n    ylabel = \"Altitude (km)\",\n    title = \"Catalytic Cycle Contributions (cf. Figure 5.29)\",\n    linewidth = 2,\n    legend = :topright)\nplot!(hox_rates, altitudes, label = \"HOx\", linewidth = 2)\nplot!(clox_rates, altitudes, label = \"ClOx\", linewidth = 2)\nplot!(brox_rates, altitudes, label = \"BrOx\", linewidth = 2)\nplot!(chapman_rates, altitudes, label = \"Chapman (O+O3)\", linewidth = 2, linestyle = :dash)","category":"section"},{"location":"StratosphericChemistry/#NOx-Catalytic-Efficiency","page":"Stratospheric Chemistry","title":"NOx Catalytic Efficiency","text":"The NOx cycle destroys odd oxygen at the rate (Equation 5.22):\n\nfracdO_xdt = -2k_2NO_2O\n\nThe efficiency of the NOx cycle can be estimated by comparing this destruction rate to the Chapman mechanism rate:\n\nusing Plots\n\nNO2_mix = 1e-9  # 1 ppbv\nO_mix = 1e-11   # varies strongly with altitude\n\nratios = Float64[]\nfor (i, T) in enumerate(temperatures)\n    M = M_SI[i]  # SI: m^-3\n    k4 = k_O_O3_si(T)      # SI: m^3/s\n    k_NO2_O_val = k_NO2_O_si(T)  # SI: m^3/s\n\n    O = O_mix * M\n    O3 = 3e18  # SI: m^-3 (3e12 molec/cm^3 × 1e6)\n    NO2 = NO2_mix * M\n\n    R_chapman = k4 * O * O3\n    R_NOx = k_NO2_O_val * NO2 * O\n\n    push!(ratios, R_NOx / R_chapman)\nend\n\nplot(altitudes, ratios,\n    xlabel = \"Altitude (km)\",\n    ylabel = \"NOx/Chapman Rate Ratio\",\n    label = \"Rate ratio\",\n    marker = :circle,\n    title = \"NOx Cycle Efficiency Relative to Chapman\",\n    legend = :topleft,\n    yscale = :log10)","category":"section"},{"location":"StratosphericChemistry/#Chlorine-Reservoir-Partitioning","page":"Stratospheric Chemistry","title":"Chlorine Reservoir Partitioning","text":"In the stratosphere, most chlorine exists in reservoir species (HCl and ClONO2) rather than reactive forms (Cl and ClO). The partitioning between these species is crucial for understanding ozone depletion.\n\nThe following figure uses the ClOx cycle system from the implementation to simulate the approach to steady-state partitioning:\n\nusing GasChem\nusing ModelingToolkit\nusing OrdinaryDiffEqDefault\nusing Plots\n\n# Run ClOx system at different altitudes and examine the partitioning\nsys = ClOxCycle()\ncompiled = mtkcompile(sys)\n\n# Compute partitioning at a representative altitude (30 km)\n# CGS→SI: 1 cm^-3 = 1e6 m^-3\nCly_total = 2e15  # Total Cly in SI m^-3 (2e9 molec/cm^3 × 1e6)\n\nprob = ODEProblem(compiled,\n    [compiled.Cl => 1e10, compiled.ClO => 1e13,\n        compiled.HCl => 1e15, compiled.ClONO2 => Cly_total - 1e10 - 1e13 - 1e15],\n    (0.0, 3600.0 * 24)  # 1 day\n)\n\nsol = solve(prob, abstol = 1e-8, reltol = 1e-8)\n\ntime_hours = sol.t ./ 3600\n\nCly = sol[compiled.Cl] .+ sol[compiled.ClO] .+ sol[compiled.HCl] .+ sol[compiled.ClONO2]\nHCl_frac = sol[compiled.HCl] ./ Cly\nClONO2_frac = sol[compiled.ClONO2] ./ Cly\nClOx_frac = (sol[compiled.Cl] .+ sol[compiled.ClO]) ./ Cly\n\nplot(time_hours, HCl_frac, label = \"HCl/Cly\", linewidth = 2,\n    xlabel = \"Time (hours)\", ylabel = \"Fraction of Cly\",\n    title = \"Chlorine Reservoir Partitioning (30 km)\",\n    legend = :right)\nplot!(time_hours, ClONO2_frac, label = \"ClONO2/Cly\", linewidth = 2)\nplot!(time_hours, ClOx_frac, label = \"ClOx/Cly\", linewidth = 2)\n\nThe reactive chlorine species (ClOx = Cl + ClO) constitute only a small fraction of total inorganic chlorine (Cly) under normal conditions. However, heterogeneous reactions on polar stratospheric clouds can rapidly convert HCl and ClONO2 to reactive forms, leading to severe ozone depletion in polar regions (the \"ozone hole\").","category":"section"},{"location":"StratosphericChemistry/#Summary","page":"Stratospheric Chemistry","title":"Summary","text":"This module provides a comprehensive implementation of stratospheric ozone chemistry based on the well-established theory presented in Seinfeld & Pandis (2006). The key features include:\n\nChapman Mechanism: Fundamental O2/O3 photochemistry with temperature-dependent rate coefficients\nCatalytic Cycles: NOx, HOx, ClOx, and BrOx destruction mechanisms\nChemical Families: Tracking of Ox, NOx, HOx, ClOx, and BrOx families\nN2O Source Chemistry: N2O + O(1D) as the primary source of stratospheric NOx (Section 5.3.1)\nO(1D) Photochemistry: Including reactions with H2O, CH4, and N2O\nRate Coefficients: All Arrhenius parameters embedded as @constants within ModelingToolkit components","category":"section"},{"location":"StratosphericChemistry/#GasChem.ChapmanMechanism","page":"Stratospheric Chemistry","title":"GasChem.ChapmanMechanism","text":"ChapmanMechanism(; name=:ChapmanMechanism)\n\nCreate a ModelingToolkit System for the Chapman mechanism.\n\nThe Chapman mechanism describes the basic production and destruction of ozone in the stratosphere through photolysis of O2 and subsequent reactions.\n\nReactions (Section 5.2, Seinfeld & Pandis 2006):\n\nO2 + hν → O + O                    (j_O2)\nO + O2 + M → O3 + M                (k2)\nO3 + hν → O + O2                   (j_O3)\nO + O3 → O2 + O2                   (k4)\n\nRate Equations (Equations 5.1-5.2):\n\nd[O]/dt = 2jO2[O2] - k2[O][O2][M] + jO3[O3] - k4[O][O3] d[O3]/dt = k2[O][O2][M] - j_O3[O3] - k4[O][O3]\n\nSteady-State Ozone (Equation 5.13):\n\n[O3]ss = 0.21 × (k2 × jO2 / (k4 × j_O3))^(1/2) × [M]^(3/2)\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#GasChem.NOxCycle","page":"Stratospheric Chemistry","title":"GasChem.NOxCycle","text":"NOxCycle(; name=:NOxCycle)\n\nCreate a ModelingToolkit System for the NOx catalytic ozone destruction cycle.\n\nNOx Cycle 1 (Section 5.3.2, Page 154):\n\nNO + O3 → NO2 + O2     (k1 = 3.0 × 10⁻¹² exp(-1500/T) cm³/molec/s) NO2 + O → NO + O2      (k2 = 5.6 × 10⁻¹² exp(180/T) cm³/molec/s) Net: O3 + O → O2 + O2\n\nSteady-State (Equation 5.20):\n\n0 = k1[NO][O3] - j_NO2[NO2] - k2[NO2][O]\n\nRate of Odd Oxygen Destruction (Equation 5.22):\n\nd[Ox]/dt = -2 k2[NO2][O]\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#GasChem.HOxCycle","page":"Stratospheric Chemistry","title":"GasChem.HOxCycle","text":"HOxCycle(; name=:HOxCycle)\n\nCreate a ModelingToolkit System for the HOx catalytic ozone destruction cycle.\n\nHOx Cycle 1 (Page 159):\n\nOH + O3 → HO2 + O2 HO2 + O → OH + O2 Net: O3 + O → O2 + O2\n\nHOx Cycle 2 (Page 159):\n\nOH + O3 → HO2 + O2 HO2 + O3 → OH + O2 + O2 Net: O3 + O3 → O2 + O2 + O2\n\nSteady-State Ratio (Equation 5.28):\n\n[HO2]/[OH] = kOH+O3[O3] / (kHO2+NO[NO])\n\nRate of Odd Oxygen Destruction (Equation 5.27):\n\nd[Ox]/dt = -2 kHO2+O3[HO2][O3] - 2 kHO2+O[HO2][O]\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#GasChem.ClOxCycle","page":"Stratospheric Chemistry","title":"GasChem.ClOxCycle","text":"ClOxCycle(; name=:ClOxCycle)\n\nCreate a ModelingToolkit System for the ClOx catalytic ozone destruction cycle.\n\nClOx Cycle 1 (Section 5.5.1, Page 162):\n\nCl + O3 → ClO + O2    (k1 = 2.3 × 10⁻¹¹ exp(-200/T) cm³/molec/s) ClO + O → Cl + O2     (k2 = 3.0 × 10⁻¹¹ exp(70/T) cm³/molec/s) Net: O3 + O → O2 + O2\n\nRate of Odd Oxygen Destruction (Equation 5.29):\n\nd[Ox]/dt = -2 k2[ClO][O]\n\nSteady-State [Cl]/[ClO] Ratio (Equation 5.30):\n\n[Cl]/[ClO] = (kClO+O[O] + kClO+NO[NO]) / (k_Cl+O3[O3])\n\nReservoir Species (Section 5.6):\n\nHCl formed by Cl + CH4 → HCl + CH3\nClONO2 formed by ClO + NO2 + M → ClONO2 + M\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#GasChem.BrOxCycle","page":"Stratospheric Chemistry","title":"GasChem.BrOxCycle","text":"BrOxCycle(; name=:BrOxCycle)\n\nCreate a ModelingToolkit System for the BrOx catalytic ozone destruction cycle.\n\nBromine is approximately 50 times more effective than chlorine in destroying ozone on an atom-for-atom basis (Page 169).\n\nKey Reactions (Section 5.5.2, Page 166):\n\nBr + O3 → BrO + O2    (k = 1.7 × 10⁻¹¹ exp(-800/T) cm³/molec/s) BrO + O → Br + O2 BrO + ClO → Br + Cl + O2  (or BrCl + O2) BrO + HO2 → HOBr + O2\n\nNote on Reservoir Species (Page 169):\n\nUnlike chlorine, bromine does not form a stable HBr reservoir because Br + CH4 is endothermic and extremely slow.\n\n\n\n\n\n","category":"function"},{"location":"StratosphericChemistry/#GasChem.StratosphericOzoneSystem","page":"Stratospheric Chemistry","title":"GasChem.StratosphericOzoneSystem","text":"StratosphericOzoneSystem(; name=:StratosphericOzoneSystem)\n\nCreate a comprehensive ModelingToolkit System combining all stratospheric ozone chemistry cycles.\n\nThis system includes:\n\nChapman mechanism (O, O3 production and loss)\nO(¹D) photochemistry including O(¹D) + H2O and O(¹D) + CH4\nN2O + O(¹D) → 2NO as the NOx source (Section 5.3.1)\nNOx cycle (catalytic O3 destruction)\nHOx cycle (catalytic O3 destruction)\nClOx cycle (catalytic O3 destruction)\nBrOx cycle (catalytic O3 destruction)\n\nAll rate coefficients are temperature-dependent, computed from Arrhenius parameters defined as @constants.\n\nKey Equations from Seinfeld & Pandis Chapter 5:\n\nOdd Oxygen Balance (Equation 5.9):\n\nd[Ox]/dt = 2j_O2[O2] - 2k4[O][O3]\n\nSteady-State O3 (Equation 5.13):\n\n[O3]ss = 0.21 × (k2 × jO2 / (k4 × j_O3))^(1/2) × [M]^(3/2)\n\n[O]/[O3] Ratio (Equation 5.7):\n\n[O]/[O3] = j_O3 / (k2[O2][M])\n\nTime to Steady State (Equation 5.17):\n\nτO3^ss = (1/4) × (k2[M] / (k4 × jO2 × j_O3))^(1/2)\n\nNO Yield from N2O (Equation 5.18, Section 5.3.1):\n\nN2O + O(¹D) → NO + NO (k = 6.7 × 10⁻¹¹ cm³/molec/s) N2O + O(¹D) → N2 + O2 (k = 4.9 × 10⁻¹¹ cm³/molec/s)\n\n\n\n\n\n","category":"function"},{"location":"co_oxidation/#co_oxidation","page":"CO Oxidation","title":"CO Oxidation","text":"","category":"section"},{"location":"co_oxidation/#Overview","page":"CO Oxidation","title":"Overview","text":"CO oxidation is the simplest hydrocarbon oxidation mechanism and illustrates the fundamental HOx cycling that drives tropospheric ozone production. The net reaction is:\n\nCO + 2O2 + hv -> CO2 + O3\n\nThe key feature is that OH is regenerated through the HO2 + NO reaction, allowing catalytic ozone production. The HOx chain length (number of OH-HO2 cycles before termination) and the Ozone Production Efficiency (OPE = moles O3 produced per mole NOx consumed) are key diagnostics.\n\nTwo components are provided:\n\nCOOxidation: Full CO oxidation diagnostic system (Eqs. 6.9-6.17)\nOzoneProductionEfficiency: OPE diagnostic (Eqs. 6.21-6.24)\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Section 6.3, pp. 212-219.","category":"section"},{"location":"co_oxidation/#Implementation","page":"CO Oxidation","title":"Implementation","text":"","category":"section"},{"location":"co_oxidation/#COOxidation:-State-Variables","page":"CO Oxidation","title":"COOxidation: State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, GasChem\n\nsys = COOxidation()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"co_oxidation/#COOxidation:-Parameters","page":"CO Oxidation","title":"COOxidation: Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"co_oxidation/#COOxidation:-Equations","page":"CO Oxidation","title":"COOxidation: Equations","text":"eqs = equations(sys)","category":"section"},{"location":"co_oxidation/#OzoneProductionEfficiency:-State-Variables","page":"CO Oxidation","title":"OzoneProductionEfficiency: State Variables","text":"ope_sys = OzoneProductionEfficiency()\nvars_ope = unknowns(ope_sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars_ope],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars_ope],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars_ope]\n)","category":"section"},{"location":"co_oxidation/#OzoneProductionEfficiency:-Equations","page":"CO Oxidation","title":"OzoneProductionEfficiency: Equations","text":"equations(ope_sys)","category":"section"},{"location":"co_oxidation/#Analysis","page":"CO Oxidation","title":"Analysis","text":"","category":"section"},{"location":"co_oxidation/#Figure-6.3:-OPE-vs-NOx-for-CO-Oxidation","page":"CO Oxidation","title":"Figure 6.3: OPE vs NOx for CO Oxidation","text":"Figure 6.3 of Seinfeld & Pandis shows the ozone production efficiency (OPE) for atmospheric CO oxidation at 298 K at the Earth's surface as a function of the NOx (NO + NO2) level. The conditions are: P_HO_x = 1 ppt s⁻¹, NONO_2 = 01, and CO mixing ratio of 200 ppb.\n\nOPE is computed from Eqs. 6.10, 6.23, and 6.22 by solving the quadratic equation for [HO2] (Eq. 6.23 combined with 6.10) and then computing OPE = P(O3) / L(NOx). The COOxidation and OzoneProductionEfficiency systems are used to compute the diagnostics.\n\nusing Plots, NonlinearSolve\n\n# Use the OPE system for computing OPE from given concentrations\nope_nns = ModelingToolkit.toggle_namespacing(ope_sys, false)\nope_inputs = [ope_nns.OH, ope_nns.HO2, ope_nns.RO2, ope_nns.NO, ope_nns.NO2]\nope_compiled = mtkcompile(ope_sys; inputs = ope_inputs)\n\n# Extract rate constants from the COOxidation system parameters for the quadratic solve\n# (Eqs. 6.10 and 6.23 require solving for HO2 analytically before using the system)\nk_CO_OH = Float64(ModelingToolkit.getdefault(sys.k_CO_OH))\nk_HO2_NO = Float64(ModelingToolkit.getdefault(sys.k_HO2_NO))\nk_HO2_HO2 = Float64(ModelingToolkit.getdefault(sys.k_HO2_HO2))\nk_OH_NO2 = Float64(ModelingToolkit.getdefault(sys.k_OH_NO2))\n\n# Conditions from Figure 6.3 caption (working in SI: m⁻³)\nM_val = 2.5e25              # total air at surface [m⁻³]\nCO_val = 200e-9 * M_val     # 200 ppb CO [m⁻³]\nNO_NO2_ratio = 0.1          # [NO]/[NO₂] = 0.1\nP_HOx = 1e-12 * M_val       # 1 ppt/s [m⁻³/s]\n\n# Vary NOx from 1 ppt to 10⁶ ppt (= 1 ppm)\nNOx_ppt = 10 .^ range(0, 6, length = 300)\nNOx = NOx_ppt .* 1e-12 .* M_val\n\n# Partition NOx\nNO2_vals = NOx ./ (1 + NO_NO2_ratio)\nNO_vals = NO_NO2_ratio .* NO2_vals\n\n# Solve quadratic for [HO2] from Eqs. 6.10 and 6.23\na_vals = 2 .* k_HO2_HO2 .* (1 .+ k_OH_NO2 .* NO2_vals ./ (k_CO_OH .* CO_val))\nb_vals = k_HO2_NO .* k_OH_NO2 .* NO2_vals .* NO_vals ./ (k_CO_OH .* CO_val)\nc_val = -P_HOx\n\nHO2_vals = (-b_vals .+ sqrt.(b_vals .^ 2 .- 4 .* a_vals .* c_val)) ./ (2 .* a_vals)\nOH_vals = (P_HOx .- 2 .* k_HO2_HO2 .* HO2_vals .^ 2) ./ (k_OH_NO2 .* NO2_vals)\n\n# Compute OPE using the OPE system\nOPE_vals = Float64[]\nprob = NonlinearProblem(ope_compiled,\n    Dict(ope_compiled.OH => OH_vals[1], ope_compiled.HO2 => HO2_vals[1],\n        ope_compiled.RO2 => 0.0, ope_compiled.NO => NO_vals[1],\n        ope_compiled.NO2 => NO2_vals[1]);\n    build_initializeprob = false)\n\nfor i in eachindex(NOx_ppt)\n    newprob = remake(prob,\n        p = [\n            ope_compiled.OH => OH_vals[i], ope_compiled.HO2 => HO2_vals[i],\n            ope_compiled.NO => NO_vals[i], ope_compiled.NO2 => NO2_vals[i]])\n    sol = solve(newprob)\n    push!(OPE_vals, sol[ope_compiled.OPE])\nend\n\nplot(NOx_ppt, OPE_vals,\n    xlabel = \"NOₓ (ppt)\",\n    ylabel = \"Ozone Production Efficiency\",\n    title = \"Figure 6.3: OPE for CO Oxidation\",\n    xscale = :log10,\n    linewidth = 2, label = \"OPE (Eqs. 6.10, 6.22, 6.23)\",\n    legend = :topright,\n    ylims = (0, 9),\n    size = (600, 400))\nannotate!([(\n    1e4, 7, text(\"P_HOx = 1 ppt/s\\n[NO]/[NO₂] = 0.1\\nCO = 200 ppb\\nT = 298 K\", 8, :left))])\nsavefig(\"co_fig6_3.svg\") # hide\n\n(Image: Figure 6.3: OPE vs NOx)\n\nThe OPE is largest at the lowest NOx concentrations; at these low levels, NOx termination by OH + NO₂ is suppressed and each NOx molecule participates in more O₃ production cycles. At 100 ppb NOx, OPE approaches zero as the OH + NO₂ reaction occurs preferentially relative to propagation of the cycle. This reproduces Figure 6.3 of Seinfeld & Pandis.","category":"section"},{"location":"co_oxidation/#Figure-6.4:-CO-Oxidation-Characteristics-vs-NO","page":"CO Oxidation","title":"Figure 6.4: CO Oxidation Characteristics vs NO","text":"Figure 6.4 shows [HO₂], P(O₃), and the HOx loss terms HHL and NHL as functions of [NO] for three values of P_HO_x (0.1, 0.6, and 1.2 ppt s⁻¹). Conditions: 298 K, NO_2NO = 7.\n\nThe COOxidation system is used to compute P(O₃) and the HOx loss diagnostics from the computed OH and HO₂ concentrations.\n\nHHL = 2 k_HO_2+HO_2 HO_2^2 (HOx loss via HO₂ self-reaction, Eq. 6.11)\nNHL = k_OH+NO_2 OH NO_2 (HOx loss via OH+NO₂, Eq. 6.12)\n\nsys_nns = ModelingToolkit.toggle_namespacing(sys, false)\nco_inputs = [sys_nns.CO, sys_nns.OH, sys_nns.HO2, sys_nns.NO, sys_nns.NO2, sys_nns.O3]\nco_compiled = mtkcompile(sys; inputs = co_inputs)\n\n# Conditions from Figure 6.4 caption (working in SI: m⁻³)\nM_val = 2.5e25\nNO2_NO_ratio = 7.0\nP_HOx_ppt = [0.1, 0.6, 1.2]\nP_HOx_SI = P_HOx_ppt .* 1e-12 .* M_val  # m⁻³/s\n\n# Vary NO from 0 to 6e10 molec/cm³ (= 6e16 m⁻³)\nNO_range_cgs = range(1e8, 6e10, length = 500)\nNO_range = NO_range_cgs .* 1e6   # convert to m⁻³\nNO2_range = NO2_NO_ratio .* NO_range\n\n# CO = 200 ppb\nCO_val = 200e-9 * M_val\n\np_ho2 = plot(title = \"(a) [HO₂]\", xlabel = \"NO (molec cm⁻³)\", ylabel = \"HO₂ (molec cm⁻³)\")\np_po3 = plot(title = \"(b) P(O₃)\", xlabel = \"NO (molec cm⁻³)\",\n    ylabel = \"P_O₃ (molec cm⁻³ s⁻¹)\")\np_hhl = plot(title = \"(c) HHL and NHL\", xlabel = \"NO (molec cm⁻³)\",\n    ylabel = \"HHL, NHL (molec cm⁻³ s⁻¹)\")\n\nfor (i, P_HOx) in enumerate(P_HOx_SI)\n    lbl = \"P_HOx = $(P_HOx_ppt[i]) ppt/s\"\n\n    # Solve quadratic for HO2 (SI units, using rate constants from system)\n    a_v = 2 .* k_HO2_HO2 .* (1 .+ k_OH_NO2 .* NO2_range ./ (k_CO_OH .* CO_val))\n    b_v = k_HO2_NO .* k_OH_NO2 .* NO2_range .* NO_range ./ (k_CO_OH .* CO_val)\n    c_v = -P_HOx\n\n    HO2_v = (-b_v .+ sqrt.(b_v .^ 2 .- 4 .* a_v .* c_v)) ./ (2 .* a_v)\n    OH_v = (P_HOx .- 2 .* k_HO2_HO2 .* HO2_v .^ 2) ./ (k_OH_NO2 .* NO2_range)\n\n    # Use COOxidation system to compute diagnostics\n    PO3_v = Float64[]\n    L_HOx_v = Float64[]\n    NHL_v = Float64[]\n\n    co_prob = NonlinearProblem(co_compiled,\n        Dict(co_compiled.CO => CO_val, co_compiled.OH => OH_v[1],\n            co_compiled.HO2 => HO2_v[1], co_compiled.NO => NO_range[1],\n            co_compiled.NO2 => NO2_range[1], co_compiled.O3 => 1e18);\n        build_initializeprob = false)\n\n    for j in eachindex(NO_range)\n        newprob = remake(co_prob,\n            p = [\n                co_compiled.OH => OH_v[j], co_compiled.HO2 => HO2_v[j],\n                co_compiled.NO => NO_range[j], co_compiled.NO2 => NO2_range[j]])\n        sol = solve(newprob)\n        push!(PO3_v, sol[co_compiled.P_O3])\n        push!(L_HOx_v, sol[co_compiled.L_HOx])\n        # NHL = k_OH_NO2 * [OH] * [NO2] (Eq. 6.12)\n        push!(NHL_v, k_OH_NO2 * OH_v[j] * NO2_range[j])\n    end\n\n    # HHL = L_HOx - NHL (since L_HOx = HHL + NHL)\n    HHL_v = L_HOx_v .- NHL_v\n\n    # Convert to cgs for plotting (m⁻³ → cm⁻³ = ×1e-6)\n    plot!(p_ho2, NO_range_cgs, HO2_v .* 1e-6, label = lbl, linewidth = 2)\n    plot!(p_po3, NO_range_cgs, PO3_v .* 1e-6, label = lbl, linewidth = 2)\n    plot!(p_hhl, NO_range_cgs, HHL_v .* 1e-6, label = \"HHL \" * lbl, linewidth = 2,\n        linestyle = :solid)\n    plot!(p_hhl, NO_range_cgs, NHL_v .* 1e-6, label = \"NHL \" * lbl, linewidth = 2,\n        linestyle = :dash)\nend\n\nplot(p_ho2, p_po3, p_hhl, layout = (3, 1), size = (600, 900), left_margin = 5 * Plots.mm)\nsavefig(\"co_fig6_4.svg\") # hide\n\n(Image: Figure 6.4: CO oxidation characteristics vs NO)\n\nPanel (a) shows that [HO₂] decreases with [NO] because the HO₂ + NO reaction consumes HO₂ more efficiently at higher NO. Panel (b) shows that P(O₃) achieves a maximum at an intermediate [NO]; at low [NO], HO₂ is abundant but there is insufficient NO for the O₃-producing HO₂ + NO reaction, while at high [NO], HO₂ is depleted. Panel (c) shows the crossover from HHL-dominated (low NOx, HO₂ self-reaction) to NHL-dominated (high NOx, OH + NO₂) HOx termination. The maximum in P(O₃) occurs at a larger [NO] than the HHL/NHL crossover. This reproduces Figure 6.4 of Seinfeld & Pandis.","category":"section"},{"location":"co_oxidation/#GasChem.COOxidation","page":"CO Oxidation","title":"GasChem.COOxidation","text":"COOxidation(; name)\n\nModelingToolkit System for CO oxidation chemistry diagnostics.\n\nImplements diagnostic calculations for the CO oxidation mechanism (Eqs. 6.9-6.17) from Seinfeld & Pandis Chapter 6, including HOx cycling and steady-state relationships.\n\nInput Variables\n\nCO, OH, HO2, NO, NO2, O3: Species concentrations [m⁻³]\n\nOutput Variables\n\nP_O3: Net ozone production rate [m⁻³ s⁻¹]\nL_HOx: Total HOx loss rate [m⁻³ s⁻¹]\nchain_length: HOx chain length (cycles before termination)\nHO2_ss: HO₂ steady-state concentration (high NOx limit) [m⁻³]\n\nRate Constants at 298 K\n\nkCOOH = 2.4 × 10⁻¹³ cm³ molecule⁻¹ s⁻¹ = 2.4 × 10⁻¹⁹ m³ s⁻¹\nkHO2NO = 8.1 × 10⁻¹² cm³ molecule⁻¹ s⁻¹ = 8.1 × 10⁻¹⁸ m³ s⁻¹\nkHO2HO2 = 2.9 × 10⁻¹² cm³ molecule⁻¹ s⁻¹ = 2.9 × 10⁻¹⁸ m³ s⁻¹\nkOHNO2 = 1.0 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 1.0 × 10⁻¹⁷ m³ s⁻¹\nkHO2O3 = 2.0 × 10⁻¹⁵ cm³ molecule⁻¹ s⁻¹ = 2.0 × 10⁻²¹ m³ s⁻¹\nkOHO3 = 7.3 × 10⁻¹⁴ cm³ molecule⁻¹ s⁻¹ = 7.3 × 10⁻²⁰ m³ s⁻¹\n\n\n\n\n\n","category":"function"},{"location":"co_oxidation/#GasChem.OzoneProductionEfficiency","page":"CO Oxidation","title":"GasChem.OzoneProductionEfficiency","text":"OzoneProductionEfficiency(; name)\n\nModelingToolkit System for calculating Ozone Production Efficiency (OPE).\n\nOPE = Δ[O₃] / Δ[NOx] represents the number of ozone molecules produced per NOx molecule consumed. This is a key metric for understanding ozone-NOx-VOC chemistry in different regimes.\n\nFrom Equations 6.21-6.24:\n\nAt high NOx (VOC-limited): OPE is low\nAt low NOx (NOx-limited): OPE is high\nThe transition occurs near the \"ridge line\" in O₃-NOx-VOC space\n\nInput Variables\n\nOH, HO2, RO2, NO, NO2: Species concentrations [m⁻³]\n\nOutput Variables\n\nP_O3: Gross ozone production rate [m⁻³ s⁻¹]\nL_NOx: NOx loss rate [m⁻³ s⁻¹]\nOPE: Ozone production efficiency [dimensionless]\n\n\n\n\n\n","category":"function"},{"location":"geoschem/states/#Chemical-Species","page":"State Variables","title":"Chemical Species","text":"Here is a list of the chemical species in the mechanism:\n\nusing GasChem, DataFrames, EarthSciMLBase, ModelingToolkit, DynamicQuantities\nusing ModelingToolkit: t\ngc = mtkcompile(GEOSChemGasPhase())\nvars = unknowns(gc)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [ModelingToolkit.get_unit(v) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars],\n    :Default => [ModelingToolkit.getdefault(v) for v in vars])","category":"section"},{"location":"radiation_fundamentals/#Radiation-Fundamentals","page":"Radiation Fundamentals","title":"Radiation Fundamentals","text":"","category":"section"},{"location":"radiation_fundamentals/#Overview","page":"Radiation Fundamentals","title":"Overview","text":"This module implements the fundamental atmospheric radiation equations from Chapter 4 \"Atmospheric Radiation and Photochemistry\" of Seinfeld and Pandis (2006). These equations form the foundation for understanding radiative transfer in the atmosphere, including solar radiation, thermal emission, and planetary energy balance.\n\nThe equations describe:\n\nPhoton energy relationships (Eq. 4.1): The quantum nature of electromagnetic radiation\nPlanck's blackbody radiation law (Eq. 4.2): Spectral distribution of thermal radiation\nWien's displacement law (Eq. 4.3): Peak wavelength of blackbody emission\nStefan-Boltzmann law (Eq. 4.4): Total thermal radiation power\nPlanetary energy balance (Eqs. 4.5-4.7): Earth's equilibrium temperature\nClimate sensitivity (Eqs. 4.8-4.10): Temperature response to radiative forcing\nTop-of-atmosphere radiative forcing (Eq. 4.11): Net energy flux at TOA\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons, Inc., Hoboken, New Jersey. Chapter 4, pp. 98-106.","category":"section"},{"location":"radiation_fundamentals/#Physical-Constants","page":"Radiation Fundamentals","title":"Physical Constants","text":"The following fundamental constants are used throughout:\n\nConstant Symbol Value Units\nPlanck's constant h 6.626 x 10^-34 J s\nSpeed of light c 2.9979 x 10^8 m/s\nBoltzmann constant k 1.381 x 10^-23 J/K\nStefan-Boltzmann constant sigma 5.671 x 10^-8 W m^-2 K^-4\nWien's displacement constant b 2.897 x 10^-3 m K\n\n","category":"section"},{"location":"radiation_fundamentals/#Implementation","page":"Radiation Fundamentals","title":"Implementation","text":"The radiation fundamentals are implemented as a set of ModelingToolkit.jl component systems. Each component encapsulates a specific physical relationship and can be used independently or combined into larger systems.","category":"section"},{"location":"radiation_fundamentals/#Component-Systems","page":"Radiation Fundamentals","title":"Component Systems","text":"The module provides seven individual component systems plus one composed system that combines them all:\n\nPhotonEnergy - Photon energy-frequency-wavelength relations (Eq. 4.1)\nBlackbodyRadiation - Planck's law for spectral radiance (Eq. 4.2)\nWienDisplacement - Peak emission wavelength (Eq. 4.3)\nStefanBoltzmann - Total emissive power (Eq. 4.4)\nPlanetaryEnergyBalance - Earth's energy balance (Eqs. 4.5-4.7)\nClimateSensitivity - Temperature response to forcing (Eqs. 4.8-4.10)\nTOARadiativeForcing - Net flux at top of atmosphere (Eq. 4.11)\nRadiationFundamentals - Composed system combining all components","category":"section"},{"location":"radiation_fundamentals/#PhotonEnergy-System","page":"Radiation Fundamentals","title":"PhotonEnergy System","text":"Implements the photon energy equation (Eq. 4.1):\n\nDeltavarepsilon = hnu = frachclambda\n\nwhere h is Planck's constant, nu is frequency, c is the speed of light, and lambda is wavelength.\n\nusing GasChem\nusing DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, NonlinearSolve\nusing ModelingToolkit: t\nusing GasChem: PhotonEnergy, BlackbodyRadiation, WienDisplacement, StefanBoltzmann\nusing GasChem: PlanetaryEnergyBalance, ClimateSensitivity, TOARadiativeForcing,\n               RadiationFundamentals\n\n# Helper to display variable/parameter tables from pre-compiled systems\nfunction vars_table(sys)\n    vars = ModelingToolkit.get_unknowns(sys)\n    DataFrame(\n        :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n        :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n        :Description => [ModelingToolkit.getdescription(v) for v in vars]\n    )\nend\nfunction params_table(sys)\n    ps = ModelingToolkit.get_ps(sys)\n    DataFrame(\n        :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in ps],\n        :Default => [ModelingToolkit.getdefault(p) for p in ps],\n        :Units => [dimension(ModelingToolkit.get_unit(p)) for p in ps],\n        :Description => [ModelingToolkit.getdescription(p) for p in ps]\n    )\nend\n\n@named photon = PhotonEnergy()\nvars_table(photon)\n\nParameters:\n\nparams_table(photon)\n\nEquations:\n\nequations(photon)","category":"section"},{"location":"radiation_fundamentals/#BlackbodyRadiation-System","page":"Radiation Fundamentals","title":"BlackbodyRadiation System","text":"Implements Planck's blackbody radiation law (Eq. 4.2):\n\nF_B(lambda) = frac2pi c^2 h lambda^-5expleft(fracchklambda Tright) - 1\n\nThis equation gives the monochromatic emissive power of a blackbody at temperature T for a given wavelength lambda.\n\n@named blackbody = BlackbodyRadiation()\nvars_table(blackbody)\n\nParameters:\n\nparams_table(blackbody)\n\nEquations:\n\nequations(blackbody)","category":"section"},{"location":"radiation_fundamentals/#WienDisplacement-System","page":"Radiation Fundamentals","title":"WienDisplacement System","text":"Implements Wien's displacement law (Eq. 4.3):\n\nlambda_max = frac2897 times 10^-3T\n\nThis gives the wavelength at which the blackbody emission spectrum peaks for a given temperature T.\n\n@named wien = WienDisplacement()\nvars_table(wien)\n\nParameters:\n\nparams_table(wien)\n\nEquations:\n\nequations(wien)","category":"section"},{"location":"radiation_fundamentals/#StefanBoltzmann-System","page":"Radiation Fundamentals","title":"StefanBoltzmann System","text":"Implements the Stefan-Boltzmann law (Eq. 4.4):\n\nF_B = sigma T^4\n\nThe total emissive power of a blackbody integrated over all wavelengths.\n\n@named sb = StefanBoltzmann()\nvars_table(sb)\n\nParameters:\n\nparams_table(sb)\n\nEquations:\n\nequations(sb)","category":"section"},{"location":"radiation_fundamentals/#PlanetaryEnergyBalance-System","page":"Radiation Fundamentals","title":"PlanetaryEnergyBalance System","text":"Implements the planetary energy balance equations (Eqs. 4.5-4.7):\n\nF_S = fracS_04(1 - R_p) quad text(Eq 45)\n\nF_L = sigma T_e^4 quad text(Eq 46)\n\nT_e = leftfrac(1-R_p)S_04sigmaright^14 quad text(Eq 47)\n\nAt equilibrium, the absorbed solar flux equals the emitted longwave flux: FS = FL.\n\n@named balance = PlanetaryEnergyBalance()\nvars_table(balance)\n\nParameters:\n\nparams_table(balance)\n\nEquations:\n\nequations(balance)","category":"section"},{"location":"radiation_fundamentals/#ClimateSensitivity-System","page":"Radiation Fundamentals","title":"ClimateSensitivity System","text":"Implements the climate sensitivity equations (Eqs. 4.8-4.10):\n\nDelta F_net = Delta F_S - Delta F_L quad text(Eq 48)\n\nDelta T_e = lambda_0 Delta F_net quad text(Eq 49)\n\nlambda_0 = frac14sigma T_e^3 = fracT_e4F_L quad text(Eq 410)\n\n@named sensitivity = ClimateSensitivity()\nvars_table(sensitivity)\n\nParameters:\n\nparams_table(sensitivity)\n\nEquations:\n\nequations(sensitivity)","category":"section"},{"location":"radiation_fundamentals/#TOARadiativeForcing-System","page":"Radiation Fundamentals","title":"TOARadiativeForcing System","text":"Implements the top of atmosphere radiative forcing based on Eq. 4.11 from Seinfeld & Pandis:\n\nF_net = fracS_04(1 - R_p) - F_L\n\nNote: Seinfeld & Pandis write Eq. 4.11 as -F_net = S_04(1-R_p) - F_L, using the convention that -F_net represents net downward flux. Here we define F_net as net incoming flux directly, so positive F_net indicates the planet is gaining energy (warming).\n\n@named toa = TOARadiativeForcing()\nvars_table(toa)\n\nParameters:\n\nparams_table(toa)\n\nEquations:\n\nequations(toa)","category":"section"},{"location":"radiation_fundamentals/#RadiationFundamentals-Composed-System","page":"Radiation Fundamentals","title":"RadiationFundamentals Composed System","text":"The composed system combines all individual components:\n\n@named radiation = RadiationFundamentals()\n\nsubsystems = ModelingToolkit.get_systems(radiation)\nDataFrame(\n    :Subsystem => [string(nameof(s)) for s in subsystems],\n    :Equations => [\"Eq. 4.1\", \"Eq. 4.2\", \"Eq. 4.3\", \"Eq. 4.4\",\n        \"Eqs. 4.5-4.7\", \"Eqs. 4.8-4.10\", \"Eq. 4.11\"]\n)\n\nState Variables (all subsystems):\n\nall_vars = vcat([ModelingToolkit.get_unknowns(s) for s in subsystems]...)\nDataFrame(\n    :Subsystem => vcat([[string(nameof(s)) for _ in ModelingToolkit.get_unknowns(s)]\n                        for s in subsystems]...),\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in all_vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in all_vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in all_vars]\n)\n\nEquations:\n\nequations(radiation)\n\n","category":"section"},{"location":"radiation_fundamentals/#Analysis","page":"Radiation Fundamentals","title":"Analysis","text":"This section demonstrates the physics captured by the radiation fundamentals equations through numerical examples and visualizations that reproduce key results from Seinfeld and Pandis (2006).","category":"section"},{"location":"radiation_fundamentals/#Blackbody-Radiation-Spectra-(cf.-Figures-4.2-4.3)","page":"Radiation Fundamentals","title":"Blackbody Radiation Spectra (cf. Figures 4.2-4.3)","text":"The Planck function describes the spectral distribution of radiation emitted by a blackbody. The following plot shows blackbody spectra at different temperatures, demonstrating how the peak wavelength shifts according to Wien's law and total power increases with temperature according to the Stefan-Boltzmann law.\n\nusing Plots\n\n# Use the BlackbodyRadiation MTK component to compute spectra\n@named bb_analysis = BlackbodyRadiation()\ncompiled_bb = mtkcompile(bb_analysis)\n\n# Also use WienDisplacement for peak wavelengths\n@named wien_analysis = WienDisplacement()\ncompiled_wien_analysis = mtkcompile(wien_analysis)\n\n# Wavelength range (in meters)\nlambda_range = 10 .^ range(-7, -4, length = 500)  # 100 nm to 100 um\n\n# Temperatures to plot\ntemperatures = [5800, 1000, 500, 300]\ncolors = [:orange, :red, :darkred, :blue]\nlabels = [\"Sun (5800 K)\", \"1000 K\", \"500 K\", \"Earth (300 K)\"]\n\np1 = plot(xlabel = \"Wavelength (m)\", ylabel = \"Spectral Radiance (W/m³)\",\n    title = \"Blackbody Radiation Spectra (Planck's Law, Eq. 4.2)\",\n    xscale = :log10, yscale = :log10,\n    xlims = (1e-7, 1e-4), ylims = (1e0, 1e14),\n    legend = :topright, size = (700, 500))\n\nbb_prob = NonlinearProblem(compiled_bb, Dict(); build_initializeprob = false)\nwien_prob = NonlinearProblem(compiled_wien_analysis, Dict(); build_initializeprob = false)\n\nfor (T, col, lab) in zip(temperatures, colors, labels)\n    # Compute spectrum using BlackbodyRadiation component\n    F = Float64[]\n    for λ in lambda_range\n        prob_i = remake(bb_prob, p = [compiled_bb.T => Float64(T), compiled_bb.λ => λ])\n        sol_i = solve(prob_i)\n        push!(F, sol_i[compiled_bb.F_B_λ])\n    end\n    plot!(p1, lambda_range, F, label = lab, color = col, linewidth = 2)\n\n    # Mark peak wavelength using WienDisplacement component\n    wien_prob_i = remake(wien_prob, p = [compiled_wien_analysis.T => Float64(T)])\n    wien_sol = solve(wien_prob_i)\n    lambda_max = wien_sol[compiled_wien_analysis.λ_max]\n\n    bb_peak_prob = remake(bb_prob, p = [\n        compiled_bb.T => Float64(T), compiled_bb.λ => lambda_max])\n    bb_peak_sol = solve(bb_peak_prob)\n    F_max = bb_peak_sol[compiled_bb.F_B_λ]\n    scatter!(p1, [lambda_max], [F_max], color = col, markersize = 6, label = \"\")\nend\n\n# Add Wien's displacement law annotation\nannotate!(p1, 5e-7, 1e12, text(\"Wien: lambda_max = 2897/T\", 8, :left))\n\nsavefig(p1, \"blackbody_spectra.svg\")\np1\n\nFigure 1: Blackbody radiation spectra at different temperatures (cf. S&P Figures 4.2-4.3). The dots mark the peak wavelength given by Wien's displacement law (Eq. 4.3). The Sun at 5800 K peaks in the visible range (~500 nm), while Earth at ~300 K peaks in the thermal infrared (~10 um). Note: These are ideal blackbody curves; Figure 4.2 in S&P also shows the observed solar spectrum with Fraunhofer absorption lines.","category":"section"},{"location":"radiation_fundamentals/#Spectral-Irradiance-of-a-Blackbody-at-300-K-(cf.-Figure-4.3)","page":"Radiation Fundamentals","title":"Spectral Irradiance of a Blackbody at 300 K (cf. Figure 4.3)","text":"Figure 4.3 in S&P shows the spectral irradiance of a blackbody at 300 K, representative of Earth's thermal emission, plotted with linear axes and wavelength in micrometers.\n\n# Reproduce S&P Figure 4.3: 300 K blackbody spectrum (linear axes, wavelength in μm)\nlambda_um_range = range(1.0, 70.0, length = 500)  # 1-70 μm\n\nF_300K = Float64[]\nfor λ_um in lambda_um_range\n    λ_m = λ_um * 1e-6  # Convert μm to m\n    prob_i = remake(bb_prob, p = [compiled_bb.T => 300.0, compiled_bb.λ => λ_m])\n    sol_i = solve(prob_i)\n    # Convert W/m³ to W m⁻² μm⁻¹ by multiplying by 1e-6 (dλ_m/dλ_μm)\n    push!(F_300K, sol_i[compiled_bb.F_B_λ] * 1e-6)\nend\n\np1b = plot(lambda_um_range, F_300K,\n    xlabel = \"Wavelength, μm\",\n    ylabel = \"F_B, W m⁻² μm⁻¹\",\n    title = \"Spectral irradiance of a blackbody at 300 K (cf. S&P Figure 4.3)\",\n    label = \"300 K Blackbody\",\n    linewidth = 2, color = :black,\n    xlims = (0, 70), ylims = (0, maximum(F_300K) * 1.1),\n    legend = :topright, size = (600, 400))\n\nsavefig(p1b, \"blackbody_300K.svg\")\np1b\n\nFigure 1b: Spectral irradiance of a blackbody at 300 K (cf. S&P Figure 4.3). The peak emission occurs at approximately 10 μm in the thermal infrared, as predicted by Wien's displacement law. This spectrum is representative of the longwave radiation emitted by Earth's surface.","category":"section"},{"location":"radiation_fundamentals/#Wien's-Displacement-Law-Demonstration-(Eq.-4.3)","page":"Radiation Fundamentals","title":"Wien's Displacement Law Demonstration (Eq. 4.3)","text":"# Demonstrate Wien's displacement law\n@named wien_sys = WienDisplacement()\ncompiled_wien = mtkcompile(wien_sys)\n\ntemperatures_K = [5800, 3000, 1000, 500, 300, 255]\npeak_wavelengths_nm = Float64[]\n\nfor T in temperatures_K\n    prob = NonlinearProblem(compiled_wien, Dict(); build_initializeprob = false)\n    prob = remake(prob, p = [compiled_wien.T => T])\n    sol = solve(prob)\n    push!(peak_wavelengths_nm, sol[compiled_wien.λ_max] * 1e9)  # Convert to nm\nend\n\nDataFrame(\n    :Temperature_K => temperatures_K,\n    :Peak_Wavelength_nm => round.(peak_wavelengths_nm, digits = 1),\n    :Spectral_Region => [\n        \"Visible (yellow)\", \"Near-IR\", \"Near-IR\", \"Mid-IR\", \"Thermal IR\", \"Thermal IR\"]\n)","category":"section"},{"location":"radiation_fundamentals/#Planetary-Energy-Balance-(Eqs.-4.5-4.7)","page":"Radiation Fundamentals","title":"Planetary Energy Balance (Eqs. 4.5-4.7)","text":"The equilibrium temperature of Earth can be calculated from the balance between absorbed solar radiation and emitted thermal radiation.\n\n@named energy_sys = PlanetaryEnergyBalance()\ncompiled_energy = mtkcompile(energy_sys)\n\n# Solve with default parameters (S_0 = 1370 W/m², R_p = 0.3)\nprob = NonlinearProblem(compiled_energy, Dict(compiled_energy.T_e => 250.0); build_initializeprob = false)\nsol = solve(prob)\n\nprintln(\"Planetary Energy Balance Results:\")\nprintln(\"================================\")\nprintln(\"Solar constant (S_0): 1370 W/m²\")\nprintln(\"Planetary albedo (R_p): 0.3\")\nprintln(\"Absorbed solar flux (F_S): \", round(sol[compiled_energy.F_S], digits = 2), \" W/m²\")\nprintln(\"Emitted longwave flux (F_L): \", round(sol[compiled_energy.F_L], digits = 2), \" W/m²\")\nprintln(\"Equilibrium temperature (T_e): \", round(sol[compiled_energy.T_e], digits = 1), \" K\")\nprintln(\"Equilibrium temperature (T_e): \", round(sol[compiled_energy.T_e] - 273.15, digits = 1), \" °C\")\n\nThe calculated equilibrium temperature of ~255 K (-18 C) is significantly colder than Earth's actual average surface temperature of ~288 K (15 C). This 33 K difference is due to the greenhouse effect, which is not included in this simple energy balance model.","category":"section"},{"location":"radiation_fundamentals/#Effect-of-Albedo-on-Equilibrium-Temperature","page":"Radiation Fundamentals","title":"Effect of Albedo on Equilibrium Temperature","text":"albedos = 0.0:0.05:0.8\nT_equilibrium = Float64[]\n\nfor R_p in albedos\n    prob = NonlinearProblem(compiled_energy, Dict(compiled_energy.T_e => 250.0); build_initializeprob = false)\n    prob = remake(prob, p = [compiled_energy.R_p => R_p])\n    sol = solve(prob)\n    push!(T_equilibrium, sol[compiled_energy.T_e])\nend\n\np2 = plot(albedos, T_equilibrium,\n    xlabel = \"Planetary Albedo (R_p)\",\n    ylabel = \"Equilibrium Temperature (K)\",\n    title = \"Effect of Albedo on Planetary Temperature (Eq. 4.7)\",\n    label = \"T_e = [(1-R_p)S_0/(4σ)]^(1/4)\",\n    linewidth = 2, color = :blue,\n    size = (600, 400))\n\n# Mark Earth's approximate values\nscatter!(p2, [0.3], [255.0], color = :red, markersize = 8, label = \"Earth (R_p ≈ 0.3)\")\n\n# Add horizontal line for freezing point\nhline!(p2, [273.15], linestyle = :dash, color = :gray, label = \"Freezing (273 K)\")\n\nsavefig(p2, \"albedo_temperature.svg\")\np2\n\nFigure 2: Equilibrium temperature as a function of planetary albedo. Higher albedo reflects more solar radiation, resulting in a colder equilibrium temperature. Earth with an albedo of ~0.3 has an equilibrium temperature of ~255 K.","category":"section"},{"location":"radiation_fundamentals/#Climate-Sensitivity-Analysis-(Eqs.-4.8-4.10)","page":"Radiation Fundamentals","title":"Climate Sensitivity Analysis (Eqs. 4.8-4.10)","text":"The climate sensitivity parameter lambda_0 describes how the equilibrium temperature changes in response to radiative forcing.\n\n@named climate_sys = ClimateSensitivity()\ncompiled_climate = mtkcompile(climate_sys)\n\n# Calculate climate sensitivity at Earth's equilibrium temperature\nprob = NonlinearProblem(compiled_climate, Dict(); build_initializeprob = false)\nsol = solve(prob)\n\nlambda_0 = sol[compiled_climate.λ_0]\nprintln(\"Climate Sensitivity Analysis (no-feedback case):\")\nprintln(\"================================================\")\nprintln(\"Reference temperature (T_e): 255 K\")\nprintln(\"Climate sensitivity (λ_0): \", round(lambda_0, digits = 4), \" K/(W/m²)\")\nprintln(\"\")\nprintln(\"For a radiative forcing of 4 W/m² (typical CO2 doubling):\")\nprintln(\"Temperature change (ΔT_e): \", round(sol[compiled_climate.ΔT_e], digits = 2), \" K\")","category":"section"},{"location":"radiation_fundamentals/#Temperature-Response-to-Radiative-Forcing","page":"Radiation Fundamentals","title":"Temperature Response to Radiative Forcing","text":"# Calculate temperature response for different forcing levels\nforcings = 0:0.5:10  # W/m²\ndelta_T = Float64[]\n\nfor ΔF in forcings\n    prob = NonlinearProblem(compiled_climate, Dict(); build_initializeprob = false)\n    prob = remake(prob, p = [compiled_climate.ΔF_S => ΔF])\n    sol = solve(prob)\n    push!(delta_T, sol[compiled_climate.ΔT_e])\nend\n\np3 = plot(forcings, delta_T,\n    xlabel = \"Radiative Forcing (W/m²)\",\n    ylabel = \"Temperature Change (K)\",\n    title = \"Climate Sensitivity (Eq. 4.9): ΔT = λ₀ × ΔF\",\n    label = \"No-feedback response\",\n    linewidth = 2, color = :red,\n    size = (600, 400))\n\n# Mark typical CO2 doubling forcing\nvline!(p3, [4.0], linestyle = :dash, color = :gray, label = \"CO₂ doubling (~4 W/m²)\")\nscatter!(p3, [4.0], [4.0 * lambda_0], color = :blue, markersize = 8, label = \"ΔT ≈ 1.1 K\")\n\nsavefig(p3, \"climate_sensitivity.svg\")\np3\n\nFigure 3: Temperature change as a function of radiative forcing for the no-feedback case. The climate sensitivity lambda0 = 1/(4sigmaTe^3) = 0.266 K/(W/m^2) at Te = 255 K (S&P approximate this as ~0.3). For a CO2 doubling forcing of ~4.6 W/m^2 (S&P p. 105), this gives ΔTe ≈ 1.2 K with the exact lambda_0 (S&P report ~1.4 K using the rounded value). Note: Real climate sensitivity is higher due to positive feedbacks (water vapor, ice-albedo, etc.).","category":"section"},{"location":"radiation_fundamentals/#Stefan-Boltzmann-Law:-Total-Emissive-Power","page":"Radiation Fundamentals","title":"Stefan-Boltzmann Law: Total Emissive Power","text":"@named sb_sys = StefanBoltzmann()\ncompiled_sb = mtkcompile(sb_sys)\n\ntemperatures = 200:10:400  # K\nemissive_power = Float64[]\n\nfor T in temperatures\n    prob = NonlinearProblem(compiled_sb, Dict(); build_initializeprob = false)\n    prob = remake(prob, p = [compiled_sb.T => T])\n    sol = solve(prob)\n    push!(emissive_power, sol[compiled_sb.F_B])\nend\n\np4 = plot(temperatures, emissive_power,\n    xlabel = \"Temperature (K)\",\n    ylabel = \"Total Emissive Power (W/m²)\",\n    title = \"Stefan-Boltzmann Law (Eq. 4.4): F_B = σT⁴\",\n    label = \"Blackbody emission\",\n    linewidth = 2, color = :orange,\n    size = (600, 400))\n\n# Mark key temperatures using the StefanBoltzmann component\nsb_prob = NonlinearProblem(compiled_sb, Dict(); build_initializeprob = false)\n\nsb_eq_prob = remake(sb_prob, p = [compiled_sb.T => 255.0])\nsb_eq_sol = solve(sb_eq_prob)\nF_eq = sb_eq_sol[compiled_sb.F_B]\n\nsb_surf_prob = remake(sb_prob, p = [compiled_sb.T => 288.0])\nsb_surf_sol = solve(sb_surf_prob)\nF_surf = sb_surf_sol[compiled_sb.F_B]\n\nscatter!(p4, [255], [F_eq], color = :blue, markersize = 8, label = \"Earth eq. (255 K)\")\nscatter!(p4, [288], [F_surf], color = :red, markersize = 8, label = \"Earth surface (288 K)\")\n\nsavefig(p4, \"stefan_boltzmann.svg\")\np4\n\nFigure 4: Total blackbody emissive power as a function of temperature. The T^4 dependence means that small temperature increases lead to significantly higher emission, which acts as a stabilizing feedback in the climate system.","category":"section"},{"location":"radiation_fundamentals/#Photon-Energy-Across-the-Electromagnetic-Spectrum","page":"Radiation Fundamentals","title":"Photon Energy Across the Electromagnetic Spectrum","text":"@named photon_sys = PhotonEnergy()\ncompiled_photon = mtkcompile(photon_sys)\n\n# Wavelengths spanning UV to thermal IR\nwavelengths_m = [1e-8, 1e-7, 4e-7, 5e-7, 7e-7, 1e-6, 1e-5, 1e-4]\nwavelength_labels = [\"X-ray (10 nm)\", \"UV (100 nm)\", \"Violet (400 nm)\", \"Green (500 nm)\",\n    \"Red (700 nm)\", \"Near-IR (1 μm)\", \"Thermal IR (10 μm)\", \"Far-IR (100 μm)\"]\n\nenergies_eV = Float64[]\nfrequencies_Hz = Float64[]\n\nfor λ in wavelengths_m\n    prob = NonlinearProblem(compiled_photon, Dict(); build_initializeprob = false)\n    prob = remake(prob, p = [compiled_photon.λ => λ])\n    sol = solve(prob)\n    push!(energies_eV, sol[compiled_photon.Δε] / 1.602e-19)  # Convert J to eV\n    push!(frequencies_Hz, sol[compiled_photon.ν])\nend\n\nDataFrame(\n    :Wavelength => wavelength_labels,\n    :Wavelength_m => wavelengths_m,\n    :Frequency_Hz => frequencies_Hz,\n    :Energy_eV => round.(energies_eV, digits = 4)\n)\n\nThis table demonstrates the inverse relationship between wavelength and photon energy (Eq. 4.1). UV and visible photons have sufficient energy to break chemical bonds and drive photochemistry, while infrared photons primarily contribute to thermal processes.","category":"section"},{"location":"radiation_fundamentals/#Photon-Energy-in-kJ/mol-for-Atmospheric-Photochemistry-(cf.-S-and-P-p.-114)","page":"Radiation Fundamentals","title":"Photon Energy in kJ/mol for Atmospheric Photochemistry (cf. S&P p. 114)","text":"In atmospheric photochemistry, photon energies are often expressed per mole using Avogadro's number: ε = N_A × hc/λ (S&P Eq. 4.34). For wavelength λ in nm, this gives ε = 1.19625 × 10⁵ / λ kJ mol⁻¹ (Eq. 4.35). The following table reproduces the wavelength-energy ranges from S&P Table on p. 114.\n\n# Reproduce S&P p.114 wavelength-energy table using Eq. 4.34: ε = N_A * hc/λ\nN_A = 6.022e23  # Avogadro's number, mol⁻¹\n\n# Representative wavelengths from S&P p. 114 table\nvis_wavelengths_nm = [700, 620, 580, 530, 470, 420]\nvis_labels = [\"Red\", \"Orange\", \"Yellow\", \"Green\", \"Blue\", \"Violet\"]\n\nuv_wavelengths_nm = [300, 125]\nuv_labels = [\"Near ultraviolet (center)\", \"Vacuum ultraviolet (center)\"]\n\nall_labels = vcat(vis_labels, uv_labels)\nall_wavelengths_nm = vcat(vis_wavelengths_nm, uv_wavelengths_nm)\n\nenergies_kJ_mol = Float64[]\nfor λ_nm in all_wavelengths_nm\n    λ_m = λ_nm * 1e-9\n    prob_e = NonlinearProblem(compiled_photon, Dict(); build_initializeprob = false)\n    prob_e = remake(prob_e, p = [compiled_photon.λ => λ_m])\n    sol_e = solve(prob_e)\n    ε_per_mol = sol_e[compiled_photon.Δε] * N_A / 1000  # J/mol → kJ/mol\n    push!(energies_kJ_mol, ε_per_mol)\nend\n\nDataFrame(\n    :Region => all_labels,\n    :Wavelength_nm => all_wavelengths_nm,\n    :Energy_kJ_per_mol => round.(energies_kJ_mol, digits = 0)\n)\n\nThe visible range (400-700 nm) corresponds to photon energies of approximately 170-300 kJ/mol, which are comparable to chemical bond energies. For example, the O-O bond in ozone has a dissociation energy of about 105 kJ/mol, and the O-NO bond in NO₂ has a dissociation energy of about 300 kJ/mol (corresponding to a wavelength of about 400 nm). This explains why visible and UV photons can drive atmospheric photodissociation reactions.\n\n","category":"section"},{"location":"radiation_fundamentals/#Summary","page":"Radiation Fundamentals","title":"Summary","text":"The radiation fundamentals equations from Seinfeld and Pandis Chapter 4 provide the physical basis for understanding:\n\nQuantum nature of light: Photon energy is proportional to frequency (Eq. 4.1)\nThermal emission spectra: Planck's law describes spectral distribution (Eq. 4.2)\nPeak emission wavelength: Wien's law relates peak wavelength to temperature (Eq. 4.3)\nTotal thermal power: Stefan-Boltzmann law gives T^4 dependence (Eq. 4.4)\nPlanetary temperature: Energy balance determines equilibrium temperature (Eqs. 4.5-4.7)\nClimate response: Sensitivity relates temperature change to forcing (Eqs. 4.8-4.10)\nRadiative imbalance: TOA flux determines warming or cooling tendency (Eq. 4.11)\n\nThe ModelingToolkit.jl implementation allows these equations to be easily combined, modified, and solved for various atmospheric and climate applications.","category":"section"},{"location":"radiation_fundamentals/#GasChem.PhotonEnergy","page":"Radiation Fundamentals","title":"GasChem.PhotonEnergy","text":"PhotonEnergy(; name=:PhotonEnergy)\n\nImplements the photon energy equation (Eq. 4.1) from Seinfeld & Pandis.\n\nΔε = hν = hc/λ\n\nThe energy of a photon is related to its frequency (ν) or wavelength (λ) through Planck's constant (h) and the speed of light (c).\n\nOutputs (Variables)\n\nΔε: Photon energy (J)\nν: Frequency (Hz = s⁻¹)\n\nInputs (Parameters)\n\nλ: Wavelength (m) - input parameter\n\nConstants\n\nh: Planck's constant = 6.626 × 10⁻³⁴ J·s\nc: Speed of light = 2.9979 × 10⁸ m/s\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.BlackbodyRadiation","page":"Radiation Fundamentals","title":"GasChem.BlackbodyRadiation","text":"BlackbodyRadiation(; name=:BlackbodyRadiation)\n\nImplements Planck's blackbody radiation law (Eq. 4.2) from Seinfeld & Pandis.\n\nF_B(λ) = 2πc²hλ⁻⁵ / (exp(ch/kλT) - 1)\n\nThis equation gives the monochromatic emissive power of a blackbody at temperature T for a given wavelength λ.\n\nOutputs (Variables)\n\nF_B_λ: Monochromatic emissive power (W m⁻³)\n\nInputs (Parameters)\n\nT: Temperature (K)\nλ: Wavelength (m)\n\nConstants\n\nh: Planck's constant = 6.626 × 10⁻³⁴ J·s\nc: Speed of light = 2.9979 × 10⁸ m/s\nk: Boltzmann constant = 1.381 × 10⁻²³ J/K\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.WienDisplacement","page":"Radiation Fundamentals","title":"GasChem.WienDisplacement","text":"WienDisplacement(; name=:WienDisplacement)\n\nImplements Wien's displacement law (Eq. 4.3) from Seinfeld & Pandis.\n\nλ_max = 2.897 × 10⁻³ / T  (SI: λ_max in m, T in K)\n\nNote: S&P express this as λmax = 2.897 × 10⁶ / T when λmax is in nm.\n\nThis gives the wavelength at which the blackbody emission spectrum peaks.\n\nOutputs (Variables)\n\nλ_max: Peak wavelength (m)\n\nInputs (Parameters)\n\nT: Temperature (K)\n\nConstants\n\nb: Wien's displacement constant = 2.897 × 10⁻³ m·K\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.StefanBoltzmann","page":"Radiation Fundamentals","title":"GasChem.StefanBoltzmann","text":"StefanBoltzmann(; name=:StefanBoltzmann)\n\nImplements the Stefan-Boltzmann law (Eq. 4.4) from Seinfeld & Pandis.\n\nF_B = σT⁴\n\nThe total emissive power of a blackbody integrated over all wavelengths.\n\nOutputs (Variables)\n\nF_B: Total blackbody emissive power (W/m²)\n\nInputs (Parameters)\n\nT: Temperature (K)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.PlanetaryEnergyBalance","page":"Radiation Fundamentals","title":"GasChem.PlanetaryEnergyBalance","text":"PlanetaryEnergyBalance(; name=:PlanetaryEnergyBalance)\n\nImplements the planetary energy balance equations (Eqs. 4.5-4.7) from Seinfeld & Pandis.\n\nF_S = S₀/4 × (1 - R_p)     (Eq. 4.5 - Absorbed solar flux)\nF_L = σT_e⁴                 (Eq. 4.6 - Emitted longwave flux)\nT_e = ((1 - R_p)S₀/4σ)^(1/4) (Eq. 4.7 - Equilibrium temperature)\n\nAt equilibrium: FS = FL\n\nOutputs (Variables)\n\nF_S: Absorbed solar flux (W/m²)\nF_L: Emitted longwave flux (W/m²)\nT_e: Planetary equilibrium temperature (K)\n\nInputs (Parameters)\n\nS_0: Solar constant = 1370 W/m² (can be varied)\nR_p: Planetary albedo ~ 0.3 (can be varied)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.ClimateSensitivity","page":"Radiation Fundamentals","title":"GasChem.ClimateSensitivity","text":"ClimateSensitivity(; name=:ClimateSensitivity)\n\nImplements the climate sensitivity equations (Eqs. 4.8-4.10) from Seinfeld & Pandis.\n\nΔF_net = ΔF_S - ΔF_L       (Eq. 4.8 - Net radiative energy change)\nΔT_e = λ₀ × ΔF_net         (Eq. 4.9 - Temperature response)\nλ₀ = 1/(4σT_e³) = T_e/(4F_L) (Eq. 4.10 - Climate sensitivity factor)\n\nOutputs (Variables)\n\nΔF_net: Net radiative forcing (W/m²)\nΔT_e: Change in equilibrium temperature (K)\nλ_0: Climate sensitivity factor (K m²/W)\nF_L: Reference emitted longwave flux (W/m²)\n\nInputs (Parameters)\n\nT_e: Reference equilibrium temperature (K)\nΔF_S: Change in absorbed solar flux (W/m²)\nΔF_L: Change in emitted longwave flux (W/m²)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.TOARadiativeForcing","page":"Radiation Fundamentals","title":"GasChem.TOARadiativeForcing","text":"TOARadiativeForcing(; name=:TOARadiativeForcing)\n\nImplements the top of atmosphere radiative forcing based on Eq. 4.11 from Seinfeld & Pandis.\n\nF_net = S₀/4 × (1 - R_p) - F_L\n\nNote: Seinfeld & Pandis define Eq. 4.11 as -Fnet = S₀/4(1-Rp) - FL, using the convention that -Fnet represents net downward flux. Here we define Fnet as net incoming flux directly, so positive Fnet indicates the planet is gaining energy (warming).\n\nOutputs (Variables)\n\nF_net: Net radiative flux at TOA (W/m²) - positive = energy gain\nF_S: Absorbed solar flux (W/m²)\n\nInputs (Parameters)\n\nS_0: Solar constant = 1370 W/m² (can be varied)\nR_p: Planetary albedo ~ 0.3 (can be varied)\nF_L: Emitted longwave flux (W/m²) - input parameter\n\n\n\n\n\n","category":"function"},{"location":"radiation_fundamentals/#GasChem.RadiationFundamentals","page":"Radiation Fundamentals","title":"GasChem.RadiationFundamentals","text":"RadiationFundamentals(; name=:RadiationFundamentals)\n\nCombined system implementing all radiation fundamentals equations from Seinfeld & Pandis Chapter 4 (Eqs. 4.1-4.11).\n\nThis is a composed system that includes:\n\nPhotonEnergy: Energy-frequency-wavelength relations (Eq. 4.1)\nBlackbodyRadiation: Planck's law (Eq. 4.2)\nWienDisplacement: Peak emission wavelength (Eq. 4.3)\nStefanBoltzmann: Total emissive power (Eq. 4.4)\nPlanetaryEnergyBalance: Earth's energy balance (Eqs. 4.5-4.7)\nClimateSensitivity: Temperature response to forcing (Eqs. 4.8-4.10)\nTOARadiativeForcing: Net flux at top of atmosphere (Eq. 4.11)\n\n\n\n\n\n","category":"function"},{"location":"geoschem/params/#Model-Parameters","page":"Parameters","title":"Model Parameters","text":"","category":"section"},{"location":"geoschem/params/#Temperature-and-Pressure-Example","page":"Parameters","title":"Temperature and Pressure Example","text":"The two main parameters are temperature (T (K)) and pressure (num_density (molecules/cm³)). We can explore what happens when we change them:\n\nusing GasChem, EarthSciMLBase\nusing OrdinaryDiffEqDefault, OrdinaryDiffEqRosenbrock, ModelingToolkit\nusing DynamicQuantities, Plots\nusing ModelingToolkit: t\n\ntspan = (0.0, 60.0*60*24*4) # 4 day simulation\n\n# Run a simulation with constant temperature and pressure.\nsys = mtkcompile(GEOSChemGasPhase())\nprob = ODEProblem(sys, [], tspan; build_initializeprob = false)\nsol1 = solve(prob, Rosenbrock23())\n\n# Now, convert parameters to variables so we can change them over time.\nsys2 = param_to_var(GEOSChemGasPhase(), :T, :num_density)\n\n# Vary temperature and pressure over time.\n@unpack T, num_density = sys2\n@constants T_0 = 300 [unit=u\"K\"]\n@constants t_0 = 1 [unit=u\"s\"]\n@constants numd_0 = 2.7e19 / 6.02e23 * 1e6 [unit=u\"mol/m^3\"]\n@constants numd_slope = 2.5e19 / 6.02e23 * 1e6 [unit=u\"mol/m^3\"]\neqs = [\n    T ~ T_0 + T_0 / 1.5 * sin(2π*t/t_0/(60*60*24)),\n    num_density ~ numd_0 - numd_slope*t/t_0/(60*60*24*4)\n]\nsys2 = extend(sys2, System(eqs, t; name = :var_T))\n\n# Run the simulation again.\nsys2 = mtkcompile(sys2)\nprob = ODEProblem(sys2, [], tspan; build_initializeprob = false)\nsol2 = solve(prob, Rosenbrock23())\n\n# Plot the results\np1 = plot(sol1.t, sol1[sys2.O3], xticks = :none, label = \"Constant T and P\",\n    ylabel = \"Concentration (ppb)\")\nplot!(p1, sol2.t, sol2[sys2.O3], label = \"Varying T and P\")\n\np2 = plot(sol2.t, sol2[sys2.T], label = \"T (K)\", xticks = :none)\np3 = plot(\n    sol2.t, sol2[sys2.num_density], label = \"num_density (molec/cm³)\", xlabel = \"Time (s)\")\n\nplot(p1, p2, p3, layout = grid(3, 1, heights = [0.7, 0.15, 0.15]))","category":"section"},{"location":"geoschem/params/#Model-Parameter-Information","page":"Parameters","title":"Model Parameter Information","text":"Here is a list of all of the model parameters:\n\nusing GasChem, DataFrames, EarthSciMLBase, ModelingToolkit, DynamicQuantities\ngc = mtkcompile(GEOSChemGasPhase())\nvars = parameters(gc)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [ModelingToolkit.get_unit(v) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars],\n    :Default => [ModelingToolkit.getdefault(v) for v in vars])","category":"section"},{"location":"climate_forcing/#Climate-Forcing-and-Global-Warming-Potentials","page":"Climate Forcing","title":"Climate Forcing and Global Warming Potentials","text":"","category":"section"},{"location":"climate_forcing/#Overview","page":"Climate Forcing","title":"Overview","text":"This module implements the fundamental equations for climate sensitivity with feedbacks, radiative forcing from greenhouse gases, and Global Warming Potentials (GWPs) as presented in Chapter 23 \"Climate and Chemical Composition of the Atmosphere\" of Seinfeld & Pandis (2006).\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.","category":"section"},{"location":"climate_forcing/#Implementation","page":"Climate Forcing","title":"Implementation","text":"","category":"section"},{"location":"climate_forcing/#Climate-Feedback","page":"Climate Forcing","title":"Climate Feedback","text":"The climate feedback equations relate radiative forcing perturbations to equilibrium temperature changes with feedbacks (Eqs. 23.1-23.4 and 23.7). Note: The basic no-feedback climate sensitivity is implemented in ClimateSensitivity (Chapter 4); this component extends it by incorporating feedback processes.\n\nEq. 23.1 - Climate sensitivity with feedbacks:\n\nDelta T_s = lambda Delta F\n\nEq. 23.2 - No-feedback temperature response:\n\nDelta T_0 = lambda_0 Delta F\n\nEq. 23.3 - Efficacy of forcing agents:\n\nE_i = fraclambda_ilambda_CO_2\n\nEq. 23.4 - Effective forcing (incorporating efficacy):\n\nDelta F_e = Delta F_i cdot E_i\n\nEq. 23.7 - Unrealized (committed) warming (p. 1045):\n\nDelta T_textunrealized = (Delta F - Delta F_r) cdot lambda","category":"section"},{"location":"climate_forcing/#State-Variables","page":"Climate Forcing","title":"State Variables","text":"using GasChem, ModelingToolkit, Symbolics\nusing DynamicQuantities\nusing DataFrames\n\nsys = ClimateFeedback()\n\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars])","category":"section"},{"location":"climate_forcing/#Parameters","page":"Climate Forcing","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in params],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in params],\n    :Description => [ModelingToolkit.getdescription(v) for v in params],\n    :Default => [ModelingToolkit.hasdefault(v) ? ModelingToolkit.getdefault(v) : missing\n                 for v in params])","category":"section"},{"location":"climate_forcing/#Equations","page":"Climate Forcing","title":"Equations","text":"eqs = equations(sys)","category":"section"},{"location":"climate_forcing/#Greenhouse-Gas-Radiative-Forcing","page":"Climate Forcing","title":"Greenhouse Gas Radiative Forcing","text":"The GHGForcing component computes radiative forcing contributions from the major well-mixed greenhouse gases using reference values from IPCC (2001), as cited in Seinfeld & Pandis (2006), p. 1039.\n\nSpecies Forcing (W/m²)\nCO₂ 1.46\nCH₄ 0.48\nN₂O 0.15\nTropospheric O₃ 0.40\nHalocarbons 0.34\nTotal 2.83\n\nNote: The well-mixed GHG total (CO₂ + CH₄ + N₂O + halocarbons) is 2.43 W/m² as stated in the text; the total of 2.83 W/m² includes tropospheric O₃ forcing.","category":"section"},{"location":"climate_forcing/#State-Variables-2","page":"Climate Forcing","title":"State Variables","text":"ghg = GHGForcing()\nvars = unknowns(ghg)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars])","category":"section"},{"location":"climate_forcing/#Parameters-2","page":"Climate Forcing","title":"Parameters","text":"params = parameters(ghg)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in params],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in params],\n    :Description => [ModelingToolkit.getdescription(v) for v in params],\n    :Default => [ModelingToolkit.hasdefault(v) ? ModelingToolkit.getdefault(v) : missing\n                 for v in params])","category":"section"},{"location":"climate_forcing/#Equations-2","page":"Climate Forcing","title":"Equations","text":"eqs = equations(ghg)","category":"section"},{"location":"climate_forcing/#Global-Warming-Potential","page":"Climate Forcing","title":"Global Warming Potential","text":"The Global Warming Potential (GWP) is defined as the time-integrated radiative forcing from a pulse emission of 1 kg of a compound relative to 1 kg of CO₂ over a specified time horizon.\n\nEq. 23.5 - GWP definition:\n\ntextGWP = fracint_0^t_f a_A A(t) dtint_0^t_f a_R R(t) dt\n\nEq. 23.6 - Absolute GWP:\n\ntextAGWP_A = int_0^t_f a_A A(t) dt\n\nFor exponentially decaying species (Problem 23.3):\n\ntextGWP = fraca_A tau_A (1 - e^-t_ftau_A)a_CO_2 tau_CO_2 (1 - e^-t_ftau_CO_2)","category":"section"},{"location":"climate_forcing/#State-Variables-3","page":"Climate Forcing","title":"State Variables","text":"gwp_sys = GlobalWarmingPotential()\nvars = unknowns(gwp_sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars])","category":"section"},{"location":"climate_forcing/#Parameters-3","page":"Climate Forcing","title":"Parameters","text":"params = parameters(gwp_sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in params],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in params],\n    :Description => [ModelingToolkit.getdescription(v) for v in params],\n    :Default => [ModelingToolkit.hasdefault(v) ? ModelingToolkit.getdefault(v) : missing\n                 for v in params])","category":"section"},{"location":"climate_forcing/#Equations-3","page":"Climate Forcing","title":"Equations","text":"eqs = equations(gwp_sys)","category":"section"},{"location":"climate_forcing/#Analysis","page":"Climate Forcing","title":"Analysis","text":"","category":"section"},{"location":"climate_forcing/#Table-23.1:-Greenhouse-Gas-Properties-and-GWPs","page":"Climate Forcing","title":"Table 23.1: Greenhouse Gas Properties and GWPs","text":"Table 23.1 from Seinfeld & Pandis (2006) lists key greenhouse gases with their abundances, lifetimes, and 100-year GWPs. Using the exponential decay GWP formula (Problem 23.3), we can reproduce the tabulated GWP values by fitting the relative radiative efficiency parameter a. The table below compares computed GWPs against the textbook values for selected species.\n\nusing GasChem, DataFrames\n\n# Species data from Table 23.1 (Seinfeld & Pandis 2006, p. 1044)\n# τ = perturbation lifetime (yr), GWP_ref = tabulated 100-yr GWP\n# a = relative radiative efficiency (fitted to reproduce GWP_ref)\nspecies_data = [\n    (\"CH₄\", 12.0, 23, 140.0),\n    (\"N₂O\", 114.0, 296, 326.0),\n    (\"CF₄\", 50000.0, 5700, 390.0),\n    (\"C₂F₆\", 10000.0, 11900, 816.0),\n    (\"SF₆\", 3200.0, 22200, 1540.0),\n    (\"HFC-134a\", 13.8, 1300, 692.0),\n    (\"CFC-11\", 45.0, 4600, 753.0),\n    (\"CFC-12\", 100.0, 10600, 1162.0),\n    (\"CCl₄\", 35.0, 1800, 385.0)\n]\n\nnames_col = [s[1] for s in species_data]\nτ_col = [s[2] for s in species_data]\ngwp_ref_col = [s[3] for s in species_data]\ngwp_calc_col = [round(GWP_exponential(s[2], s[4], 100.0), digits = 0)\n                for s in species_data]\n\nDataFrame(\n    :Species => names_col,\n    Symbol(\"Lifetime (yr)\") => τ_col,\n    Symbol(\"GWP₁₀₀ (Table 23.1)\") => gwp_ref_col,\n    Symbol(\"GWP₁₀₀ (Computed)\") => gwp_calc_col)","category":"section"},{"location":"climate_forcing/#GWP-Calculations","page":"Climate Forcing","title":"GWP Calculations","text":"Using the GWP_exponential function to calculate GWPs for different species:\n\nusing Plots\n\n# Species parameters from Table 23.1\n# τ = atmospheric lifetime (years)\n# a = radiative efficiency relative to CO₂\n\n# Calculate GWP for CH₄ (τ = 12 yr)\n# Using fitted a value to match tabulated GWP₁₀₀ = 23\ngwp_ch4_100 = GWP_exponential(12.0, 140.0, 100.0)\nprintln(\"CH₄ GWP₁₀₀ = $(round(gwp_ch4_100, digits = 1))\")\n\n# N₂O (τ = 114 yr)\ngwp_n2o_100 = GWP_exponential(114.0, 326.0, 100.0)\nprintln(\"N₂O GWP₁₀₀ = $(round(gwp_n2o_100, digits = 1))\")\n\n# CO₂ relative to itself\ngwp_co2 = GWP_exponential(150.0, 1.0, 100.0)\nprintln(\"CO₂ GWP₁₀₀ = $(round(gwp_co2, digits = 1))\")","category":"section"},{"location":"climate_forcing/#Radiative-Forcing-After-Pulse-Emission-(Figure-23.13)","page":"Climate Forcing","title":"Radiative Forcing After Pulse Emission (Figure 23.13)","text":"Figure 23.13 shows the instantaneous radiative forcing (W m⁻² kg⁻¹) as a function of time after a pulse release of 1 kg of several greenhouse gases (IPCC 1995). For exponentially decaying species, the forcing decays as a_A exp(-ttau_A). Note that after 1 year, instantaneous forcings can differ by four orders of magnitude.\n\n# Reproduce Figure 23.13: Radiative forcing vs time after pulse release\n# For exponentially decaying species: F(t) = a_A × exp(-t/τ_A)\n# Using species lifetimes as labeled in Figure 23.13\nt_years = 1:1:1000\n\n# Radiative forcing decay: a_A × exp(-t/τ_A)\n# a values are in arbitrary units relative to each other (qualitative reproduction)\nforcing_c2f6 = [816.0 * exp(-Float64(t) / 10000.0) for t in t_years]\nforcing_n2o = [326.0 * exp(-Float64(t) / 120.0) for t in t_years]\nforcing_co2 = [1.0 * exp(-Float64(t) / 150.0) for t in t_years]\nforcing_hcfc225 = [100.0 * exp(-Float64(t) / 2.5) for t in t_years]\nforcing_hfc134a = [692.0 * exp(-Float64(t) / 13.8) for t in t_years]\n\np = plot(t_years, forcing_c2f6, label = \"C₂F₆ (τ≈10000 yr)\", lw = 2,\n    xscale = :log10, yscale = :log10,\n    ylim = (1e-8, 1e4))\nplot!(p, t_years, forcing_n2o, label = \"N₂O (τ≈120 yr)\", lw = 2)\nplot!(p, t_years, forcing_co2, label = \"CO₂ (τ≈150 yr)\", lw = 2)\nplot!(p, t_years, forcing_hcfc225, label = \"HCFC-225ca (τ≈2.5 yr)\", lw = 2)\nplot!(p, t_years, forcing_hfc134a, label = \"HFC-134a (τ≈13.8 yr)\", lw = 2)\nxlabel!(p, \"Time (years)\")\nylabel!(p, \"Instantaneous Radiative Forcing (relative)\")\ntitle!(p, \"Radiative Forcing After Pulse Emission (cf. Figure 23.13)\")\np","category":"section"},{"location":"climate_forcing/#Absolute-GWP-vs-Time-Horizon-(Figure-23.14)","page":"Climate Forcing","title":"Absolute GWP vs Time Horizon (Figure 23.14)","text":"Figure 23.14 shows the time-integrated radiative forcing (absolute GWP, W m⁻² kg⁻¹ yr) for a range of greenhouse gases, computed from the pulse-decay curves of Figure 23.13 (IPCC 1995). The AGWP is the numerator of the GWP expression (Eq. 23.6).\n\n# Reproduce Figure 23.14: Absolute GWP (time-integrated forcing) vs time horizon\n# AGWP_A = a_A × τ_A × (1 - exp(-t_f/τ_A))\nt_horizons_long = 1:1:1000\n\nagwp_c2f6 = [816.0 * 10000.0 * (1 - exp(-Float64(t) / 10000.0)) for t in t_horizons_long]\nagwp_hfc134a = [692.0 * 13.8 * (1 - exp(-Float64(t) / 13.8)) for t in t_horizons_long]\nagwp_hcfc225 = [100.0 * 2.5 * (1 - exp(-Float64(t) / 2.5)) for t in t_horizons_long]\nagwp_n2o = [326.0 * 120.0 * (1 - exp(-Float64(t) / 120.0)) for t in t_horizons_long]\nagwp_co2 = [1.0 * 150.0 * (1 - exp(-Float64(t) / 150.0)) for t in t_horizons_long]\n\np = plot(t_horizons_long, agwp_c2f6, label = \"C₂F₆ (τ≈10000 yr)\", lw = 2,\n    xscale = :log10, yscale = :log10)\nplot!(p, t_horizons_long, agwp_hfc134a, label = \"HFC-134a (τ≈13.8 yr)\", lw = 2)\nplot!(p, t_horizons_long, agwp_hcfc225, label = \"HCFC-225ca (τ≈2.5 yr)\", lw = 2)\nplot!(p, t_horizons_long, agwp_n2o, label = \"N₂O (τ≈120 yr)\", lw = 2)\nplot!(p, t_horizons_long, agwp_co2, label = \"CO₂ (τ≈150 yr)\", lw = 2)\nxlabel!(p, \"Time Horizon (years)\")\nylabel!(p, \"Absolute Global Warming Potential (relative)\")\ntitle!(p, \"Absolute GWP vs Time Horizon (cf. Figure 23.14)\")\np","category":"section"},{"location":"climate_forcing/#GWP-Time-Horizon-Dependence-(Figure-23.15)","page":"Climate Forcing","title":"GWP Time Horizon Dependence (Figure 23.15)","text":"GWP values depend strongly on the time horizon chosen. Short-lived species have higher GWPs at short time horizons, while long-lived species have relatively higher GWPs at longer horizons. This reproduces the behavior shown in Figure 23.15 of Seinfeld & Pandis (2006), which uses log-log axes.\n\n# Calculate GWP vs time horizon for species from Figure 23.15 (IPCC 1995)\n# Using lifetimes as labeled in the figure\nt_horizons = 1:1:500\n\n# C₂F₆ (τ ~ 10,000 yr, as labeled in Figure 23.15)\ngwp_c2f6 = [GWP_exponential(10000.0, 816.0, Float64(t)) for t in t_horizons]\n\n# HFC-134a (τ ~ 13.8 yr, from Table 23.1)\ngwp_hfc134a = [GWP_exponential(13.8, 692.0, Float64(t)) for t in t_horizons]\n\n# N₂O (τ ~ 120 yr, as labeled in Figure 23.15)\ngwp_n2o = [GWP_exponential(120.0, 326.0, Float64(t)) for t in t_horizons]\n\n# HCFC-225ca (τ ~ 2.5 yr, as labeled in Figure 23.15)\ngwp_hcfc225 = [GWP_exponential(2.5, 100.0, Float64(t)) for t in t_horizons]\n\np = plot(t_horizons, gwp_c2f6, label = \"C₂F₆ (τ≈10000 yr)\", lw = 2,\n    xscale = :log10, yscale = :log10)\nplot!(p, t_horizons, gwp_hfc134a, label = \"HFC-134a (τ≈13.8 yr)\", lw = 2)\nplot!(p, t_horizons, gwp_n2o, label = \"N₂O (τ≈120 yr)\", lw = 2)\nplot!(p, t_horizons, gwp_hcfc225, label = \"HCFC-225ca (τ≈2.5 yr)\", lw = 2)\nxlabel!(p, \"Time Horizon (years)\")\nylabel!(p, \"Global Warming Potential\")\ntitle!(p, \"GWP vs Time Horizon (cf. Figure 23.15)\")\np","category":"section"},{"location":"climate_forcing/#Climate-Feedback-Factor","page":"Climate Forcing","title":"Climate Feedback Factor","text":"The climate feedback factor is defined as the ratio of the climate sensitivity with feedbacks to the no-feedback sensitivity:\n\ntextFeedback Factor = fraclambdalambda_0\n\nFrom page 1040 of Seinfeld & Pandis (2006), typical values range from 1.2 to 3.75, corresponding to equilibrium climate sensitivities for CO₂ doubling (ΔT₂ₓCO₂) of approximately 1.5 to 4.5 K.","category":"section"},{"location":"climate_forcing/#Unrealized-Warming","page":"Climate Forcing","title":"Unrealized Warming","text":"The Earth system has thermal inertia, primarily due to the oceans, which means that the full warming response to current forcing levels has not yet been realized. The unrealized (or committed) warming represents the additional temperature increase that will occur even if forcing is held constant.\n\nFrom page 1045 of Seinfeld & Pandis (2006):\n\nCurrent forcing: ΔF ≈ 1.7 W/m²\nRealized warming: ΔT_r ≈ 0.7 K\nWith λ ≈ 0.7 K/(W/m²): unrealized warming ≈ 0.5 K\n\nThis means even with no additional emissions, the Earth is committed to approximately 0.5 K of additional warming.","category":"section"},{"location":"climate_forcing/#GasChem.ClimateFeedback","page":"Climate Forcing","title":"GasChem.ClimateFeedback","text":"ClimateFeedback(; name) -> ModelingToolkitBase.System\n\n\nClimate feedback model relating radiative forcing to equilibrium temperature change with feedbacks.\n\nThis model implements the climate sensitivity equations with feedback from Seinfeld & Pandis (2006), Chapter 23 \"Climate and Chemical Composition of the Atmosphere\", Section 23.4.\n\nNote: This extends the basic no-feedback climate sensitivity from Chapter 4 (see ClimateSensitivity) by incorporating climate feedback processes.\n\nThe model includes:\n\nEq. 23.1: ΔTs = λ ΔF (climate sensitivity with feedbacks)\nEq. 23.2: ΔT₀ = λ₀ ΔF (no-feedback temperature response)\nEq. 23.3: Eᵢ = λᵢ / λ_CO₂ (efficacy of forcing agents)\nEq. 23.4: ΔFₑ = ΔFᵢ Eᵢ (effective forcing)\nEq. 23.7: ΔTunrealized = (ΔF - ΔFr) λ (unrealized warming, p. 1045)\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = ClimateFeedback()\n\n\n\n\n\n","category":"function"},{"location":"climate_forcing/#GasChem.GHGForcing","page":"Climate Forcing","title":"GasChem.GHGForcing","text":"GHGForcing(; name) -> ModelingToolkitBase.System\n\n\nGreenhouse gas radiative forcing model.\n\nComputes the radiative forcing from well-mixed greenhouse gases using values from IPCC (2001) as presented in Seinfeld & Pandis (2006), Chapter 23, Section 23.3.\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = GHGForcing()\n\n\n\n\n\n","category":"function"},{"location":"climate_forcing/#GasChem.GlobalWarmingPotential","page":"Climate Forcing","title":"GasChem.GlobalWarmingPotential","text":"GlobalWarmingPotential(; name) -> ModelingToolkitBase.System\n\n\nGlobal Warming Potential (GWP) calculation for exponentially decaying species.\n\nImplements Eq. 23.5 and 23.6 from Seinfeld & Pandis (2006), Chapter 23, for the special case of exponential decay of atmospheric perturbations. Also implements the closed-form GWP formula from Problem 23.3 (p. 1050).\n\nThe GWP is defined as the ratio of the time-integrated radiative forcing from a pulse emission of 1 kg of compound A to that of 1 kg of CO₂ over a specified time horizon.\n\nEquations implemented:\n\nEq. 23.5: GWP = ∫₀^{tf} aₐ[A(t)]dt / ∫₀^{tf} a_R[R(t)]dt\nEq. 23.6: AGWP_A = ∫₀^{tf} aₐ[A(t)]dt\nProblem 23.3: GWP = [aₐ τₐ (1 - e^{-tf/τₐ})] / [aCO₂ τCO₂ (1 - e^{-tf/τ_CO₂})]\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = GlobalWarmingPotential()\n\n\n\n\n\n","category":"function"},{"location":"climate_forcing/#GasChem.GWP_exponential","page":"Climate Forcing","title":"GasChem.GWP_exponential","text":"GWP_exponential(τ_A, a_A, t_f; τ_CO2=150.0)\n\nCalculate the Global Warming Potential using the closed-form solution for exponential decay.\n\nThis implements the formula from Problem 23.3 (p. 1050) of Seinfeld & Pandis (2006):\n\nGWP = fraca_A tau_A (1 - e^-t_ftau_A)a_CO_2 tau_CO_2 (1 - e^-t_ftau_CO_2)\n\nArguments\n\nτ_A: Atmospheric lifetime of species A [years]\na_A: Radiative efficiency of species A relative to CO₂ (dimensionless)\nt_f: Time horizon for GWP calculation [years]\nτ_CO2: Effective CO₂ lifetime (default: 150 years)\n\nReturns\n\nGWP: Global Warming Potential relative to CO₂ (dimensionless)\n\nExample\n\n# Calculate 100-year GWP for CH₄ (τ = 12 yr, fitted relative efficiency ≈ 140)\ngwp_ch4 = GWP_exponential(12.0, 140.0, 100.0)\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, Problem 23.3.\n\n\n\n\n\n","category":"function"},{"location":"composing_models/#Composing-Models","page":"Composing models","title":"Composing Models","text":"","category":"section"},{"location":"composing_models/#Illustrative-Example","page":"Composing models","title":"Illustrative Example","text":"Here is the complete example of composing, visualizing and solving the SuperFast model and the Fast-JX model, with explanation to follow:\n\nusing EarthSciMLBase, GasChem, ModelingToolkit, Dates, DynamicQuantities,\n      OrdinaryDiffEqDefault, OrdinaryDiffEqRosenbrock\nusing ModelingToolkit: t\n\nstart = Dates.datetime2unix(Dates.DateTime(2024, 2, 29))\n\ncomposed_ode = couple(SuperFast(), FastJX(start)) # Compose two models use the \"couple\" function\n\ntspan = (0.0, 3600.0*24*3)\nsys = convert(System, composed_ode) # Define the coupled system\nsol = solve(ODEProblem(sys, [], tspan; build_initializeprob = false), Rosenbrock23(), saveat = 10.0) # Solve the coupled system\n\nIn the composed system, the variable name for O₃ is not O3 but superfast₊O3(t). So we need some preparation of the result before visualizing.\n\nvars = unknowns(sys)  # Get the variables in the composed system\nvar_dict = Dict(string(var) => var for var in vars)\npols = [\"O3\", \"OH\", \"NO\", \"NO2\", \"CH3O2\", \"CO\", \"CH3OOH\", \"CH2O\", \"ISOP\"]\nvar_names_p = [\"SuperFast₊$(v)(t)\" for v in pols]\n\nx_t = unix2datetime.(sol[t] .+ start) # Convert from unixtime to date time for visualizing \n\nThen, we could plot the results as:\n\nusing Plots\npp = []\nfor (i, v) in enumerate(var_names_p)\n    name = pols[i]\n    push!(pp,\n        Plots.plot(\n            x_t, sol[var_dict[v]], label = \"$name\", size = (1000, 600), xrotation = 45))\nend\nPlots.plot(pp..., layout = (3, 3))","category":"section"},{"location":"composing_models/#Adding-Emission-Data","page":"Composing models","title":"Adding Emission Data","text":"GasChem.jl incorporates an emissions model that utilizes data from the US National Emissions Inventory for the year 2016. This model is activated as an extension when the EarthSciData package is used. Here's a simple example:\n\nusing GasChem, EarthSciData # This will trigger the emission extension\nusing Dates, ModelingToolkit, OrdinaryDiffEqDefault, OrdinaryDiffEqRosenbrock,\n      EarthSciMLBase\nusing Plots, DynamicQuantities\nusing ModelingToolkit: t\n\ndomain = DomainInfo(\n    Dates.DateTime(2016, 5, 1), Dates.DateTime(2016, 5, 4);\n    lonrange = deg2rad(-129):deg2rad(1):deg2rad(-61),\n    latrange = deg2rad(11):deg2rad(1):deg2rad(59),\n    levrange = 1:1:3)\n\nemis = NEI2016MonthlyEmis(\"mrggrid_withbeis_withrwc\", domain)\n\nmodel_noemis = couple(SuperFast(), FastJX(get_tref(domain))) # A model with chemistry and photolysis, but no emissions.\nmodel_withemis = couple(SuperFast(), FastJX(get_tref(domain)), emis) # The same model with emissions.\n\nsys_noemis = convert(System, model_noemis)\nsys_withemis = convert(System, model_withemis)\n\ntspan = EarthSciMLBase.get_tspan(domain)\nsol_noemis = solve(ODEProblem(sys_noemis, [], tspan; build_initializeprob = false), Rosenbrock23())\nsol_withemis = solve(ODEProblem(sys_withemis, [], tspan; build_initializeprob = false), Rosenbrock23())\n\nvars = unknowns(sys_noemis)  # Get the variables in the composed system\nvar_dict = Dict(string(var) => var for var in vars)\npols = [\"O3\", \"OH\", \"NO\", \"NO2\", \"CH3O2\", \"CO\", \"CH3OOH\", \"CH2O\", \"ISOP\"]\nvar_names_p = [\"SuperFast₊$(v)(t)\" for v in pols]\n\npp = []\nfor (i, v) in enumerate(var_names_p)\n    p = plot(unix2datetime.(sol_noemis[t] .+ get_tref(domain)), sol_noemis[var_dict[v]],\n        label = \"No Emissions\", title = v,\n        size = (1000, 600), xrotation = 45)\n    plot!(unix2datetime.(sol_withemis[t] .+ get_tref(domain)),\n        sol_withemis[var_dict[v]], label = \"With Emissions\")\n    push!(pp, p)\nend\nPlots.plot(pp..., layout = (3, 3))","category":"section"},{"location":"nox_photochemistry/#nox_photochemistry","page":"NOx Photochemistry","title":"NOx Photochemistry","text":"","category":"section"},{"location":"nox_photochemistry/#Overview","page":"NOx Photochemistry","title":"Overview","text":"The NOx (NO + NO2) photochemical cycle is fundamental to tropospheric ozone chemistry. In the absence of other species, three reactions cycle rapidly between NO, NO2, and O3 during the day, establishing a \"photostationary state\" known as the Leighton relationship (Eq. 6.6).\n\nThis system implements equations 6.5-6.8 from Section 6.2 of Seinfeld & Pandis, including the ground-state O atom steady state, the photostationary state ozone concentration, the photostationary state deviation parameter (Phi), and the net ozone production rate.\n\nTwo components are provided:\n\nNOxPhotochemistry: Full diagnostic system with all four equations\nPhotostationaryState: Simplified system for analyzing deviations from the Leighton relationship\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Section 6.2, pp. 207-212.","category":"section"},{"location":"nox_photochemistry/#Implementation","page":"NOx Photochemistry","title":"Implementation","text":"","category":"section"},{"location":"nox_photochemistry/#NOxPhotochemistry:-State-Variables","page":"NOx Photochemistry","title":"NOxPhotochemistry: State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, GasChem\n\nsys = NOxPhotochemistry()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"nox_photochemistry/#NOxPhotochemistry:-Parameters","page":"NOx Photochemistry","title":"NOxPhotochemistry: Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"nox_photochemistry/#NOxPhotochemistry:-Equations","page":"NOx Photochemistry","title":"NOxPhotochemistry: Equations","text":"eqs = equations(sys)","category":"section"},{"location":"nox_photochemistry/#PhotostationaryState:-State-Variables","page":"NOx Photochemistry","title":"PhotostationaryState: State Variables","text":"pss = PhotostationaryState()\nvars_pss = unknowns(pss)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars_pss],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars_pss],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars_pss]\n)","category":"section"},{"location":"nox_photochemistry/#PhotostationaryState:-Equations","page":"NOx Photochemistry","title":"PhotostationaryState: Equations","text":"equations(pss)","category":"section"},{"location":"nox_photochemistry/#Analysis","page":"NOx Photochemistry","title":"Analysis","text":"","category":"section"},{"location":"nox_photochemistry/#Photostationary-State-O3-vs-NO2/NO-Ratio","page":"NOx Photochemistry","title":"Photostationary State O3 vs NO2/NO Ratio","text":"The Leighton relationship (Eq. 6.6) predicts that the photostationary state ozone concentration is proportional to the NO2/NO ratio:\n\nO_3_pss = fracj_NO_2k_NO+O_3 cdot fracNO_2NO\n\nThis analysis uses the actual NOxPhotochemistry system to compute O_3_pss across a range of NO2/NO ratios for typical midday photolysis conditions.\n\nusing Plots, NonlinearSolve\n\nsys_nns = ModelingToolkit.toggle_namespacing(sys, false)\ninput_vars = [sys_nns.NO, sys_nns.NO2, sys_nns.O3, sys_nns.O2, sys_nns.M]\ncompiled = mtkcompile(sys; inputs = input_vars)\n\n# Fixed conditions (SI: m⁻³)\nM_val = 2.5e25\nO2_val = 5.25e24\nNO_val = 2.5e16   # 1 ppb\n\n# Vary NO2/NO ratio from 0.1 to 10\nratio_NO2_NO = range(0.1, 10.0, length = 200)\nNO2_range = ratio_NO2_NO .* NO_val\nO3_dummy = 1e18   # O3 input doesn't affect O3_pss calculation\n\nprob = NonlinearProblem(compiled,\n    Dict(compiled.NO => NO_val, compiled.NO2 => NO2_range[1], compiled.O3 => O3_dummy,\n        compiled.O2 => O2_val, compiled.M => M_val);\n    build_initializeprob = false)\n\nO3_pss_vals = Float64[]\nfor no2 in NO2_range\n    newprob = remake(prob, p = [compiled.NO2 => no2])\n    sol = solve(newprob)\n    push!(O3_pss_vals, sol[compiled.O3_pss])\nend\n\n# Convert to ppb (1 ppb = 2.5e16 m⁻³)\nO3_ppb = O3_pss_vals ./ 2.5e16\n\nplot(ratio_NO2_NO, O3_ppb,\n    xlabel = \"[NO₂]/[NO] ratio\",\n    ylabel = \"O₃ (ppb)\",\n    title = \"Photostationary State O₃ (Eq. 6.6)\",\n    label = \"O₃_pss from NOxPhotochemistry\",\n    linewidth = 2, legend = :topleft, size = (600, 400))\nsavefig(\"nox_pss_o3.svg\") # hide\n\n(Image: Photostationary state O3 vs NO2/NO ratio)\n\nThe linear relationship shows that higher NO2/NO ratios lead to higher photostationary state ozone. For a ratio of 2 (typical of moderately polluted conditions), the predicted O3 is about 34 ppb. In real urban environments, Phi > 1 because peroxy radicals (HO2, RO2) provide an additional pathway for NO-to-NO2 conversion beyond the O3 + NO reaction.","category":"section"},{"location":"nox_photochemistry/#Photostationary-State-Parameter-(Phi)-Interpretation","page":"NOx Photochemistry","title":"Photostationary State Parameter (Phi) Interpretation","text":"The deviation of Phi from unity indicates the importance of peroxy radical chemistry. This analysis uses the PhotostationaryState system to compute Phi across a range of measured O3 values.\n\npss_nns = ModelingToolkit.toggle_namespacing(pss, false)\npss_inputs = [pss_nns.NO, pss_nns.NO2, pss_nns.O3]\npss_compiled = mtkcompile(pss; inputs = pss_inputs)\n\nNO_val = 2.5e16       # 1 ppb (m⁻³)\nNO2_val = 5.0e16      # 2 ppb (m⁻³)\nO3_range = range(0.5e18, 3e18, length = 200)  # 20-120 ppb (m⁻³)\n\npss_prob = NonlinearProblem(pss_compiled,\n    Dict(pss_compiled.NO => NO_val, pss_compiled.NO2 => NO2_val, pss_compiled.O3 => O3_range[1]);\n    build_initializeprob = false)\n\nPhi_vals = Float64[]\nfor o3 in O3_range\n    newprob = remake(pss_prob, p = [pss_compiled.O3 => o3])\n    sol = solve(newprob)\n    push!(Phi_vals, sol[pss_compiled.Φ])\nend\n\nO3_ppb_axis = O3_range ./ 2.5e16\n\nplot(O3_ppb_axis, Phi_vals,\n    xlabel = \"Measured O₃ (ppb)\",\n    ylabel = \"Φ\",\n    title = \"Photostationary State Parameter vs O₃\",\n    label = \"Φ (NO=1 ppb, NO₂=2 ppb)\",\n    linewidth = 2, legend = :topright, size = (600, 400))\nhline!([1.0], linestyle = :dash, color = :gray, label = \"Φ = 1 (exact PSS)\")\nannotate!([(90, 2.0, text(\"Φ > 1: net O₃ production\\n(peroxy radicals active)\", 8, :left)),\n    (90, 0.6, text(\"Φ < 1: net O₃ loss\", 8, :left))])\nsavefig(\"nox_phi.svg\") # hide\n\n(Image: Photostationary state parameter Phi)\n\nWhen measured O3 is lower than the photostationary state value, Phi > 1, indicating that peroxy radicals are converting NO to NO2 and producing O3. When measured O3 exceeds the PSS value, Phi < 1. Typical urban daytime measurements show Phi = 1.5-3, reflecting significant peroxy radical activity.","category":"section"},{"location":"nox_photochemistry/#Table:-Steady-State-O3-from-Pure-NO2-(Eq.-6.8)","page":"NOx Photochemistry","title":"Table: Steady-State O3 from Pure NO2 (Eq. 6.8)","text":"Seinfeld & Pandis (p. 210) present the O3 mixing ratio attained as a function of the initial NO2 mixing ratio when O_3_0 = NO_0 = 0, using Eq. 6.8 with a typical value of j_NO_2k_3 = 10 ppb.\n\nThe analytical solution (Eq. 6.8) uses nitrogen conservation (NO + NO_2 = NO_2_0) and the stoichiometric relation (O_3 - O_3_0 = NO_0 - NO) to find the steady-state O3 from the Leighton relationship. We extract the rate constant ratio from the NOxPhotochemistry system parameters.\n\nusing DataFrames\n\n# Extract j_NO2 / k_NO_O3 from system parameters\nj_NO2_val = Float64(ModelingToolkit.getdefault(sys.j_NO2))\nk_NO_O3_val = Float64(ModelingToolkit.getdefault(sys.k_NO_O3))\nj_over_k_SI = j_NO2_val / k_NO_O3_val   # in m⁻³\n\n# Convert to ppb (1 ppb = 2.5e16 m⁻³ at STP)\nppb_conv = 2.5e16\nj_over_k_ppb = j_over_k_SI / ppb_conv\n\n# The book uses j/k = 10 ppb as a rounded illustration value.\n# Our system gives j/k ≈ $(round(j_over_k_ppb, sigdigits=3)) ppb.\n# For comparison with the book's table, we show both.\nj_over_k_book = 10.0  # ppb (rounded value from p. 210)\n\nNO2_0_ppb = [100, 1000]\n\n# Eq. 6.8: [O3] = 0.5 * { sqrt((j/k)^2 + 4*(j/k)*[NO2]_0) - j/k }\nO3_system = [0.5 * (sqrt(j_over_k_ppb^2 + 4 * j_over_k_ppb * n) - j_over_k_ppb)\n             for n in NO2_0_ppb]\nO3_book = [0.5 * (sqrt(j_over_k_book^2 + 4 * j_over_k_book * n) - j_over_k_book)\n           for n in NO2_0_ppb]\n\nDataFrame(\n    Symbol(\"[NO₂]₀ (ppb)\") => NO2_0_ppb,\n    Symbol(\"[O₃] (ppb, system params)\") => [round(o, sigdigits = 3) for o in O3_system],\n    Symbol(\"[O₃] (ppb, j/k=10 ppb)\") => [round(o, sigdigits = 3) for o in O3_book],\n    Symbol(\"[O₃] (ppb, S&P Table)\") => [27, 95]\n)\n\nThe computed values match the textbook values, confirming the correct implementation of the photostationary state relationship. The small difference between the system parameter values and the book's jk = 10 ppb is because the book uses a rounded value for illustration.","category":"section"},{"location":"nox_photochemistry/#GasChem.NOxPhotochemistry","page":"NOx Photochemistry","title":"GasChem.NOxPhotochemistry","text":"NOxPhotochemistry(; name)\n\nModelingToolkit System for the NOx photochemical cycle.\n\nImplements the photostationary state relationships (Eqs. 6.5-6.8) from Seinfeld & Pandis Chapter 6.\n\nInput Variables\n\nNO: Nitric oxide concentration [m⁻³]\nNO2: Nitrogen dioxide concentration [m⁻³]\nO3: Ozone concentration [m⁻³]\nO2: Molecular oxygen concentration [m⁻³]\nM: Total air number density [m⁻³]\n\nOutput Variables\n\nO: Ground-state oxygen atom concentration [m⁻³]\nO3_pss: Photostationary state ozone concentration [m⁻³]\nΦ: Photostationary state parameter [dimensionless]\nP_O3: Net ozone production rate [m⁻³ s⁻¹]\n\nParameters\n\nj_NO2: NO₂ photolysis rate [s⁻¹]\nk_O_O2_M: Rate constant for O + O₂ + M → O₃ [m⁶ s⁻¹]\nk_NO_O3: Rate constant for NO + O₃ → NO₂ + O₂ [m³ s⁻¹]\n\nRate Constants at 298 K (from Table B.1)\n\nj_NO2 ≈ 8 × 10⁻³ s⁻¹ (typical midday value)\nkOO2_M = 6.0 × 10⁻³⁴ cm⁶ molecule⁻² s⁻¹ = 6.0 × 10⁻⁴⁶ m⁶ s⁻¹    # Parameters (rate constants converted to SI)\nkNOO3 = 1.9 × 10⁻¹⁴ cm³ molecule⁻¹ s⁻¹ = 1.9 × 10⁻²⁰ m³ s⁻¹ (p. 211)\n\n\n\n\n\n","category":"function"},{"location":"nox_photochemistry/#GasChem.PhotostationaryState","page":"NOx Photochemistry","title":"GasChem.PhotostationaryState","text":"PhotostationaryState(; name)\n\nSimplified model for analyzing photostationary state deviations.\n\nThis system calculates the deviation from photostationary state (Φ - 1), which indicates the net effect of peroxy radical chemistry on the NO-NO₂-O₃ cycle.\n\nWhen Φ > 1: Additional oxidants (HO₂, RO₂) are converting NO to NO₂ When Φ < 1: Additional reductants are present When Φ = 1: Pure photostationary state (no net ozone production)\n\n\n\n\n\n","category":"function"},{"location":"combined_system/#combined_system","page":"Combined System","title":"Combined System","text":"","category":"section"},{"location":"combined_system/#Overview","page":"Combined System","title":"Overview","text":"The TroposphericChemistrySystem integrates the individual chemistry mechanisms from Chapter 6 into a comprehensive tropospheric chemistry diagnostic model. It couples:\n\nOH production from O3 photolysis (Section 6.1, via OHProduction)\nNOx photochemical cycle (Section 6.2, via NOxPhotochemistry)\nCO oxidation and HOx cycling (Section 6.3, via COOxidation)\n\nThe systems are coupled through shared species (OH, HO2, NO, NO2, O3) and the combined system computes aggregate diagnostics including net O3 production, OPE, and HOx chain length.\n\nCondition systems provide typical atmospheric conditions for different environments.\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Chapter 6.","category":"section"},{"location":"combined_system/#Implementation","page":"Combined System","title":"Implementation","text":"","category":"section"},{"location":"combined_system/#State-Variables","page":"Combined System","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, GasChem\n\nsys = TroposphericChemistrySystem()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"combined_system/#Parameters","page":"Combined System","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"combined_system/#Equations","page":"Combined System","title":"Equations","text":"eqs = equations(sys)","category":"section"},{"location":"combined_system/#Typical-Atmospheric-Conditions","page":"Combined System","title":"Typical Atmospheric Conditions","text":"The module provides condition systems for three atmospheric environments:\n\nusing DataFrames\n\nconditions = [\n    (\"Background\", get_conditions_dict(TypicalConditions())),\n    (\"Urban\", get_conditions_dict(UrbanConditions())),\n    (\"Remote\", get_conditions_dict(RemoteConditions()))\n]\n\n# Show key species for each condition\nspecies = [:O3, :NO, :NO2, :CO, :OH, :HO2]\nheader = vcat([:Species, :Units], [Symbol(c[1]) for c in conditions])\n\nrows = []\nfor s in species\n    ppb_factor = 2.5e16  # m⁻³ per ppb at STP\n    vals = [c[2][s] for c in conditions]\n    ppb_vals = vals ./ ppb_factor\n    push!(rows,\n        (\n            Species = string(s),\n            Units = \"ppb\",\n            Background = round(ppb_vals[1], sigdigits = 3),\n            Urban = round(ppb_vals[2], sigdigits = 3),\n            Remote = round(ppb_vals[3], sigdigits = 3)\n        ))\nend\nDataFrame(rows)","category":"section"},{"location":"combined_system/#Analysis","page":"Combined System","title":"Analysis","text":"","category":"section"},{"location":"combined_system/#O3-Production-in-Different-NOx-Regimes","page":"Combined System","title":"O3 Production in Different NOx Regimes","text":"The combined system captures the transition between NOx-limited and VOC-limited regimes. In the NOx-limited regime (remote conditions), O3 production increases linearly with NOx. In the VOC-limited regime (urban conditions), adding more NOx can actually decrease O3.\n\nThis analysis uses the TroposphericChemistrySystem to compute how net O3 production and OPE vary across a range of NOx levels. The HO2 concentration is estimated from steady-state approximations (Eqs. 6.13 and 6.18), and the resulting concentrations are fed into the compiled system to compute the diagnostics.\n\nusing Plots, NonlinearSolve\n\n# Compile the TroposphericChemistrySystem with all species as inputs\nsys_nns = ModelingToolkit.toggle_namespacing(sys, false)\ninput_vars = [sys_nns.O3, sys_nns.NO, sys_nns.NO2, sys_nns.OH, sys_nns.HO2,\n    sys_nns.CO, sys_nns.CH3O2, sys_nns.H2O, sys_nns.M, sys_nns.O2]\ncompiled = mtkcompile(sys; inputs = input_vars)\n\n# Extract rate constants from the system parameters for HO2 estimation\nk_HO2_NO_val = Float64(ModelingToolkit.getdefault(sys.co.k_HO2_NO))\nk_HO2_HO2_val = Float64(ModelingToolkit.getdefault(sys.co.k_HO2_HO2))\nk_CO_OH_val = Float64(ModelingToolkit.getdefault(sys.co.k_CO_OH))\n\n# Fixed conditions (background, SI: m⁻³)\nCO_val = 2.5e18     # 100 ppb\nO3_val = 1e18       # 40 ppb\nOH_val = 1e12       # typical daytime\nCH3O2_val = 1e14    # typical\nH2O_val = 4e23\nM_val = 2.5e25\nO2_val = 5.25e24\nP_HOx_est = 1e12    # m⁻³/s (for HO2 estimation from Eq. 6.13)\n\n# Vary NO from 10 ppt to 100 ppb\nNO_ppb = 10 .^ range(-2, 2, length = 300)\nNO_vals = NO_ppb .* 2.5e16  # m⁻³\nNO2_vals = 2 .* NO_vals     # assume NO2/NO ratio ~ 2\n\n# Estimate HO2 from steady state (Eqs. 6.13 and 6.18)\nHO2_high_NOx = k_CO_OH_val .* CO_val .* OH_val ./ (k_HO2_NO_val .* NO_vals)\nHO2_low_NOx = sqrt(P_HOx_est / (2 * k_HO2_HO2_val))\nHO2_vals = min.(HO2_high_NOx, HO2_low_NOx)\n\n# Solve the combined system for each NO level\nprob = NonlinearProblem(compiled,\n    Dict(compiled.O3 => O3_val, compiled.NO => NO_vals[1], compiled.NO2 => NO2_vals[1],\n        compiled.OH => OH_val, compiled.HO2 => HO2_vals[1], compiled.CO => CO_val,\n        compiled.CH3O2 => CH3O2_val, compiled.H2O => H2O_val, compiled.M => M_val,\n        compiled.O2 => O2_val);\n    build_initializeprob = false)\n\nP_O3_net_vals = Float64[]\nOPE_result = Float64[]\nfor i in eachindex(NO_ppb)\n    newprob = remake(prob,\n        p = [compiled.NO => NO_vals[i], compiled.NO2 => NO2_vals[i],\n            compiled.HO2 => HO2_vals[i]])\n    sol = solve(newprob)\n    push!(P_O3_net_vals, sol[compiled.P_O3_net])\n    push!(OPE_result, sol[compiled.OPE])\nend\n\np1 = plot(NO_ppb, P_O3_net_vals ./ 1e12,\n    xlabel = \"NO (ppb)\",\n    ylabel = \"Net P(O₃) (10¹² m⁻³ s⁻¹)\",\n    title = \"Net O₃ Production vs NOx\",\n    xscale = :log10, linewidth = 2,\n    label = \"P(O₃)_net\", legend = :topleft)\nvline!([0.1], linestyle = :dash, color = :gray, label = \"Background NO\")\nvline!([10.0], linestyle = :dash, color = :red, label = \"Urban NO\")\n\np2 = plot(NO_ppb, OPE_result,\n    xlabel = \"NO (ppb)\",\n    ylabel = \"OPE (mol O₃ / mol NOx)\",\n    title = \"Ozone Production Efficiency\",\n    xscale = :log10, yscale = :log10, linewidth = 2,\n    label = \"OPE\", legend = :topright, ylims = (0.1, 1000))\nhline!([3.0], linestyle = :dot, color = :red, label = \"Urban OPE ~ 1-3\")\nhline!([15.0], linestyle = :dot, color = :blue, label = \"Remote OPE ~ 10-30\")\n\nplot(p1, p2, layout = (1, 2), size = (900, 400))\nsavefig(\"combined_o3_regimes.svg\") # hide\n\n(Image: O3 production in different NOx regimes)\n\nThe left panel shows that net O3 production peaks at intermediate NOx levels and decreases at very high NOx due to O3 titration by NO and reduced HO2 concentrations. The right panel shows that OPE decreases monotonically with increasing NOx, from OPE > 10 in remote conditions to OPE of 1-3 in urban environments, consistent with Section 6.3 of Seinfeld & Pandis.","category":"section"},{"location":"combined_system/#Comparison-of-Atmospheric-Conditions","page":"Combined System","title":"Comparison of Atmospheric Conditions","text":"This table computes key diagnostics for each of the three standard atmospheric environments by compiling and solving the TroposphericChemistrySystem with the conditions from each environment.\n\nenvironments = [\n    (\"Background\", get_conditions_dict(TypicalConditions())),\n    (\"Urban\", get_conditions_dict(UrbanConditions())),\n    (\"Remote\", get_conditions_dict(RemoteConditions()))\n]\n\nresults = []\nfor (name, cond) in environments\n    env_prob = remake(prob,\n        p = [compiled.O3 => cond[:O3], compiled.NO => cond[:NO],\n            compiled.NO2 => cond[:NO2], compiled.OH => cond[:OH],\n            compiled.HO2 => cond[:HO2], compiled.CO => cond[:CO],\n            compiled.CH3O2 => cond[:CH3O2], compiled.H2O => cond[:H2O],\n            compiled.M => cond[:M], compiled.O2 => cond[:O2]])\n    sol = solve(env_prob)\n\n    push!(results,\n        (\n            Environment = name,\n            NO_ppb = round(cond[:NO] / 2.5e16, sigdigits = 3),\n            O3_ppb = round(cond[:O3] / 2.5e16, sigdigits = 3),\n            P_O3 = round(sol[compiled.P_O3_total], sigdigits = 3),\n            OPE = round(sol[compiled.OPE], sigdigits = 3),\n            Chain_Length = round(sol[compiled.chain_length], sigdigits = 3)\n        ))\nend\n\nDataFrame(results)\n\nThis table shows how the key photochemical diagnostics vary across different atmospheric environments, illustrating the transition from NOx-limited (remote, high OPE and long chain length) to VOC-limited (urban, low OPE and short chain length) regimes discussed in Chapter 6.","category":"section"},{"location":"combined_system/#GasChem.TroposphericChemistrySystem","page":"Combined System","title":"GasChem.TroposphericChemistrySystem","text":"TroposphericChemistrySystem(; name)\n\nCombined ModelingToolkit System for tropospheric chemistry diagnostics.\n\nThis system couples the OH production, NOx cycling, and CO/CH₄ oxidation mechanisms to create a comprehensive diagnostic model of tropospheric photochemistry.\n\nKey coupling points:\n\nOH is produced from O₃ photolysis and HO₂ + NO reaction\nOH is consumed by CO, CH₄, and other species\nHO₂ is produced from CO/VOC oxidation\nHO₂ is lost to NO (producing OH) and self-reaction\nNOx cycles between NO and NO₂ through O₃ and peroxy radicals\nO₃ is produced when peroxy radicals oxidize NO to NO₂\n\nSubsystem Composition:\n\noh: OHProduction subsystem (Section 6.1)\nnox: NOxPhotochemistry subsystem (Section 6.2)\nco: COOxidation subsystem (Section 6.3)\n\nInput Variables\n\nAll species concentrations must be provided as inputs [m⁻³].\n\nDiagnostic outputs:\n\nPO3net: Net ozone production rate [m⁻³ s⁻¹]\nOPE: Ozone production efficiency [dimensionless]\nHOx: Total HOx (OH + HO₂) [m⁻³]    # =========================================================================\nchain_length: HOx chain length [dimensionless]    # Subsystems (composed from individual component functions)\n\n\n\n\n\n","category":"function"},{"location":"combined_system/#GasChem.TypicalConditions","page":"Combined System","title":"GasChem.TypicalConditions","text":"TypicalConditions(; name)\n\nModelingToolkit System representing typical lower troposphere conditions.\n\nAll concentrations are parameters in SI units (m⁻³).\n\nBased on values from Seinfeld & Pandis Chapter 6.\n\n\n\n\n\n","category":"function"},{"location":"combined_system/#GasChem.UrbanConditions","page":"Combined System","title":"GasChem.UrbanConditions","text":"UrbanConditions(; name)\n\nModelingToolkit System representing typical urban conditions with elevated NOx.\n\nAll concentrations are parameters in SI units (m⁻³).\n\n\n\n\n\n","category":"function"},{"location":"combined_system/#GasChem.RemoteConditions","page":"Combined System","title":"GasChem.RemoteConditions","text":"RemoteConditions(; name)\n\nModelingToolkit System representing typical remote/background conditions with low NOx.\n\nAll concentrations are parameters in SI units (m⁻³).\n\n\n\n\n\n","category":"function"},{"location":"combined_system/#GasChem.get_conditions_dict","page":"Combined System","title":"GasChem.get_conditions_dict","text":"get_conditions_dict(sys)\n\nHelper to extract default parameter values from a conditions System as a Dict{Symbol,Float64}. This is a convenience function for use in tests and analysis code.\n\n\n\n\n\n","category":"function"},{"location":"oh_production/#oh_production","page":"OH Production","title":"OH Production","text":"","category":"section"},{"location":"oh_production/#Overview","page":"OH Production","title":"Overview","text":"The hydroxyl radical (OH) is the primary oxidant in the troposphere, initiating the oxidation of most trace gases. The dominant source of OH is photolysis of ozone at wavelengths below 320 nm, producing electronically excited O(1D) atoms which can react with water vapor to form OH.\n\nThis system implements equations 6.1-6.4 from Section 6.1 of Seinfeld & Pandis, computing the steady-state O(1D) concentration, the OH yield (number of OH radicals produced per O(1D) formed), and the OH production rate.\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Section 6.1, pp. 204-207.","category":"section"},{"location":"oh_production/#Implementation","page":"OH Production","title":"Implementation","text":"The OHProduction component is an algebraic system that computes diagnostic quantities from input concentrations of O3, H2O, and the total air number density M.","category":"section"},{"location":"oh_production/#State-Variables","page":"OH Production","title":"State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, GasChem\nusing NonlinearSolve\n\nsys = OHProduction()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"oh_production/#Parameters","page":"OH Production","title":"Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"oh_production/#Equations","page":"OH Production","title":"Equations","text":"eqs = equations(sys)","category":"section"},{"location":"oh_production/#Analysis","page":"OH Production","title":"Analysis","text":"","category":"section"},{"location":"oh_production/#OH-Yield-vs-Water-Vapor-Concentration","page":"OH Production","title":"OH Yield vs Water Vapor Concentration","text":"The OH yield (varepsilon_OH) represents the number of OH radicals produced per O(1D) atom formed. Each O(1D) + H2O reaction produces 2 OH, so varepsilon_OH ranges from 0 (all O(1D) quenched) to 2 (all O(1D) reacts with H2O).\n\nFrom Equation 6.4: varepsilon_OH = frac2 k_4 H_2Ok_3 M + k_4 H_2O\n\nThis analysis uses the actual OHProduction system to compute varepsilon_OH and P_OH across a range of humidity conditions.\n\nusing Plots\n\nsys_nns = ModelingToolkit.toggle_namespacing(sys, false)\ninput_vars = [sys_nns.O3, sys_nns.H2O, sys_nns.M]\ncompiled = mtkcompile(sys; inputs = input_vars)\n\n# Conditions: O3 = 50 ppb at surface (M = 2.5e25 m⁻³)\nM_val = 2.5e25   # m⁻³\nO3_val = 50e-9 * M_val  # 50 ppb in m⁻³\n\n# Vary H2O from dry to very humid conditions (m⁻³)\nH2O_range = range(1e22, 1.5e24, length = 200)\n\n# Solve the system for each H2O value\neps_vals = Float64[]\nP_OH_vals = Float64[]\n\nprob = NonlinearProblem(compiled,\n    Dict(compiled.O3 => O3_val, compiled.H2O => H2O_range[1], compiled.M => M_val);\n    build_initializeprob = false)\n\nfor h in H2O_range\n    newprob = remake(prob, p = [compiled.H2O => h])\n    sol = solve(newprob)\n    push!(eps_vals, sol[compiled.ε_OH])\n    push!(P_OH_vals, sol[compiled.P_OH])\nend\n\n# Convert H2O to 10^17 molec/cm³ for plotting (1 m⁻³ = 1e-6 cm⁻³)\nH2O_cgs = H2O_range .* 1e-6 ./ 1e17\n\np1 = plot(H2O_cgs, eps_vals .* 100,\n    xlabel = \"[H₂O] (10¹⁷ molec cm⁻³)\",\n    ylabel = \"OH Yield (%)\",\n    title = \"OH Yield vs Water Vapor\",\n    label = \"ε_OH (Eq. 6.4)\",\n    linewidth = 2, legend = :bottomright)\n\n# Convert P_OH to 10^6 molec/cm³/s for plotting\np2 = plot(H2O_cgs, P_OH_vals .* 1e-6 ./ 1e6,\n    xlabel = \"[H₂O] (10¹⁷ molec cm⁻³)\",\n    ylabel = \"P(OH) (10⁶ molec cm⁻³ s⁻¹)\",\n    title = \"OH Production Rate vs Humidity\",\n    label = \"P_OH (Eq. 6.3, O₃=50 ppb)\",\n    linewidth = 2, legend = :bottomright)\n\nplot(p1, p2, layout = (1, 2), size = (800, 350))\nsavefig(\"oh_yield_humidity.svg\") # hide\n\n(Image: OH yield and production rate vs humidity)\n\nThe left panel shows that OH yield increases approximately linearly with water vapor at typical tropospheric concentrations (where k_3M gg k_4H_2O), ranging from a few percent in dry air to over 20% at high humidity. The right panel shows the corresponding OH production rate, which is proportional to both the O3 concentration and the OH yield.","category":"section"},{"location":"oh_production/#Table:-OH-Yield-(ε_OH)-vs-Relative-Humidity-at-298-K","page":"OH Production","title":"Table: OH Yield (ε_OH) vs Relative Humidity at 298 K","text":"Seinfeld & Pandis (p. 207) provide the following table of varepsilon_OH as a function of relative humidity at the surface at 298 K. This table is reproduced here by solving the OHProduction system at different humidity levels.\n\nusing DataFrames\n\n# At 298 K, saturation H2O mixing ratio ≈ 0.031\nxi_H2O_sat = 0.031\nM_val = 2.5e25  # m⁻³\nO3_val = 50e-9 * M_val\n\nRH_values = [10, 25, 50, 80]\neps_computed = Float64[]\n\nfor rh in RH_values\n    H2O_val = (rh / 100) * xi_H2O_sat * M_val\n    newprob = remake(prob, p = [\n        compiled.H2O => H2O_val, compiled.O3 => O3_val, compiled.M => M_val])\n    sol = solve(newprob)\n    push!(eps_computed, sol[compiled.ε_OH])\nend\n\nDataFrame(\n    Symbol(\"RH (%)\") => RH_values,\n    Symbol(\"ε_OH (computed)\") => [round(e, sigdigits = 2) for e in eps_computed],\n    Symbol(\"ε_OH (S&P Table)\") => [0.047, 0.12, 0.23, 0.38]\n)\n\nThe computed values agree well with the book's values at low to moderate humidity. At high humidity (80% RH), the book uses the approximate formula varepsilon_OH approx 2 k_4 xi_H_2O  k_3 while our implementation uses the exact form of Eq. 6.4, leading to a small difference at high RH where the denominator term k_4H_2O becomes non-negligible.","category":"section"},{"location":"oh_production/#GasChem.OHProduction","page":"OH Production","title":"GasChem.OHProduction","text":"OHProduction(; name)\n\nModelingToolkit System for OH radical production from O₃ photolysis.\n\nImplements the steady-state O(¹D) concentration (Eq. 6.1), OH production rate (Eq. 6.3), and OH yield (Eq. 6.4) from Seinfeld & Pandis Chapter 6.\n\nThis is an algebraic system that computes diagnostic quantities from input concentrations.\n\nInput Variables (must be provided)\n\nO3: Ozone concentration [m⁻³]\nH2O: Water vapor concentration [m⁻³]\nM: Total air number density [m⁻³]\n\nOutput Variables (computed)\n\nO1D: Excited oxygen O(¹D) steady-state concentration [m⁻³]\nP_OH: OH production rate [m⁻³ s⁻¹]\nε_OH: OH yield (fraction of O(¹D) producing OH) [dimensionless]\n\nParameters\n\nj_O3: O₃ photolysis rate producing O(¹D) [s⁻¹] (default: 6×10⁻⁵ s⁻¹ at surface, solar zenith 0°)\nk3_N2: Rate constant for O(¹D) + N₂ quenching [m³ s⁻¹]\nk3_O2: Rate constant for O(¹D) + O₂ quenching [m³ s⁻¹]\nk4: Rate constant for O(¹D) + H₂O → 2OH [m³ s⁻¹]\nf_N2: Fraction of M that is N₂ [dimensionless]\nf_O2: Fraction of M that is O₂ [dimensionless]\n\nRate Constants at 298 K (from Table B.1, Seinfeld & Pandis)\n\nj_O3 ≈ 6 × 10⁻⁵ s⁻¹ (at surface, solar zenith angle 0°, Figure 4.15)\nk3_N2 = 2.6 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 2.6 × 10⁻¹⁷ m³ s⁻¹\nk3_O2 = 4.0 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 4.0 × 10⁻¹⁷ m³ s⁻¹\nk4 = 2.2 × 10⁻¹⁰ cm³ molecule⁻¹ s⁻¹ = 2.2 × 10⁻¹⁶ m³ s⁻¹\n\n\n\n\n\n","category":"function"},{"location":"api/#API-Reference","page":"API","title":"API Reference","text":"","category":"section"},{"location":"api/#GasChem.BlackbodyRadiation-Tuple{}","page":"API","title":"GasChem.BlackbodyRadiation","text":"BlackbodyRadiation(; name=:BlackbodyRadiation)\n\nImplements Planck's blackbody radiation law (Eq. 4.2) from Seinfeld & Pandis.\n\nF_B(λ) = 2πc²hλ⁻⁵ / (exp(ch/kλT) - 1)\n\nThis equation gives the monochromatic emissive power of a blackbody at temperature T for a given wavelength λ.\n\nOutputs (Variables)\n\nF_B_λ: Monochromatic emissive power (W m⁻³)\n\nInputs (Parameters)\n\nT: Temperature (K)\nλ: Wavelength (m)\n\nConstants\n\nh: Planck's constant = 6.626 × 10⁻³⁴ J·s\nc: Speed of light = 2.9979 × 10⁸ m/s\nk: Boltzmann constant = 1.381 × 10⁻²³ J/K\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.BrOxCycle-Tuple{}","page":"API","title":"GasChem.BrOxCycle","text":"BrOxCycle(; name=:BrOxCycle)\n\nCreate a ModelingToolkit System for the BrOx catalytic ozone destruction cycle.\n\nBromine is approximately 50 times more effective than chlorine in destroying ozone on an atom-for-atom basis (Page 169).\n\nKey Reactions (Section 5.5.2, Page 166):\n\nBr + O3 → BrO + O2    (k = 1.7 × 10⁻¹¹ exp(-800/T) cm³/molec/s) BrO + O → Br + O2 BrO + ClO → Br + Cl + O2  (or BrCl + O2) BrO + HO2 → HOBr + O2\n\nNote on Reservoir Species (Page 169):\n\nUnlike chlorine, bromine does not form a stable HBr reservoir because Br + CH4 is endothermic and extremely slow.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.COOxidation-Tuple{}","page":"API","title":"GasChem.COOxidation","text":"COOxidation(; name)\n\nModelingToolkit System for CO oxidation chemistry diagnostics.\n\nImplements diagnostic calculations for the CO oxidation mechanism (Eqs. 6.9-6.17) from Seinfeld & Pandis Chapter 6, including HOx cycling and steady-state relationships.\n\nInput Variables\n\nCO, OH, HO2, NO, NO2, O3: Species concentrations [m⁻³]\n\nOutput Variables\n\nP_O3: Net ozone production rate [m⁻³ s⁻¹]\nL_HOx: Total HOx loss rate [m⁻³ s⁻¹]\nchain_length: HOx chain length (cycles before termination)\nHO2_ss: HO₂ steady-state concentration (high NOx limit) [m⁻³]\n\nRate Constants at 298 K\n\nkCOOH = 2.4 × 10⁻¹³ cm³ molecule⁻¹ s⁻¹ = 2.4 × 10⁻¹⁹ m³ s⁻¹\nkHO2NO = 8.1 × 10⁻¹² cm³ molecule⁻¹ s⁻¹ = 8.1 × 10⁻¹⁸ m³ s⁻¹\nkHO2HO2 = 2.9 × 10⁻¹² cm³ molecule⁻¹ s⁻¹ = 2.9 × 10⁻¹⁸ m³ s⁻¹\nkOHNO2 = 1.0 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 1.0 × 10⁻¹⁷ m³ s⁻¹\nkHO2O3 = 2.0 × 10⁻¹⁵ cm³ molecule⁻¹ s⁻¹ = 2.0 × 10⁻²¹ m³ s⁻¹\nkOHO3 = 7.3 × 10⁻¹⁴ cm³ molecule⁻¹ s⁻¹ = 7.3 × 10⁻²⁰ m³ s⁻¹\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.ChapmanMechanism-Tuple{}","page":"API","title":"GasChem.ChapmanMechanism","text":"ChapmanMechanism(; name=:ChapmanMechanism)\n\nCreate a ModelingToolkit System for the Chapman mechanism.\n\nThe Chapman mechanism describes the basic production and destruction of ozone in the stratosphere through photolysis of O2 and subsequent reactions.\n\nReactions (Section 5.2, Seinfeld & Pandis 2006):\n\nO2 + hν → O + O                    (j_O2)\nO + O2 + M → O3 + M                (k2)\nO3 + hν → O + O2                   (j_O3)\nO + O3 → O2 + O2                   (k4)\n\nRate Equations (Equations 5.1-5.2):\n\nd[O]/dt = 2jO2[O2] - k2[O][O2][M] + jO3[O3] - k4[O][O3] d[O3]/dt = k2[O][O2][M] - j_O3[O3] - k4[O][O3]\n\nSteady-State Ozone (Equation 5.13):\n\n[O3]ss = 0.21 × (k2 × jO2 / (k4 × j_O3))^(1/2) × [M]^(3/2)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.ClOxCycle-Tuple{}","page":"API","title":"GasChem.ClOxCycle","text":"ClOxCycle(; name=:ClOxCycle)\n\nCreate a ModelingToolkit System for the ClOx catalytic ozone destruction cycle.\n\nClOx Cycle 1 (Section 5.5.1, Page 162):\n\nCl + O3 → ClO + O2    (k1 = 2.3 × 10⁻¹¹ exp(-200/T) cm³/molec/s) ClO + O → Cl + O2     (k2 = 3.0 × 10⁻¹¹ exp(70/T) cm³/molec/s) Net: O3 + O → O2 + O2\n\nRate of Odd Oxygen Destruction (Equation 5.29):\n\nd[Ox]/dt = -2 k2[ClO][O]\n\nSteady-State [Cl]/[ClO] Ratio (Equation 5.30):\n\n[Cl]/[ClO] = (kClO+O[O] + kClO+NO[NO]) / (k_Cl+O3[O3])\n\nReservoir Species (Section 5.6):\n\nHCl formed by Cl + CH4 → HCl + CH3\nClONO2 formed by ClO + NO2 + M → ClONO2 + M\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.ClimateFeedback-Tuple{}","page":"API","title":"GasChem.ClimateFeedback","text":"ClimateFeedback(; name) -> ModelingToolkitBase.System\n\n\nClimate feedback model relating radiative forcing to equilibrium temperature change with feedbacks.\n\nThis model implements the climate sensitivity equations with feedback from Seinfeld & Pandis (2006), Chapter 23 \"Climate and Chemical Composition of the Atmosphere\", Section 23.4.\n\nNote: This extends the basic no-feedback climate sensitivity from Chapter 4 (see ClimateSensitivity) by incorporating climate feedback processes.\n\nThe model includes:\n\nEq. 23.1: ΔTs = λ ΔF (climate sensitivity with feedbacks)\nEq. 23.2: ΔT₀ = λ₀ ΔF (no-feedback temperature response)\nEq. 23.3: Eᵢ = λᵢ / λ_CO₂ (efficacy of forcing agents)\nEq. 23.4: ΔFₑ = ΔFᵢ Eᵢ (effective forcing)\nEq. 23.7: ΔTunrealized = (ΔF - ΔFr) λ (unrealized warming, p. 1045)\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = ClimateFeedback()\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.ClimateSensitivity-Tuple{}","page":"API","title":"GasChem.ClimateSensitivity","text":"ClimateSensitivity(; name=:ClimateSensitivity)\n\nImplements the climate sensitivity equations (Eqs. 4.8-4.10) from Seinfeld & Pandis.\n\nΔF_net = ΔF_S - ΔF_L       (Eq. 4.8 - Net radiative energy change)\nΔT_e = λ₀ × ΔF_net         (Eq. 4.9 - Temperature response)\nλ₀ = 1/(4σT_e³) = T_e/(4F_L) (Eq. 4.10 - Climate sensitivity factor)\n\nOutputs (Variables)\n\nΔF_net: Net radiative forcing (W/m²)\nΔT_e: Change in equilibrium temperature (K)\nλ_0: Climate sensitivity factor (K m²/W)\nF_L: Reference emitted longwave flux (W/m²)\n\nInputs (Parameters)\n\nT_e: Reference equilibrium temperature (K)\nΔF_S: Change in absorbed solar flux (W/m²)\nΔF_L: Change in emitted longwave flux (W/m²)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.FastJX-Tuple{AbstractFloat}","page":"API","title":"GasChem.FastJX","text":"FastJX(\n    t_ref::AbstractFloat;\n    name\n) -> ModelingToolkitBase.System\n\n\nDescription: This is a box model used to calculate the photolysis reaction rate constant using the Fast-JX scheme (Neu, J. L., Prather, M. J., and Penner, J. E. (2007), Global atmospheric chemistry: Integrating over fractional cloud cover, J. Geophys. Res., 112, D11306, doi:10.1029/2006JD008007.)\n\nArgument:\n\nt_ref: Reference time for the model, can be a DateTime or a Unix timestamp (in seconds).\n\nExample\n\nBuild Fast-JX model:\n\nfj = FastJX(DateTime(2000, 1, 1))\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.FastJX_interpolation_troposphere-Tuple{AbstractFloat}","page":"API","title":"GasChem.FastJX_interpolation_troposphere","text":"Description: This is a box model used to calculate the photolysis reaction rate constant using the Fast-JX scheme (Neu, J. L., Prather, M. J., and Penner, J. E. (2007), Global atmospheric chemistry: Integrating over fractional cloud cover, J. Geophys. Res., 112, D11306, doi:10.1029/2006JD008007.)\n\nArgument:\n\nt_ref: Reference time for the model, can be a DateTime or a Unix timestamp (in seconds).\n\nExample\n\nBuild Fast-JX model:\n\nfj = FastJX(DateTime(2000, 1, 1))\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.GEOSChemGasPhase-Tuple{}","page":"API","title":"GasChem.GEOSChemGasPhase","text":"GEOS-Chem full-chem mechanism adapted from GEOS-Chem version 14.1.1\n\nAdapted from file https://github.com/geoschem/geos-chem/blob/4722f288e90291ba904222f4bbe4fc216d17c34a/KPP/fullchem/fullchem.eqn\nThe GEOS-Chem license applies: https://github.com/geoschem/geos-chem/blob/main/LICENSE.txt\n\nIf the keyword argument rxn_sys is set to true, the function will return a reaction system instead of an ODE system.\n\n===============================================================================\n\nREFERENCES (alphabetical order)\n\nAtkinson2003: Atkinson and Arey, Chem. Rev., doi:10.1021/cr0206420, 2003.\nBates2014:    Bates et al., J. Phys. Chem A, 118, doi:10.1021/jp4107958, 2014.\nBates2019:    Bates and Jacob, Atmos. Chem. Phys., doi:10.5194/acp-19-9613-2019, 2019.\nBates2021a:   Bates et al, JGR, https://doi.org/10.1029/2020JD033439, 2021.\nBates2021b:   Bates et al, ACP, https://doi.org/10.5194/acp-2021-605, 2021.\nBrowne2011:   Browne et al., Atmos. Chem. Phys., doi:10.5194/acp-11-4209-2011, 2011.\nBrowne2014:   Browne et al., Atmos. Chem. Phys., doi:10.5194/acp-14-1225-2014, 2014.\nChen2017:     Chen et al., Geophys. Res. Lett., doi:10.1002/2017GL073812, 2017.\nCrounse2012:  Crounse et al., J. Phys. Chem. A, doi:10.1021/jp211560u, 2012.\nEastham2014:  Eastham et al., Atmos. Env., doi:10.1016/j.atmosenv.2014.02.001, 2014.\nFischer2014:  Fischer et al., Atmos. Chem. Phys., doi:10.5194/acp-14-2679-2014, 2014.\nFisher2016:   Fisher et al., Atmos. Chem. Phys., doi:10.5194/acp-16-5969-2016, 2016.\nFisher2018:   Fisher et al., J. Geophys. Res., doi:10.1029/2018JD029046, 2018.\nFry2014:      Fry et al. Environ. Sci. Technol., doi:10.1021/es502204x, 2014.\nGill2002:     Gill and Hites, J. Phys. Chem. A, doi:10.1021/jp013532, 2002.\nGoliff2013:   Goliff et al., Atmos. Environ., doi:10.1016/j.atmosenv.2012.11.038, 2013.\nJacobs2014:   Jacobs et al., Atmos. Chem. Phys., doi:10.5194/acp-14-8933-2014, 2014.\nJenkin2015:   Jenkin et al., Atmos. Chem. Phys., doi:10.5194/acp-15-11433-2015, 2015.\nKasibhatla2018: Kasibhatla et al., Atmos. Chem. Phys., doi:10.5194/acp-18-11185-2018, 2018\nIUPAC ROO19: https://iupac-aeris.ipsl.fr/htdocs/datasheets/pdf/ROO19CH3O2NO3.pdf\nJPL 10-6:     JPL Publication 10-6, https://jpldataeval.jpl.nasa.gov/previous_evaluations.html, 2011.\nJPL 15-10:    JPL Publication 15-10, https://jpldataeval.jpl.nasa.gov, 2015.\nKwon2020:     Kwon et al, Elementa, https://doi.org/10.1525/elementa.2021.00109, 2020.\nLee2014:      Lee et al., J. Phys. Chem. A, doi:10.1021/jp4107603, 2014.\nMarais2016:   Marais et al., Atmos. Chem. Phys, doi:10.5194/acp-16-1603-2016, 2016.\nMiller2017:   Miller et al., Atmos. Chem. Phys. Discuss., doi:10.5194/acp-2016-1042, 2017.\nMillet2015:   Millet et al., Atmos. Chem. Phys., doi:10.5194/acp-15-6283-2015, 2015. Moch et al, JGR, https, * Moch2020 # //doi.org/10.1029/2020JD032706, 2020.\nMuller2014:   Muller et al., Atmos. Chem. Phys., doi:10.5194/acp-14-2497-2014, 2014.\nParrella2012: Parrella et al. Atmos. Chem. Phys, doi:10.5194/acp-12-6723-2012, 2012.\nPaulot2009:   Paulot et al., Atmos. Chem. Phys., doi:10.5194/acp-9-1479-2009, 2009a and Paulot et al., Science, doi:10.1126/science.1172910, 2009b.\nPeeters2010:  Peeters and Muller, Phys. Chem. Chem. Phys., doi:10.1039/C0CP00811G, 2010.\nPeeters2014:  Peeters et al., J. Phys. Chem. A, doi:10.1021/jp5033146, 2014.\nPye2010:      Pye et al., Atmos. Chem. Phys., doi:10.5194/acp-10-11261-2010, 2010.\nRoberts1992:  Roberts and Bertman, Int. J. Chem. Kinet., doi:10.1002/kin.550240307, 1992.\nSherwen2016b: Sherwen et al., Atmos. Chem. Phys., doi:10.5194/acp-16-12239-2016, 2016b.\nSherwen2017:  Sherwen et al., Faraday Discuss., doi:10.1039/C7FD00026J, 2017.\nStClair2016:  St. Clair et al., J. Phys. Chem. A, doi:10.1021/acs.jpca.5b065322016, 2016.\nTravis2016:   Travis et al., Atmos. Chem. Phys., doi:10.5194/acp-16-13561-2016, 2016.\nWolfe2012:    Wolfe et al., Phys. Chem. Chem. Phys., doi: 10.1039/C2CP40388A, 2012.\nXie2013:      Xie et al., Atmos. Chem. Phys., doi:10.5194/acp-13-8439-2013, 2013.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.GHGForcing-Tuple{}","page":"API","title":"GasChem.GHGForcing","text":"GHGForcing(; name) -> ModelingToolkitBase.System\n\n\nGreenhouse gas radiative forcing model.\n\nComputes the radiative forcing from well-mixed greenhouse gases using values from IPCC (2001) as presented in Seinfeld & Pandis (2006), Chapter 23, Section 23.3.\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = GHGForcing()\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.GWP_exponential-Tuple{Any, Any, Any}","page":"API","title":"GasChem.GWP_exponential","text":"GWP_exponential(τ_A, a_A, t_f; τ_CO2=150.0)\n\nCalculate the Global Warming Potential using the closed-form solution for exponential decay.\n\nThis implements the formula from Problem 23.3 (p. 1050) of Seinfeld & Pandis (2006):\n\nGWP = fraca_A tau_A (1 - e^-t_ftau_A)a_CO_2 tau_CO_2 (1 - e^-t_ftau_CO_2)\n\nArguments\n\nτ_A: Atmospheric lifetime of species A [years]\na_A: Radiative efficiency of species A relative to CO₂ (dimensionless)\nt_f: Time horizon for GWP calculation [years]\nτ_CO2: Effective CO₂ lifetime (default: 150 years)\n\nReturns\n\nGWP: Global Warming Potential relative to CO₂ (dimensionless)\n\nExample\n\n# Calculate 100-year GWP for CH₄ (τ = 12 yr, fitted relative efficiency ≈ 140)\ngwp_ch4 = GWP_exponential(12.0, 140.0, 100.0)\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, Problem 23.3.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.GlobalWarmingPotential-Tuple{}","page":"API","title":"GasChem.GlobalWarmingPotential","text":"GlobalWarmingPotential(; name) -> ModelingToolkitBase.System\n\n\nGlobal Warming Potential (GWP) calculation for exponentially decaying species.\n\nImplements Eq. 23.5 and 23.6 from Seinfeld & Pandis (2006), Chapter 23, for the special case of exponential decay of atmospheric perturbations. Also implements the closed-form GWP formula from Problem 23.3 (p. 1050).\n\nThe GWP is defined as the ratio of the time-integrated radiative forcing from a pulse emission of 1 kg of compound A to that of 1 kg of CO₂ over a specified time horizon.\n\nEquations implemented:\n\nEq. 23.5: GWP = ∫₀^{tf} aₐ[A(t)]dt / ∫₀^{tf} a_R[R(t)]dt\nEq. 23.6: AGWP_A = ∫₀^{tf} aₐ[A(t)]dt\nProblem 23.3: GWP = [aₐ τₐ (1 - e^{-tf/τₐ})] / [aCO₂ τCO₂ (1 - e^{-tf/τ_CO₂})]\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006) Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition, Chapter 23, John Wiley & Sons.\n\nExample\n\nusing GasChem, ModelingToolkit\nsys = GlobalWarmingPotential()\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.HOxCycle-Tuple{}","page":"API","title":"GasChem.HOxCycle","text":"HOxCycle(; name=:HOxCycle)\n\nCreate a ModelingToolkit System for the HOx catalytic ozone destruction cycle.\n\nHOx Cycle 1 (Page 159):\n\nOH + O3 → HO2 + O2 HO2 + O → OH + O2 Net: O3 + O → O2 + O2\n\nHOx Cycle 2 (Page 159):\n\nOH + O3 → HO2 + O2 HO2 + O3 → OH + O2 + O2 Net: O3 + O3 → O2 + O2 + O2\n\nSteady-State Ratio (Equation 5.28):\n\n[HO2]/[OH] = kOH+O3[O3] / (kHO2+NO[NO])\n\nRate of Odd Oxygen Destruction (Equation 5.27):\n\nd[Ox]/dt = -2 kHO2+O3[HO2][O3] - 2 kHO2+O[HO2][O]\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.MethaneOxidation-Tuple{}","page":"API","title":"GasChem.MethaneOxidation","text":"MethaneOxidation(; name)\n\nModelingToolkit System implementing reaction rate diagnostics for the methane oxidation mechanism from Table 6.1 of Seinfeld & Pandis Chapter 6.\n\nThis system computes individual reaction rates and diagnostic production/loss terms.\n\nSpecies (Input Variables)\n\nCH4, CH3, CH3O2, CH3O, CH3OOH: Methane chain species [m⁻³]\nHCHO, HCO, CO: Formaldehyde and products [m⁻³]\nOH, HO2, H: HOx species [m⁻³]\nNO, NO2, O, O2, O3: NOx and oxygen species [m⁻³]\nM: Total air density [m⁻³]\n\nDiagnostics (Output Variables)\n\nR1-R17: Individual reaction rates [m⁻³ s⁻¹]\nPO3gross: Gross O₃ production from peroxy+NO reactions [m⁻³ s⁻¹]\nP_HCHO: HCHO production rate [m⁻³ s⁻¹]\nL_CH4: CH₄ loss rate [m⁻³ s⁻¹]\n\nRate Constants\n\nAll rate constants from Table 6.1 at 298 K are implemented as parameters. Bimolecular rate constants converted from cm³/molec/s to m³/s (×10⁻⁶). Termolecular rate constants converted from cm⁶/molec²/s to m⁶/s (×10⁻¹²).    # Parameters - Rate constants at 298 K from Table 6.1 (converted to SI)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.MethaneOxidationODE-Tuple{}","page":"API","title":"GasChem.MethaneOxidationODE","text":"MethaneOxidationODE(; name)\n\nFull ODE system for methane oxidation with species time derivatives.\n\nThis uses Catalyst.jl's reaction network DSL to define the 17 reactions from Table 6.1 plus auxiliary reactions (CO+OH, OH+NO₂, HO₂+HO₂, NO+O₃) and an external OH source. The reaction network is converted to an ODE system.\n\nNote: This is a stiff system due to the wide range of timescales (radicals have lifetimes of seconds, while CH₄ has a lifetime of years).\n\nO₂ and M (total air density) are treated as parameters with default values for termolecular reactions (reactions 2, 6, 13, 14, 17).\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.NOxCycle-Tuple{}","page":"API","title":"GasChem.NOxCycle","text":"NOxCycle(; name=:NOxCycle)\n\nCreate a ModelingToolkit System for the NOx catalytic ozone destruction cycle.\n\nNOx Cycle 1 (Section 5.3.2, Page 154):\n\nNO + O3 → NO2 + O2     (k1 = 3.0 × 10⁻¹² exp(-1500/T) cm³/molec/s) NO2 + O → NO + O2      (k2 = 5.6 × 10⁻¹² exp(180/T) cm³/molec/s) Net: O3 + O → O2 + O2\n\nSteady-State (Equation 5.20):\n\n0 = k1[NO][O3] - j_NO2[NO2] - k2[NO2][O]\n\nRate of Odd Oxygen Destruction (Equation 5.22):\n\nd[Ox]/dt = -2 k2[NO2][O]\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.NOxPhotochemistry-Tuple{}","page":"API","title":"GasChem.NOxPhotochemistry","text":"NOxPhotochemistry(; name)\n\nModelingToolkit System for the NOx photochemical cycle.\n\nImplements the photostationary state relationships (Eqs. 6.5-6.8) from Seinfeld & Pandis Chapter 6.\n\nInput Variables\n\nNO: Nitric oxide concentration [m⁻³]\nNO2: Nitrogen dioxide concentration [m⁻³]\nO3: Ozone concentration [m⁻³]\nO2: Molecular oxygen concentration [m⁻³]\nM: Total air number density [m⁻³]\n\nOutput Variables\n\nO: Ground-state oxygen atom concentration [m⁻³]\nO3_pss: Photostationary state ozone concentration [m⁻³]\nΦ: Photostationary state parameter [dimensionless]\nP_O3: Net ozone production rate [m⁻³ s⁻¹]\n\nParameters\n\nj_NO2: NO₂ photolysis rate [s⁻¹]\nk_O_O2_M: Rate constant for O + O₂ + M → O₃ [m⁶ s⁻¹]\nk_NO_O3: Rate constant for NO + O₃ → NO₂ + O₂ [m³ s⁻¹]\n\nRate Constants at 298 K (from Table B.1)\n\nj_NO2 ≈ 8 × 10⁻³ s⁻¹ (typical midday value)\nkOO2_M = 6.0 × 10⁻³⁴ cm⁶ molecule⁻² s⁻¹ = 6.0 × 10⁻⁴⁶ m⁶ s⁻¹    # Parameters (rate constants converted to SI)\nkNOO3 = 1.9 × 10⁻¹⁴ cm³ molecule⁻¹ s⁻¹ = 1.9 × 10⁻²⁰ m³ s⁻¹ (p. 211)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.OHProduction-Tuple{}","page":"API","title":"GasChem.OHProduction","text":"OHProduction(; name)\n\nModelingToolkit System for OH radical production from O₃ photolysis.\n\nImplements the steady-state O(¹D) concentration (Eq. 6.1), OH production rate (Eq. 6.3), and OH yield (Eq. 6.4) from Seinfeld & Pandis Chapter 6.\n\nThis is an algebraic system that computes diagnostic quantities from input concentrations.\n\nInput Variables (must be provided)\n\nO3: Ozone concentration [m⁻³]\nH2O: Water vapor concentration [m⁻³]\nM: Total air number density [m⁻³]\n\nOutput Variables (computed)\n\nO1D: Excited oxygen O(¹D) steady-state concentration [m⁻³]\nP_OH: OH production rate [m⁻³ s⁻¹]\nε_OH: OH yield (fraction of O(¹D) producing OH) [dimensionless]\n\nParameters\n\nj_O3: O₃ photolysis rate producing O(¹D) [s⁻¹] (default: 6×10⁻⁵ s⁻¹ at surface, solar zenith 0°)\nk3_N2: Rate constant for O(¹D) + N₂ quenching [m³ s⁻¹]\nk3_O2: Rate constant for O(¹D) + O₂ quenching [m³ s⁻¹]\nk4: Rate constant for O(¹D) + H₂O → 2OH [m³ s⁻¹]\nf_N2: Fraction of M that is N₂ [dimensionless]\nf_O2: Fraction of M that is O₂ [dimensionless]\n\nRate Constants at 298 K (from Table B.1, Seinfeld & Pandis)\n\nj_O3 ≈ 6 × 10⁻⁵ s⁻¹ (at surface, solar zenith angle 0°, Figure 4.15)\nk3_N2 = 2.6 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 2.6 × 10⁻¹⁷ m³ s⁻¹\nk3_O2 = 4.0 × 10⁻¹¹ cm³ molecule⁻¹ s⁻¹ = 4.0 × 10⁻¹⁷ m³ s⁻¹\nk4 = 2.2 × 10⁻¹⁰ cm³ molecule⁻¹ s⁻¹ = 2.2 × 10⁻¹⁶ m³ s⁻¹\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.OzoneProductionEfficiency-Tuple{}","page":"API","title":"GasChem.OzoneProductionEfficiency","text":"OzoneProductionEfficiency(; name)\n\nModelingToolkit System for calculating Ozone Production Efficiency (OPE).\n\nOPE = Δ[O₃] / Δ[NOx] represents the number of ozone molecules produced per NOx molecule consumed. This is a key metric for understanding ozone-NOx-VOC chemistry in different regimes.\n\nFrom Equations 6.21-6.24:\n\nAt high NOx (VOC-limited): OPE is low\nAt low NOx (NOx-limited): OPE is high\nThe transition occurs near the \"ridge line\" in O₃-NOx-VOC space\n\nInput Variables\n\nOH, HO2, RO2, NO, NO2: Species concentrations [m⁻³]\n\nOutput Variables\n\nP_O3: Gross ozone production rate [m⁻³ s⁻¹]\nL_NOx: NOx loss rate [m⁻³ s⁻¹]\nOPE: Ozone production efficiency [dimensionless]\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.PhotonEnergy-Tuple{}","page":"API","title":"GasChem.PhotonEnergy","text":"PhotonEnergy(; name=:PhotonEnergy)\n\nImplements the photon energy equation (Eq. 4.1) from Seinfeld & Pandis.\n\nΔε = hν = hc/λ\n\nThe energy of a photon is related to its frequency (ν) or wavelength (λ) through Planck's constant (h) and the speed of light (c).\n\nOutputs (Variables)\n\nΔε: Photon energy (J)\nν: Frequency (Hz = s⁻¹)\n\nInputs (Parameters)\n\nλ: Wavelength (m) - input parameter\n\nConstants\n\nh: Planck's constant = 6.626 × 10⁻³⁴ J·s\nc: Speed of light = 2.9979 × 10⁸ m/s\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.PhotostationaryState-Tuple{}","page":"API","title":"GasChem.PhotostationaryState","text":"PhotostationaryState(; name)\n\nSimplified model for analyzing photostationary state deviations.\n\nThis system calculates the deviation from photostationary state (Φ - 1), which indicates the net effect of peroxy radical chemistry on the NO-NO₂-O₃ cycle.\n\nWhen Φ > 1: Additional oxidants (HO₂, RO₂) are converting NO to NO₂ When Φ < 1: Additional reductants are present When Φ = 1: Pure photostationary state (no net ozone production)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.PlanetaryEnergyBalance-Tuple{}","page":"API","title":"GasChem.PlanetaryEnergyBalance","text":"PlanetaryEnergyBalance(; name=:PlanetaryEnergyBalance)\n\nImplements the planetary energy balance equations (Eqs. 4.5-4.7) from Seinfeld & Pandis.\n\nF_S = S₀/4 × (1 - R_p)     (Eq. 4.5 - Absorbed solar flux)\nF_L = σT_e⁴                 (Eq. 4.6 - Emitted longwave flux)\nT_e = ((1 - R_p)S₀/4σ)^(1/4) (Eq. 4.7 - Equilibrium temperature)\n\nAt equilibrium: FS = FL\n\nOutputs (Variables)\n\nF_S: Absorbed solar flux (W/m²)\nF_L: Emitted longwave flux (W/m²)\nT_e: Planetary equilibrium temperature (K)\n\nInputs (Parameters)\n\nS_0: Solar constant = 1370 W/m² (can be varied)\nR_p: Planetary albedo ~ 0.3 (can be varied)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.Pollu-Tuple{}","page":"API","title":"GasChem.Pollu","text":"Pollu()\n\nThis atmospheric chemical system model is built based on this paper:\n\n\"GAUSS-SEIDEL ITERATION FOR STIFF ODES FROM CHEMICAL KINETICS\" (1994), J. G. VERWER.\n\nThe input of the function is Temperature, concentrations of all chemicals, and reaction rates of photolysis reactions\n\nIf the keyword argument rxn_sys is set to true, the function will return a reaction system instead of an ODE system.\n\nExample\n\nusing GasChem, EarthSciMLBase, DifferentialEquations, Plots\nrs = Pollu()\nsol = solve(ODEProblem(mtkcompile(rs), [], (0,360), [], combinatoric_ratelaws=false), AutoTsit5(Rosenbrock23()), saveat=10.0)\nplot(sol)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.RadiationFundamentals-Tuple{}","page":"API","title":"GasChem.RadiationFundamentals","text":"RadiationFundamentals(; name=:RadiationFundamentals)\n\nCombined system implementing all radiation fundamentals equations from Seinfeld & Pandis Chapter 4 (Eqs. 4.1-4.11).\n\nThis is a composed system that includes:\n\nPhotonEnergy: Energy-frequency-wavelength relations (Eq. 4.1)\nBlackbodyRadiation: Planck's law (Eq. 4.2)\nWienDisplacement: Peak emission wavelength (Eq. 4.3)\nStefanBoltzmann: Total emissive power (Eq. 4.4)\nPlanetaryEnergyBalance: Earth's energy balance (Eqs. 4.5-4.7)\nClimateSensitivity: Temperature response to forcing (Eqs. 4.8-4.10)\nTOARadiativeForcing: Net flux at top of atmosphere (Eq. 4.11)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.RemoteConditions-Tuple{}","page":"API","title":"GasChem.RemoteConditions","text":"RemoteConditions(; name)\n\nModelingToolkit System representing typical remote/background conditions with low NOx.\n\nAll concentrations are parameters in SI units (m⁻³).\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.StefanBoltzmann-Tuple{}","page":"API","title":"GasChem.StefanBoltzmann","text":"StefanBoltzmann(; name=:StefanBoltzmann)\n\nImplements the Stefan-Boltzmann law (Eq. 4.4) from Seinfeld & Pandis.\n\nF_B = σT⁴\n\nThe total emissive power of a blackbody integrated over all wavelengths.\n\nOutputs (Variables)\n\nF_B: Total blackbody emissive power (W/m²)\n\nInputs (Parameters)\n\nT: Temperature (K)\n\nConstants\n\nσ: Stefan-Boltzmann constant = 5.671 × 10⁻⁸ W m⁻² K⁻⁴\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.StratosphericOzoneSystem-Tuple{}","page":"API","title":"GasChem.StratosphericOzoneSystem","text":"StratosphericOzoneSystem(; name=:StratosphericOzoneSystem)\n\nCreate a comprehensive ModelingToolkit System combining all stratospheric ozone chemistry cycles.\n\nThis system includes:\n\nChapman mechanism (O, O3 production and loss)\nO(¹D) photochemistry including O(¹D) + H2O and O(¹D) + CH4\nN2O + O(¹D) → 2NO as the NOx source (Section 5.3.1)\nNOx cycle (catalytic O3 destruction)\nHOx cycle (catalytic O3 destruction)\nClOx cycle (catalytic O3 destruction)\nBrOx cycle (catalytic O3 destruction)\n\nAll rate coefficients are temperature-dependent, computed from Arrhenius parameters defined as @constants.\n\nKey Equations from Seinfeld & Pandis Chapter 5:\n\nOdd Oxygen Balance (Equation 5.9):\n\nd[Ox]/dt = 2j_O2[O2] - 2k4[O][O3]\n\nSteady-State O3 (Equation 5.13):\n\n[O3]ss = 0.21 × (k2 × jO2 / (k4 × j_O3))^(1/2) × [M]^(3/2)\n\n[O]/[O3] Ratio (Equation 5.7):\n\n[O]/[O3] = j_O3 / (k2[O2][M])\n\nTime to Steady State (Equation 5.17):\n\nτO3^ss = (1/4) × (k2[M] / (k4 × jO2 × j_O3))^(1/2)\n\nNO Yield from N2O (Equation 5.18, Section 5.3.1):\n\nN2O + O(¹D) → NO + NO (k = 6.7 × 10⁻¹¹ cm³/molec/s) N2O + O(¹D) → N2 + O2 (k = 4.9 × 10⁻¹¹ cm³/molec/s)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.SuperFast-Tuple{}","page":"API","title":"GasChem.SuperFast","text":"SuperFast()\n\nThis atmospheric chemical system model is built based on the Super Fast Chemical Mechanism, which is one of the simplest representations of atmospheric chemistry. It can efficiently simulate background tropheric ozone chemistry and perform well for those species included in the mechanism. The chemical equations we used is included in the supporting table S2 of the paper:\n\n\"Evaluating simplified chemical mechanisms within present-day simulations of the Community Earth System Model version 1.2 with CAM4 (CESM1.2 CAM-chem): MOZART-4 vs. Reduced Hydrocarbon vs. Super-Fast chemistry\" (2018), Benjamin Brown-Steiner, Noelle E. Selin, Ronald G. Prinn, Simone Tilmes, Louisa Emmons, Jean-François Lamarque, and Philip Cameron-Smith.\n\nThe input of the function is Temperature, concentrations of all chemicals, and reaction rates of photolysis reactions\n\nIf the keyword argument rxn_sys is set to true, the function will return a reaction system instead of an ODE system.\n\nExample\n\nusing GasChem, EarthSciMLBase, DifferentialEquations, Plots\nrs = SuperFast()\nsol = solve(ODEProblem(mtkcompile(rs), [], (0,360), [], combinatoric_ratelaws=false), AutoTsit5(Rosenbrock23()), saveat=10.0)\nplot(sol)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.TOARadiativeForcing-Tuple{}","page":"API","title":"GasChem.TOARadiativeForcing","text":"TOARadiativeForcing(; name=:TOARadiativeForcing)\n\nImplements the top of atmosphere radiative forcing based on Eq. 4.11 from Seinfeld & Pandis.\n\nF_net = S₀/4 × (1 - R_p) - F_L\n\nNote: Seinfeld & Pandis define Eq. 4.11 as -Fnet = S₀/4(1-Rp) - FL, using the convention that -Fnet represents net downward flux. Here we define Fnet as net incoming flux directly, so positive Fnet indicates the planet is gaining energy (warming).\n\nOutputs (Variables)\n\nF_net: Net radiative flux at TOA (W/m²) - positive = energy gain\nF_S: Absorbed solar flux (W/m²)\n\nInputs (Parameters)\n\nS_0: Solar constant = 1370 W/m² (can be varied)\nR_p: Planetary albedo ~ 0.3 (can be varied)\nF_L: Emitted longwave flux (W/m²) - input parameter\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.TroposphericChemistrySystem-Tuple{}","page":"API","title":"GasChem.TroposphericChemistrySystem","text":"TroposphericChemistrySystem(; name)\n\nCombined ModelingToolkit System for tropospheric chemistry diagnostics.\n\nThis system couples the OH production, NOx cycling, and CO/CH₄ oxidation mechanisms to create a comprehensive diagnostic model of tropospheric photochemistry.\n\nKey coupling points:\n\nOH is produced from O₃ photolysis and HO₂ + NO reaction\nOH is consumed by CO, CH₄, and other species\nHO₂ is produced from CO/VOC oxidation\nHO₂ is lost to NO (producing OH) and self-reaction\nNOx cycles between NO and NO₂ through O₃ and peroxy radicals\nO₃ is produced when peroxy radicals oxidize NO to NO₂\n\nSubsystem Composition:\n\noh: OHProduction subsystem (Section 6.1)\nnox: NOxPhotochemistry subsystem (Section 6.2)\nco: COOxidation subsystem (Section 6.3)\n\nInput Variables\n\nAll species concentrations must be provided as inputs [m⁻³].\n\nDiagnostic outputs:\n\nPO3net: Net ozone production rate [m⁻³ s⁻¹]\nOPE: Ozone production efficiency [dimensionless]\nHOx: Total HOx (OH + HO₂) [m⁻³]    # =========================================================================\nchain_length: HOx chain length [dimensionless]    # Subsystems (composed from individual component functions)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.TypicalConditions-Tuple{}","page":"API","title":"GasChem.TypicalConditions","text":"TypicalConditions(; name)\n\nModelingToolkit System representing typical lower troposphere conditions.\n\nAll concentrations are parameters in SI units (m⁻³).\n\nBased on values from Seinfeld & Pandis Chapter 6.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.UrbanConditions-Tuple{}","page":"API","title":"GasChem.UrbanConditions","text":"UrbanConditions(; name)\n\nModelingToolkit System representing typical urban conditions with elevated NOx.\n\nAll concentrations are parameters in SI units (m⁻³).\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.WienDisplacement-Tuple{}","page":"API","title":"GasChem.WienDisplacement","text":"WienDisplacement(; name=:WienDisplacement)\n\nImplements Wien's displacement law (Eq. 4.3) from Seinfeld & Pandis.\n\nλ_max = 2.897 × 10⁻³ / T  (SI: λ_max in m, T in K)\n\nNote: S&P express this as λmax = 2.897 × 10⁶ / T when λmax is in nm.\n\nThis gives the wavelength at which the blackbody emission spectrum peaks.\n\nOutputs (Variables)\n\nλ_max: Peak wavelength (m)\n\nInputs (Parameters)\n\nT: Temperature (K)\n\nConstants\n\nb: Wien's displacement constant = 2.897 × 10⁻³ m·K\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.adjust_j_o31D-Tuple{Any, Any, Any}","page":"API","title":"GasChem.adjust_j_o31D","text":"adjust_j_O31D(T, P, H2O)\n\nAdjust the photolysis rate of O3 -> O2 + O(1D) to represent the effective rate for O3 -> 2OH. This adjustment is based on the fraction of O(1D) that reacts with H2O to produce 2 OH.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arr_3rd-NTuple{10, Any}","page":"API","title":"GasChem.arr_3rd","text":"Third body effect for pressure dependence of rate coefficients. a1, b1, c1 are the Arrhenius parameters for the lower-limit rate. a2, b2, c2 are the Arrhenius parameters for the upper-limit rate. fv         is the falloff curve parameter, (see ATKINSON ET. AL (1992) J. Phys. Chem. Ref. Data 21, P. 1145). Usually fv = 0.6.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arr_3rdbody-NTuple{10, Any}","page":"API","title":"GasChem.arr_3rdbody","text":"Third body effect for pressure dependence of rate coefficients. a1, b1, c1 are the Arrhenius parameters for the lower-limit rate. a2, b2, c2 are the Arrhenius parameters for the upper-limit rate. fv         is the falloff curve parameter, (see ATKINSON ET. AL (1992) J. Phys. Chem. Ref. Data 21, P. 1145). Usually fv = 0.6.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arr_3rdbody_1-NTuple{10, Any}","page":"API","title":"GasChem.arr_3rdbody_1","text":"Third body effect for pressure dependence of first-order rate coefficients. a1, b1, c1 are the Arrhenius parameters for the lower-limit rate. a2, b2, c2 are the Arrhenius parameters for the upper-limit rate. fv         is the falloff curve parameter, (see ATKINSON ET. AL (1992) J. Phys. Chem. Ref. Data 21, P. 1145). Usually fv = 0.6.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrh-NTuple{6, Any}","page":"API","title":"GasChem.arrh","text":"Arrhenius equation:\n\n    k = a0 * exp( c0  T ) * (T300)^b0\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrhenius_mlc_1-NTuple{5, Any}","page":"API","title":"GasChem.arrhenius_mlc_1","text":"Compute a first-order reaction rate constant using a modified Arrhenius equation, with output units in s⁻¹.\n\nThe formula used is:\n\nk(t) = a₀ * exp(c₀  T) * (300  T)^b₀\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrhenius_mlc_SI-NTuple{5, Any}","page":"API","title":"GasChem.arrhenius_mlc_SI","text":"Compute a second-order reaction rate constant using a modified Arrhenius equation, with output in SI units m³·molec⁻¹·s⁻¹.\n\nThe formula used is:\n\nk(t) = a₀ * exp(c₀  T) * (300  T)^b₀\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrhenius_ppb-NTuple{6, Any}","page":"API","title":"GasChem.arrhenius_ppb","text":"Arrhenius equation:\n\n    k = a0 * exp( c0  T ) * (T300)^b0\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrhenius_ppb_3-NTuple{6, Any}","page":"API","title":"GasChem.arrhenius_ppb_3","text":"Compute a third-order reaction rate constant using a modified Arrhenius equation, with output units in ppb⁻²·s⁻¹.\n\nThis function is appropriate when reactant concentrations are expressed in ppb (mol/mol_air × 10⁹).\n\nThe formula used is:\n\nk(t) = a₀ * exp(c₀  T) * (300  T)^b₀\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrplus_mlc_1-NTuple{7, Any}","page":"API","title":"GasChem.arrplus_mlc_1","text":"Modified Arrhenius law with output in units s⁻¹.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.arrplus_ppb-NTuple{8, Any}","page":"API","title":"GasChem.arrplus_ppb","text":"Modified Arrhenius law with output in units ppb·s⁻¹.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.constant_k-NTuple{4, Any}","page":"API","title":"GasChem.constant_k","text":"Function to create a constant rate coefficient for second-order reactions\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.constant_k_1-Tuple{Any, Any}","page":"API","title":"GasChem.constant_k_1","text":"Function to create a constant rate coefficient for first-order reactions\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.cos_solar_zenith_angle-Tuple{Any, Any, Any}","page":"API","title":"GasChem.cos_solar_zenith_angle","text":"cos_solar_zenith_angle(lat, t, long)\n\nThis function is to compute the cosine of the solar zenith angle, given the unixtime, latitude and longitude The input variables: lat=latitude(°), long=longitude(°), t=unixtime(s) the cosine of the solar zenith angle (SZA) is given by:                                                                            . cos(SZA) = sin(LAT)sin(DEC) + cos(LAT)cos(DEC)*cos(AHR)\n\n       where LAT = the latitude angle,\n             DEC = the solar declination angle,\n             AHR = the hour angle, all in radians.  All in radians\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.create_fjx_interp-Tuple{Vector{Float32}, Vector{StaticArraysCore.SVector{18, Float32}}}","page":"API","title":"GasChem.create_fjx_interp","text":"Create a vector of interpolators to interpolate the cross sections σ (TODO: What are the units?) for different wavelengths (in nm) and temperatures (in K).\n\nWe use use linear interpolation with flat extrapolation.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.eq_const-NTuple{10, Any}","page":"API","title":"GasChem.eq_const","text":"Calculates the equilibrium constant  for second-order reactions Find the backwards reaction by K=kforward/kbackwards Calculates the rate constant of the forward reaction\n\nUsed to compute the rate for these reactions: PPN        = RCO3 + NO2 PAN        = MCO3 + NO2\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.eq_const_1-NTuple{10, Any}","page":"API","title":"GasChem.eq_const_1","text":"Calculates the equilibrium constant for first-order reactions Find the backwards reaction by K=kforward/kbackwards Calculates the rate constant of the forward reaction\n\nUsed to compute the rate for these reactions: ClOO  {+M} = Cl   + O2 {+M} Cl2O2 {+M} = 2ClO      {+M}\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.get_conditions_dict-Tuple{Any}","page":"API","title":"GasChem.get_conditions_dict","text":"get_conditions_dict(sys)\n\nHelper to extract default parameter values from a conditions System as a Dict{Symbol,Float64}. This is a convenience function for use in tests and analysis code.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.j_mean-NTuple{4, Any}","page":"API","title":"GasChem.j_mean","text":"Get mean photolysis rates at different times\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_2HO2-NTuple{8, Any}","page":"API","title":"GasChem.rate_2HO2","text":"Used to compute the rate for this reactions: HO2 + HO2 = H2O2 + O2\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_ALK-NTuple{9, Any}","page":"API","title":"GasChem.rate_ALK","text":"Used to compute the rate for these reactions: IHOO1    + NO =      NO2 + ... IHOO4    + NO =      NO2 + ... IHP001   + NO =      NO2 + ... IHP002   + NO =      NO2 + ... IHP003   + NO =      NO2 + ... IEPOXAOO + NO =      NO2 + ... IEPOXBOO + NO =      NO2 + ... ICHOO    + NO =      NO2 + ... ISOPNOO1 + NO = 1.728NO2 + ... ISOPNOO2 + NO =      NO2 + ... IDHNDOO1 + NO =      NO2 + ... IDHNDOO2 + NO =      NO2 + ... IDHNBOO  + NO =      NO2 + ... IDHNDOO  + NO =      NO2 + ... INO2B    + NO = 2.000NO2 + ... INO2D    + NO =      NO2 + ... IHPNBOO  + NO = 1.065NO2 + ... IHPNDOO  + NO =      NO2 + ... MVKOHOO  + NO =      NO2 + ... MCROHOO  + NO =      NO2 + ...\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_DMSOH-NTuple{7, Any}","page":"API","title":"GasChem.rate_DMSOH","text":"Reaction rate for: DMS + OH = 0.750SO2 + 0.250MSA + MO2\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_EPO-NTuple{6, Any}","page":"API","title":"GasChem.rate_EPO","text":"Used to compute the rate for these reactions: RIPA   + OH = 0.67IEPOXA   + 0.33IEPOXB   + OH + 0.005LVOC RIPB   + OH = 0.68IEPOXA   + 0.321IEPOB   + OH + 0.005LVOC IEPOXA + OH = 0.67IEPOXA00 + 0.33IEPOXB00 IEPOXB + OH = 0.81IEPOXA00 + 0.19IEPOXB00 IHN2   + OH = 0.67IEPOXA   + 0.33IEPOXB   + NO2 IHN3   + OH = 0.67IEPOXA   + 0.33IEPOXB   + NO2 IHN1   + OH = IEPOXD       + NO2 IHN4   + OH = IEPOXD       + NO2 INPB   + OH = OH           + ITHN INPD   + OH = OH           + ITHN INPD   + OH = NO2          + ICHE ICN    + OH = NO2          + ICHE\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_GLYCOH_a-NTuple{4, Any}","page":"API","title":"GasChem.rate_GLYCOH_a","text":"Used to compute the rate for this reaction: GLYC + OH = 0.732CH2O + 0.361CO2  + 0.505CO    + 0.227OH\n\n0.773HO2  + 0.134GLYX + 0.134HCOOH which is the \"A\" branch of GLYC + OH.\n\nFor this reaction, these Arrhenius law terms evaluate to 1: (300/T)^b0 * exp(c0/T) Because b0 = c0 = 0.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_GLYCOH_b-NTuple{4, Any}","page":"API","title":"GasChem.rate_GLYCOH_b","text":"Used to compute the rate for this reaction: GLYC + OH = HCOOH + OH + CO which is the \"B\" branch of GLYC + OH.\n\nFor this reaction, these Arrhenius law terms evaluate to 1: (300/T)^b0 * exp(c0/T) Because b0 = c0 = 0.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_GLYXNO3-NTuple{5, Any}","page":"API","title":"GasChem.rate_GLYXNO3","text":"Reaction rate for: GLYX + NO3 = HNO3 + HO2 + 2CO i.e. the HO2 + 2*CO branch\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_HACOH_a-NTuple{5, Any}","page":"API","title":"GasChem.rate_HACOH_a","text":"Used to compute the rate for this reaction: HAC + OH = MGLY + HO2 which is the \"A\" branch of HAC + OH.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_HACOH_b-NTuple{5, Any}","page":"API","title":"GasChem.rate_HACOH_b","text":"Used to compute the rate for this reaction: HAC + OH = 0.5HCOOH + OH + 0.5ACTA + 0.5CO2 + 0.5CO + 0.5MO2 which is the \"B\" branch of HAC + OH.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_HO2HO2-NTuple{8, Any}","page":"API","title":"GasChem.rate_HO2HO2","text":"Used to compute the rate for this reactions: HO2 + HO2 = H2O2 + O2\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_ISO1-NTuple{10, Any}","page":"API","title":"GasChem.rate_ISO1","text":"Used to compute the rate for these reactions: ISOP + OH = LISOPOH + IHOO1 ISOP + OH = LISOPOH + IHOO4\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_ISO2-NTuple{10, Any}","page":"API","title":"GasChem.rate_ISO2","text":"Used to compute the rate for these reactions: ISOP + OH = 0.3MCO3 + 0.3MGLY + 0.3CH2O\n\n0.15HPALD3 + 0.25HPALD1 + 0.4HO2\n0.6CO + 1.5OH + 0.3HPETHNL + LISOPOH ISOP + OH = 0.3CH2O + 0.15HPALD4 + 0.25HPALD2\n1.5OH + 0.9CO + 0.7HO2 + 0.3MGLY\n0.3ATOOH + LISOPOH\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_NIT-NTuple{9, Any}","page":"API","title":"GasChem.rate_NIT","text":"Used to compute the rate for these reactions: IHOO1    + NO = IHN2 IHOO4    + NO = IHN4 IHPOO1   + NO = IHTN IHPOO2   + NO = IHTN IHPOO2   + NO = IHTN IEPOXAOO + NO = IHTN IEPOXBOO + NO = IHTN IHCOO    + NO = IHTN ISOPNOO1 + NO = IDN ISOPNOO2 + NO = IDN IDHNDOO1 + NO = IDN IDHNDOO2 + NO = IDN INO2B    + NO = IDN INO2D    + NO = IDN IHPNBOO  + NO = IDN IHPNDOO  + NO = IDN MVK0HOO  + NO = 0.438MVKN MCROHOO  + NO = MCRHN\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_OHCO-Tuple{Any, Any, Any}","page":"API","title":"GasChem.rate_OHCO","text":"Reaction rate for: OH + CO = HO2 + CO2 (cf. JPL 15-10)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_OHHNO3-NTuple{9, Any}","page":"API","title":"GasChem.rate_OHHNO3","text":"Used to compute the rate for these reactions: HNO3  + OH = H2O + NO3 HONIT + OH = NO3 + HAC\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_OH_CO-Tuple{Any, Any, Any}","page":"API","title":"GasChem.rate_OH_CO","text":"Reaction rate for: OH + CO = HO2 + CO2 (cf. JPL 15-10)\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_PAN_abab-NTuple{8, Any}","page":"API","title":"GasChem.rate_PAN_abab","text":"Used to compute the rate for reaction: BZPAN –> BZCO3 + NO2\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_PAN_acac-NTuple{8, Any}","page":"API","title":"GasChem.rate_PAN_acac","text":"Used to compute the rate for reaction: MACR1OO + NO2 –> MPAN MACRNO2 + NO2 –> MPAN + NO2 BZCO3 + NO2 –> BZPAN\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_RO2HO2-NTuple{6, Any}","page":"API","title":"GasChem.rate_RO2HO2","text":"Carbon Dependence of RO2+HO2, used in these reactions: A3O2 + HO2 = RA3P PO2  + HO2 = PP KO2  + HO2 = 0.150OH + 0.150ALD2 + 0.150MCO3 + 0.850ATOOH B3O2 + HO2 = RB3P PRN1 + HO2 = PRPN\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_RO2NO_a1-NTuple{5, Any}","page":"API","title":"GasChem.rate_RO2NO_a1","text":"Reaction rate for the \"A\" branch of these RO2 + NO reactions: MO2  + NO = MENO3 in which the \"a1\" parameter equals exactly 1.\n\nFor these reactions, these Arrhenius law terms evaluate to 1: (300/T)^b0 (300/T)^b1 * exp(c1/T) because b0 = b1 = c1 = 0.\n\nSpecial treatment for methyl nitrate based on observations as Carter and Atkinson formulation does not apply to C1. Value based on upper limit of Flocke et al. 1998 as applied in Fisher et al. 2018\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_RO2NO_a2-NTuple{6, Any}","page":"API","title":"GasChem.rate_RO2NO_a2","text":"Reaction rate for the \"A\" branch of these RO2 + NO reactions, ETO2 + NO = ETNO3 A3O2 + NO = NPRNO3 R4O2 + NO = R4N2 B3O2 + NO = IPRNO3 in which the \"a1\" parameter is greater than 1.0.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_RO2NO_b1-NTuple{5, Any}","page":"API","title":"GasChem.rate_RO2NO_b1","text":"Reaction rate for the \"B\" branch of these RO2 + NO reactions: MO2 + NO = CH2O + NO2 + HO2 in which the \"a1\" parameter equals exactly 1.\n\nFor these reactions, these Arrhenius law terms evaluate to 1: (300/T)^b0 (300/T)^b1 * exp(c1/T) because b0 = c0 = c1 = 0.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_RO2NO_b2-NTuple{6, Any}","page":"API","title":"GasChem.rate_RO2NO_b2","text":"Reaction rate for the \"B\" branch of these RO2 + NO reactions: ETO2 + NO = NO2 +     HO2 + ... A3O2 + NO = NO2 +     HO2 + ... R4O2 + NO = NO2 + 0.27HO2 + ... B3O2 + NO = NO2 +     HO2 + ... in which the \"a1\" parameter is greater than 1.0.\n\nUse this function when a1 input argument is greater than 1.0.\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.rate_toppb-NTuple{4, Any}","page":"API","title":"GasChem.rate_toppb","text":"Convert reaction rate value in unit of cm^3/molec/s to (s*ppb)^-1\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.tbranch-NTuple{9, Any}","page":"API","title":"GasChem.tbranch","text":"Temperature Dependent Branching Ratio\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.tunplus_mlc_1-NTuple{7, Any}","page":"API","title":"GasChem.tunplus_mlc_1","text":"Computes a temperature-dependent reaction rate constant using a modified Arrhenius expression with additional tunneling effect terms. Used to compute the rate for these reactions with output in units s⁻¹: IHOO1 = 1.5OH + ... IHOO4 = 1.5OH + ...\n\n\n\n\n\n","category":"method"},{"location":"api/#GasChem.tunplus_ppb-NTuple{8, Any}","page":"API","title":"GasChem.tunplus_ppb","text":"Computes a temperature-dependent reaction rate constant using a modified Arrhenius expression with additional tunneling effect terms. Used to compute the rate for these reactions with output in units ppb·s⁻¹: IHOO1 = 1.5OH + ... IHOO4 = 1.5OH + ...\n\n\n\n\n\n","category":"method"},{"location":"superfast/#SuperFast-Gas-Phase-Atmospheric-Chemical-Mechanism","page":"SuperFast","title":"SuperFast Gas-Phase Atmospheric Chemical Mechanism","text":"The Super Fast Chemical Mechanism is one of the simplest representations of atmospheric chemistry. It can efficiently simulate background tropospheric ozone chemistry and perform well for those species included in the mechanism. The chemical equations used are included in the supporting table S2 of the paper, \"Evaluating simplified chemical mechanisms within present-day simulations of the Community Earth System Model version 1.2 with CAM4 (CESM1.2 CAM-chem): MOZART-4 vs. Reduced Hydrocarbon vs. Super-Fast chemistry\" (2018), Benjamin Brown-Steiner, Noelle E. Selin, Ronald G. Prinn, Simone Tilmes, Louisa Emmons, Jean-François Lamarque, and Philip Cameron-Smith.","category":"section"},{"location":"superfast/#Illustrative-Example","page":"SuperFast","title":"Illustrative Example","text":"Here is a simple example of initializing the SuperFast model and running a simulation. First, we can look at the reaction equations:\n\nusing GasChem, EarthSciMLBase, ModelingToolkit\nusing DynamicQuantities, OrdinaryDiffEqDefault, OrdinaryDiffEqRosenbrock\nusing Catalyst\nusing Plots\nusing ModelingToolkit: t\n\nmodel = SuperFast()","category":"section"},{"location":"superfast/#Variables-and-parameters","page":"SuperFast","title":"Variables and parameters","text":"The chemical species included in the superfast model are:\n\nvars = unknowns(model)[1:12]\nusing DataFrames\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [ModelingToolkit.get_unit(v) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars],\n    :Default => [ModelingToolkit.getdefault(v) for v in vars])\n\nAnd here are the parameters:\n\nvars = parameters(model)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [ModelingToolkit.get_unit(v) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars],\n    :Default => [ModelingToolkit.getdefault(v) for v in vars])","category":"section"},{"location":"superfast/#Running-simulations","page":"SuperFast","title":"Running simulations","text":"We can run simulations with the model, optionally changing the initial conditions and parameters. For example, we can change the initial concentration of O₃ to 15 ppb and the temperature to 293K:\n\nsys = mtkcompile(model)\n\ntspan = (0.0, 3600*24)\n# Change the initial concentration of O₃ to 15 ppb and the temperature to 293K.\nprob = ODEProblem(sys, [sys.O3 => 15], tspan, [sys.T => 293])\n\nNow we can solve the system and plot the result:\n\nsol = solve(prob, Rosenbrock23(), saveat = 10.0)\n\nplot(sol, ylim = (0, 50), xlabel = \"Time\",\n    ylabel = \"Concentration (ppb)\", legend = :outerright)\n\nFinally let's run some simulations with different values for parameter T.\n\nsol1 = solve(ODEProblem(sys, [], tspan, [sys.T => 273]),\n    Rosenbrock23(), saveat = 10.0)\nsol2 = solve(ODEProblem(sys, [], tspan, [sys.T => 298]),\n    Rosenbrock23(), saveat = 10.0)\n\nplot([sol1[sys.O3], sol2[sys.O3]], label = [\"T=273K\" \"T=298K\"],\n    title = \"Change of O3 concentration at different temperatures\",\n    xlabel = \"Time (second)\", ylabel = \"concentration (ppb)\")","category":"section"},{"location":"methane_oxidation/#methane_oxidation","page":"Methane Oxidation","title":"Methane Oxidation","text":"","category":"section"},{"location":"methane_oxidation/#Overview","page":"Methane Oxidation","title":"Overview","text":"Methane (CH4) is the most abundant hydrocarbon in the atmosphere (~1.8 ppm). Its oxidation is the archetypal VOC oxidation mechanism, proceeding through several intermediates:\n\nCH4 -> CH3O2 -> CH3O -> HCHO -> HCO -> CO -> CO2\n\nEach step can produce ozone when NOx is present through peroxy + NO reactions. At high NOx, complete CH4 oxidation can produce 3-5 O3 molecules.\n\nTwo components are provided:\n\nMethaneOxidation: Algebraic system computing individual reaction rates and diagnostics from Table 6.1\nMethaneOxidationODE: Full ODE system for time evolution of all species\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Section 6.4, Table 6.1, pp. 219-227.","category":"section"},{"location":"methane_oxidation/#Implementation","page":"Methane Oxidation","title":"Implementation","text":"","category":"section"},{"location":"methane_oxidation/#MethaneOxidation:-State-Variables","page":"Methane Oxidation","title":"MethaneOxidation: State Variables","text":"using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities, GasChem\n\nsys = MethaneOxidation()\nvars = unknowns(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars]\n)","category":"section"},{"location":"methane_oxidation/#MethaneOxidation:-Parameters","page":"Methane Oxidation","title":"MethaneOxidation: Parameters","text":"params = parameters(sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(p, escape = false)) for p in params],\n    :Units => [dimension(ModelingToolkit.get_unit(p)) for p in params],\n    :Description => [ModelingToolkit.getdescription(p) for p in params]\n)","category":"section"},{"location":"methane_oxidation/#MethaneOxidation:-Equations","page":"Methane Oxidation","title":"MethaneOxidation: Equations","text":"eqs = equations(sys)","category":"section"},{"location":"methane_oxidation/#MethaneOxidationODE:-State-Variables","page":"Methane Oxidation","title":"MethaneOxidationODE: State Variables","text":"ode_sys = MethaneOxidationODE()\nvars_ode = unknowns(ode_sys)\nDataFrame(\n    :Name => [string(Symbolics.tosymbol(v, escape = false)) for v in vars_ode],\n    :Units => [dimension(ModelingToolkit.get_unit(v)) for v in vars_ode],\n    :Description => [ModelingToolkit.getdescription(v) for v in vars_ode]\n)","category":"section"},{"location":"methane_oxidation/#Table-6.1:-Rate-Constants","page":"Methane Oxidation","title":"Table 6.1: Rate Constants","text":"Table 6.1 of Seinfeld & Pandis lists the 17 reactions of the methane oxidation mechanism with their rate constants at 298 K. The table below reproduces these values from the implementation parameters (converted from SI back to cm³ molecule⁻¹ s⁻¹ for comparison with the textbook):\n\nusing DataFrames\n\n# Reproduce Table 6.1 from the model parameters\nreactions = [\n    \"1. CH₄ + OH → CH₃ + H₂O\",\n    \"2. CH₃ + O₂ + M → CH₃O₂ + M\",\n    \"3. CH₃O₂ + NO → CH₃O + NO₂\",\n    \"4. CH₃O₂ + HO₂ → CH₃OOH + O₂\",\n    \"5. CH₃O₂ + CH₃O₂ → products\",\n    \"6. CH₃O + O₂ → HCHO + HO₂\",\n    \"7. CH₃OOH + OH → CH₃O₂ + H₂O\",\n    \"8. CH₃OOH + OH → HCHO + OH + H₂O\",\n    \"9. CH₃OOH + hν → CH₃O + OH\",\n    \"10. HCHO + OH → HCO + H₂O\",\n    \"11. HCHO + hν → HCO + H\",\n    \"12. HCHO + hν → H₂ + CO\",\n    \"13. HCO + O₂ → CO + HO₂\",\n    \"14. H + O₂ + M → HO₂ + M\",\n    \"15. HO₂ + NO → OH + NO₂\",\n    \"16. NO₂ + hν → NO + O\",\n    \"17. O + O₂ + M → O₃ + M\"\n]\n\n# Rate constants from Table 6.1 at 298 K\nk_values = [\n    \"6.3 × 10⁻¹⁵\",\n    \"1.0 × 10⁻³⁰ [M]\",\n    \"7.7 × 10⁻¹²\",\n    \"5.2 × 10⁻¹²\",\n    \"3.5 × 10⁻¹³\",\n    \"1.9 × 10⁻¹⁵\",\n    \"3.8 × 10⁻¹²\",\n    \"1.9 × 10⁻¹²\",\n    \"j ≈ 5 × 10⁻⁶ s⁻¹\",\n    \"9.0 × 10⁻¹²\",\n    \"j ≈ 3 × 10⁻⁵ s⁻¹\",\n    \"j ≈ 4 × 10⁻⁵ s⁻¹\",\n    \"5.2 × 10⁻¹²\",\n    \"5.7 × 10⁻³² [M]\",\n    \"8.1 × 10⁻¹²\",\n    \"j ≈ 8 × 10⁻³ s⁻¹\",\n    \"6.0 × 10⁻³⁴ [M]\"\n]\n\nunits = [\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm⁶ molec⁻² s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"s⁻¹\",\n    \"s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"cm⁶ molec⁻² s⁻¹\",\n    \"cm³ molec⁻¹ s⁻¹\",\n    \"s⁻¹\",\n    \"cm⁶ molec⁻² s⁻¹\"\n]\n\nDataFrame(:Reaction => reactions, :k_298K => k_values, :Units => units)","category":"section"},{"location":"methane_oxidation/#Analysis","page":"Methane Oxidation","title":"Analysis","text":"","category":"section"},{"location":"methane_oxidation/#Methane-Oxidation-Chain:-O3-Yield-at-High-vs-Low-NOx","page":"Methane Oxidation","title":"Methane Oxidation Chain: O3 Yield at High vs Low NOx","text":"The fate of the methylperoxy radical (CH3O2) depends on the NOx level. At high NOx, CH3O2 reacts with NO to produce NO2 (and subsequently O3), while at low NOx, CH3O2 reacts with HO2 to form CH3OOH, which terminates the radical chain. This determines the overall O3 yield per CH4 molecule oxidized.\n\nThis analysis uses the MethaneOxidation system to compute the competing reaction rates R3 (CH3O2 + NO) and R4 (CH3O2 + HO2) across a range of NO concentrations.\n\nusing Plots, NonlinearSolve\n\nsys_nns = ModelingToolkit.toggle_namespacing(sys, false)\ninput_vars = [sys_nns.CH4, sys_nns.CH3, sys_nns.CH3O2, sys_nns.CH3O, sys_nns.CH3OOH,\n    sys_nns.HCHO, sys_nns.HCO, sys_nns.OH, sys_nns.HO2, sys_nns.H,\n    sys_nns.NO, sys_nns.NO2, sys_nns.O, sys_nns.O2, sys_nns.M]\ncompiled = mtkcompile(sys; inputs = input_vars)\n\n# Fixed conditions (SI: m⁻³)\nM_val = 2.5e25\nO2_val = 5.25e24\nHO2_val = 1e14     # m⁻³ (= 1e8 cm⁻³)\nCH3O2_val = 1e14   # m⁻³\nCH4_val = 4.5e19   # ~1800 ppb\nOH_val = 1e12      # typical daytime\n\n# Vary NO from 10 ppt to 100 ppb (m⁻³)\nNO_ppb = 10 .^ range(-2, 2, length = 200)\nNO_vals = NO_ppb .* 2.5e16  # m⁻³\n\n# Compute R3 (CH3O2+NO) and R4 (CH3O2+HO2) using the system\nR3_vals = Float64[]\nR4_vals = Float64[]\n\n# Set all species to typical values\nbase_dict = Dict(\n    compiled.CH4 => CH4_val, compiled.CH3 => 1e10, compiled.CH3O2 => CH3O2_val,\n    compiled.CH3O => 1e10, compiled.CH3OOH => 1e14, compiled.HCHO => 1e15,\n    compiled.HCO => 1e10, compiled.OH => OH_val, compiled.HO2 => HO2_val,\n    compiled.H => 1e8, compiled.NO => NO_vals[1], compiled.NO2 => 1e16,\n    compiled.O => 1e8, compiled.O2 => O2_val, compiled.M => M_val)\n\nprob = NonlinearProblem(compiled, base_dict; build_initializeprob = false)\n\nfor no in NO_vals\n    newprob = remake(prob, p = [compiled.NO => no])\n    sol = solve(newprob)\n    push!(R3_vals, sol[compiled.R3])\n    push!(R4_vals, sol[compiled.R4])\nend\n\n# Fraction through NO pathway\nf_NO = R3_vals ./ (R3_vals .+ R4_vals)\n\n# Approximate O3 yield (up to ~4 O3 per CH4 at full NO pathway)\nO3_yield = 4.0 .* f_NO\n\np1 = plot(NO_ppb, f_NO .* 100,\n    xlabel = \"NO (ppb)\", ylabel = \"Fraction via NO pathway (%)\",\n    title = \"CH₃O₂ Fate: NO vs HO₂\",\n    xscale = :log10, linewidth = 2,\n    label = \"% through CH₃O₂ + NO\",\n    legend = :bottomright)\n\np2 = plot(NO_ppb, O3_yield,\n    xlabel = \"NO (ppb)\", ylabel = \"O₃ molecules per CH₄\",\n    title = \"O₃ Yield from CH₄ Oxidation\",\n    xscale = :log10, linewidth = 2,\n    label = \"Approximate O₃ yield\",\n    legend = :bottomright, ylims = (0, 5))\n\nplot(p1, p2, layout = (1, 2), size = (800, 350))\nsavefig(\"ch4_o3_yield.svg\") # hide\n\n(Image: CH3O2 fate and O3 yield vs NOx)\n\nThe left panel shows the fraction of CH3O2 that reacts with NO (the O3-producing pathway) vs HO2 (the chain-terminating pathway). At 1 ppb NO, nearly all CH3O2 reacts with NO. The right panel shows that the approximate O3 yield per CH4 molecule increases from near zero at very low NOx (where peroxide formation dominates) to about 4 at high NOx, consistent with the discussion in Section 6.4 of Seinfeld & Pandis.","category":"section"},{"location":"methane_oxidation/#Formaldehyde-Branching-Pathways","page":"Methane Oxidation","title":"Formaldehyde Branching Pathways","text":"Formaldehyde (HCHO) is a key intermediate with three loss pathways: reaction with OH, radical photolysis (HCO + H), and molecular photolysis (H2 + CO). The branching ratio affects the HOx budget.\n\nThis analysis uses the MethaneOxidation system to compute the three HCHO loss rates (R10, R11, R12) at typical daytime conditions.\n\n# Compute HCHO loss rates using the system\nHCHO_val = 1e15   # m⁻³\nOH_val_hcho = 1e12  # m⁻³ (= 1e6 cm⁻³)\n\nhcho_prob = remake(prob, p = [\n    compiled.HCHO => HCHO_val, compiled.OH => OH_val_hcho])\nsol = solve(hcho_prob)\n\nR10_val = sol[compiled.R10]  # HCHO + OH\nR11_val = sol[compiled.R11]  # HCHO → HCO + H\nR12_val = sol[compiled.R12]  # HCHO → H₂ + CO\n\nL_total = R10_val + R11_val + R12_val\nfractions = [R10_val / L_total * 100, R11_val / L_total * 100, R12_val / L_total * 100]\nlabels_bar = [\n    \"HCHO + OH\\n(radical)\", \"HCHO + hν → HCO + H\\n(radical)\", \"HCHO + hν → H₂ + CO\\n(molecular)\"]\n\nbar(labels_bar, fractions,\n    ylabel = \"Fraction of HCHO Loss (%)\",\n    title = \"Formaldehyde Loss Pathways\",\n    label = false, color = [:steelblue :orange :green],\n    size = (600, 400), ylims = (0, 100))\nsavefig(\"hcho_branching.svg\") # hide\n\n(Image: HCHO loss pathway branching)\n\nAt typical daytime conditions (OH = 10^6 molec/cm3), the molecular photolysis channel (producing H2 + CO) is the largest single loss pathway. Both the OH reaction and radical photolysis channels produce HOx radicals that contribute to further O3 production, while the molecular channel does not produce radicals.","category":"section"},{"location":"methane_oxidation/#GasChem.MethaneOxidation","page":"Methane Oxidation","title":"GasChem.MethaneOxidation","text":"MethaneOxidation(; name)\n\nModelingToolkit System implementing reaction rate diagnostics for the methane oxidation mechanism from Table 6.1 of Seinfeld & Pandis Chapter 6.\n\nThis system computes individual reaction rates and diagnostic production/loss terms.\n\nSpecies (Input Variables)\n\nCH4, CH3, CH3O2, CH3O, CH3OOH: Methane chain species [m⁻³]\nHCHO, HCO, CO: Formaldehyde and products [m⁻³]\nOH, HO2, H: HOx species [m⁻³]\nNO, NO2, O, O2, O3: NOx and oxygen species [m⁻³]\nM: Total air density [m⁻³]\n\nDiagnostics (Output Variables)\n\nR1-R17: Individual reaction rates [m⁻³ s⁻¹]\nPO3gross: Gross O₃ production from peroxy+NO reactions [m⁻³ s⁻¹]\nP_HCHO: HCHO production rate [m⁻³ s⁻¹]\nL_CH4: CH₄ loss rate [m⁻³ s⁻¹]\n\nRate Constants\n\nAll rate constants from Table 6.1 at 298 K are implemented as parameters. Bimolecular rate constants converted from cm³/molec/s to m³/s (×10⁻⁶). Termolecular rate constants converted from cm⁶/molec²/s to m⁶/s (×10⁻¹²).    # Parameters - Rate constants at 298 K from Table 6.1 (converted to SI)\n\n\n\n\n\n","category":"function"},{"location":"methane_oxidation/#GasChem.MethaneOxidationODE","page":"Methane Oxidation","title":"GasChem.MethaneOxidationODE","text":"MethaneOxidationODE(; name)\n\nFull ODE system for methane oxidation with species time derivatives.\n\nThis uses Catalyst.jl's reaction network DSL to define the 17 reactions from Table 6.1 plus auxiliary reactions (CO+OH, OH+NO₂, HO₂+HO₂, NO+O₃) and an external OH source. The reaction network is converted to an ODE system.\n\nNote: This is a stiff system due to the wide range of timescales (radicals have lifetimes of seconds, while CH₄ has a lifetime of years).\n\nO₂ and M (total air density) are treated as parameters with default values for termolecular reactions (reactions 2, 6, 13, 14, 17).\n\n\n\n\n\n","category":"function"},{"location":"geoschem/overview/#GEOS-Chem-\"fullchem\"-Gas-Phase-Mechanism","page":"Overview","title":"GEOS-Chem \"fullchem\" Gas-Phase Mechanism","text":"This is an implementation of the GEOS-Chem \"fullchem\" gas-phase mechanism in Julia. The original version is used in the GEOS-Chem global 3-D atmospheric chemistry transport model. The version here is adapted from GEOS-Chem version 14.1.1. This mechanism is the result of many journal articles which are cited in API documentation for the GEOSChemGasPhase type.\n\n![WARNING] This implementation is a work in progress. In particular, it does not yet include heterogeneous chemistry.","category":"section"},{"location":"geoschem/overview/#System-overview","page":"Overview","title":"System overview","text":"First, let's initialize the model and we can also look at the first few ODE equations of the reaction network:\n\nusing GasChem, EarthSciMLBase\nusing OrdinaryDiffEqDefault, OrdinaryDiffEqRosenbrock, ModelingToolkit\nusing DynamicQuantities, Plots\nusing ModelingToolkit: t\n\ntspan = (0.0, 360.0)\ngc = GEOSChemGasPhase()\nequations(gc)[1:5]\n\nYou can see that each reaction has a rate constant; rate constants are specified at the end of the list of equations:\n\nequations(gc)[(end - 3):end]","category":"section"},{"location":"geoschem/overview/#Simulation","page":"Overview","title":"Simulation","text":"Now, let's run a simulation and plot the results:\n\nsys = mtkcompile(gc)\nprob = ODEProblem(sys, [], tspan; build_initializeprob = false)\nsol = solve(prob, Rosenbrock23())\nplot(sol, legend = :outertopright, xlabel = \"Time (s)\",\n    ylabel = \"Concentration (ppb)\")","category":"section"},{"location":"#GasChem:-Gas-Phase-Atmospheric-Chemical-Mechanisms","page":"Home","title":"GasChem: Gas-Phase Atmospheric Chemical Mechanisms","text":"","category":"section"},{"location":"#Installation","page":"Home","title":"Installation","text":"To install GasChem.jl, use the Julia package manager:\n\nusing Pkg\nPkg.add(\"GasChem\")","category":"section"},{"location":"#Features","page":"Home","title":"Features","text":"Currently, we have implemented versions of the SuperFast and GEOS-Chem chemical mechanisms, which can be optionally coupled with the Fast-JX photolysis model, which is also implemented here.","category":"section"},{"location":"#Seinfeld-and-Pandis-Chapter-6:-Chemistry-of-the-Troposphere","page":"Home","title":"Seinfeld & Pandis Chapter 6: Chemistry of the Troposphere","text":"GasChem.jl also includes implementations of tropospheric chemistry systems from Seinfeld & Pandis \"Atmospheric Chemistry and Physics\" (2nd Edition), Chapter 6:\n\nOH Production: Production of OH radicals from O3 photolysis (Section 6.1)\nNOx Photochemistry: The NOx photochemical cycle and photostationary state (Section 6.2)\nCO Oxidation: CO oxidation and HOx cycling (Section 6.3)\nMethane Oxidation: Complete methane oxidation mechanism (Section 6.4)\nCombined System: Integrated tropospheric chemistry model","category":"section"},{"location":"#Key-Concepts","page":"Home","title":"Key Concepts","text":"Ozone in the troposphere is produced through the photochemical oxidation of volatile organic compounds (VOCs) and CO in the presence of nitrogen oxides (NOx). The OH and HO2 radicals (collectively HOx) cycle rapidly, allowing catalytic ozone production before termination (mainly OH + NO2 -> HNO3).\n\nOzone production depends strongly on NOx levels:\n\nHigh NOx (VOC-limited): O3 increases with VOC, decreases with NOx\nLow NOx (NOx-limited): O3 increases with NOx\n\nReference: Seinfeld, J.H. and Pandis, S.N. (2006). Atmospheric Chemistry and Physics: From Air Pollution to Climate Change, 2nd Edition. John Wiley & Sons. Chapter 6.","category":"section"},{"location":"#Contributing","page":"Home","title":"Contributing","text":"...coming soon","category":"section"},{"location":"#Reproducibility","page":"Home","title":"Reproducibility","text":"<details><summary>The documentation of this EarthSciML package was built using these direct dependencies,</summary>\n\nusing Pkg # hide\nPkg.status() # hide\n\n</details>\n\n<details><summary>and using this machine and Julia version.</summary>\n\nusing InteractiveUtils # hide\nversioninfo() # hide\n\n</details>\n\n<details><summary>A more complete overview of all dependencies and their versions is also provided.</summary>\n\nusing Pkg # hide\nPkg.status(; mode = PKGMODE_MANIFEST) # hide\n\n</details>\n\nusing TOML\nusing Markdown\nversion = TOML.parse(read(\"../../Project.toml\", String))[\"version\"]\nname = TOML.parse(read(\"../../Project.toml\", String))[\"name\"]\nlink_manifest = \"https://github.com/EarthSciML/\" * name * \".jl/tree/gh-pages/v\" * version *\n                \"/assets/Manifest.toml\"\nlink_project = \"https://github.com/EarthSciML/\" * name * \".jl/tree/gh-pages/v\" * version *\n               \"/assets/Project.toml\"\nMarkdown.parse(\"\"\"You can also download the\n[manifest]($link_manifest)\nfile and the\n[project]($link_project)\nfile.\n\"\"\")","category":"section"}]
}
